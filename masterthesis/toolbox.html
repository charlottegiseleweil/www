<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <script type="text/javascript">/*<![CDATA[*/
  /*
  LaTeXMathML.js from http://math.etsu.edu/LaTeXMathML/
  Adapted by Jeff Knisely and Douglas Woodall from ASCIIMathML.js v. 1.4.7,
  (c) 2005 Peter Jipsen http://www.chapman.edu/~jipsen.
  Released under the GNU General Public License version 2 or later.
  See the GNU General Public License (at http://www.gnu.org/copyleft/gpl.html)
  for more details.
  */
  var checkForMathML=true;var notifyIfNoMathML=true;var alertIfNoMathML=false;var mathcolor="";var mathfontfamily="";var showasciiformulaonhover=true;var isIE=document.createElementNS==null;if(document.getElementById==null)
  alert("This webpage requires a recent browser such as \nMozilla/Netscape 7+ or Internet Explorer 6+MathPlayer")
  function AMcreateElementXHTML(t){if(isIE)return document.createElement(t);else return document.createElementNS("http://www.w3.org/1999/xhtml",t);}
  function AMnoMathMLNote(){var nd=AMcreateElementXHTML("h3");nd.setAttribute("align","center")
  nd.appendChild(AMcreateElementXHTML("p"));nd.appendChild(document.createTextNode("To view the "));var an=AMcreateElementXHTML("a");an.appendChild(document.createTextNode("LaTeXMathML"));an.setAttribute("href","http://www.maths.nott.ac.uk/personal/drw/lm.html");nd.appendChild(an);nd.appendChild(document.createTextNode(" notation use Internet Explorer 6+"));an=AMcreateElementXHTML("a");an.appendChild(document.createTextNode("MathPlayer"));an.setAttribute("href","http://www.dessci.com/en/products/mathplayer/download.htm");nd.appendChild(an);nd.appendChild(document.createTextNode(" or Netscape/Mozilla/Firefox"));nd.appendChild(AMcreateElementXHTML("p"));return nd;}
  function AMisMathMLavailable(){if(navigator.appName.slice(0,8)=="Netscape")
  if(navigator.appVersion.slice(0,1)>="5")return null;else return AMnoMathMLNote();else if(navigator.appName.slice(0,9)=="Microsoft")
  try{var ActiveX=new ActiveXObject("MathPlayer.Factory.1");return null;}catch(e){return AMnoMathMLNote();}
  else return AMnoMathMLNote();}
  var AMcal=[0xEF35,0x212C,0xEF36,0xEF37,0x2130,0x2131,0xEF38,0x210B,0x2110,0xEF39,0xEF3A,0x2112,0x2133,0xEF3B,0xEF3C,0xEF3D,0xEF3E,0x211B,0xEF3F,0xEF40,0xEF41,0xEF42,0xEF43,0xEF44,0xEF45,0xEF46];var AMfrk=[0xEF5D,0xEF5E,0x212D,0xEF5F,0xEF60,0xEF61,0xEF62,0x210C,0x2111,0xEF63,0xEF64,0xEF65,0xEF66,0xEF67,0xEF68,0xEF69,0xEF6A,0x211C,0xEF6B,0xEF6C,0xEF6D,0xEF6E,0xEF6F,0xEF70,0xEF71,0x2128];var AMbbb=[0xEF8C,0xEF8D,0x2102,0xEF8E,0xEF8F,0xEF90,0xEF91,0x210D,0xEF92,0xEF93,0xEF94,0xEF95,0xEF96,0x2115,0xEF97,0x2119,0x211A,0x211D,0xEF98,0xEF99,0xEF9A,0xEF9B,0xEF9C,0xEF9D,0xEF9E,0x2124];var CONST=0,UNARY=1,BINARY=2,INFIX=3,LEFTBRACKET=4,RIGHTBRACKET=5,SPACE=6,UNDEROVER=7,DEFINITION=8,TEXT=9,BIG=10,LONG=11,STRETCHY=12,MATRIX=13;var AMsqrt={input:"\\sqrt",tag:"msqrt",output:"sqrt",ttype:UNARY},AMroot={input:"\\root",tag:"mroot",output:"root",ttype:BINARY},AMfrac={input:"\\frac",tag:"mfrac",output:"/",ttype:BINARY},AMover={input:"\\stackrel",tag:"mover",output:"stackrel",ttype:BINARY},AMatop={input:"\\atop",tag:"mfrac",output:"",ttype:INFIX},AMchoose={input:"\\choose",tag:"mfrac",output:"",ttype:INFIX},AMsub={input:"_",tag:"msub",output:"_",ttype:INFIX},AMsup={input:"^",tag:"msup",output:"^",ttype:INFIX},AMtext={input:"\\mathrm",tag:"mtext",output:"text",ttype:TEXT},AMmbox={input:"\\mbox",tag:"mtext",output:"mbox",ttype:TEXT};var AMsymbols=[{input:"\\alpha",tag:"mi",output:"\u03B1",ttype:CONST},{input:"\\beta",tag:"mi",output:"\u03B2",ttype:CONST},{input:"\\gamma",tag:"mi",output:"\u03B3",ttype:CONST},{input:"\\delta",tag:"mi",output:"\u03B4",ttype:CONST},{input:"\\epsilon",tag:"mi",output:"\u03B5",ttype:CONST},{input:"\\varepsilon",tag:"mi",output:"\u025B",ttype:CONST},{input:"\\zeta",tag:"mi",output:"\u03B6",ttype:CONST},{input:"\\eta",tag:"mi",output:"\u03B7",ttype:CONST},{input:"\\theta",tag:"mi",output:"\u03B8",ttype:CONST},{input:"\\vartheta",tag:"mi",output:"\u03D1",ttype:CONST},{input:"\\iota",tag:"mi",output:"\u03B9",ttype:CONST},{input:"\\kappa",tag:"mi",output:"\u03BA",ttype:CONST},{input:"\\lambda",tag:"mi",output:"\u03BB",ttype:CONST},{input:"\\mu",tag:"mi",output:"\u03BC",ttype:CONST},{input:"\\nu",tag:"mi",output:"\u03BD",ttype:CONST},{input:"\\xi",tag:"mi",output:"\u03BE",ttype:CONST},{input:"\\pi",tag:"mi",output:"\u03C0",ttype:CONST},{input:"\\varpi",tag:"mi",output:"\u03D6",ttype:CONST},{input:"\\rho",tag:"mi",output:"\u03C1",ttype:CONST},{input:"\\varrho",tag:"mi",output:"\u03F1",ttype:CONST},{input:"\\varsigma",tag:"mi",output:"\u03C2",ttype:CONST},{input:"\\sigma",tag:"mi",output:"\u03C3",ttype:CONST},{input:"\\tau",tag:"mi",output:"\u03C4",ttype:CONST},{input:"\\upsilon",tag:"mi",output:"\u03C5",ttype:CONST},{input:"\\phi",tag:"mi",output:"\u03C6",ttype:CONST},{input:"\\varphi",tag:"mi",output:"\u03D5",ttype:CONST},{input:"\\chi",tag:"mi",output:"\u03C7",ttype:CONST},{input:"\\psi",tag:"mi",output:"\u03C8",ttype:CONST},{input:"\\omega",tag:"mi",output:"\u03C9",ttype:CONST},{input:"\\Gamma",tag:"mo",output:"\u0393",ttype:CONST},{input:"\\Delta",tag:"mo",output:"\u0394",ttype:CONST},{input:"\\Theta",tag:"mo",output:"\u0398",ttype:CONST},{input:"\\Lambda",tag:"mo",output:"\u039B",ttype:CONST},{input:"\\Xi",tag:"mo",output:"\u039E",ttype:CONST},{input:"\\Pi",tag:"mo",output:"\u03A0",ttype:CONST},{input:"\\Sigma",tag:"mo",output:"\u03A3",ttype:CONST},{input:"\\Upsilon",tag:"mo",output:"\u03A5",ttype:CONST},{input:"\\Phi",tag:"mo",output:"\u03A6",ttype:CONST},{input:"\\Psi",tag:"mo",output:"\u03A8",ttype:CONST},{input:"\\Omega",tag:"mo",output:"\u03A9",ttype:CONST},{input:"\\frac12",tag:"mo",output:"\u00BD",ttype:CONST},{input:"\\frac14",tag:"mo",output:"\u00BC",ttype:CONST},{input:"\\frac34",tag:"mo",output:"\u00BE",ttype:CONST},{input:"\\frac13",tag:"mo",output:"\u2153",ttype:CONST},{input:"\\frac23",tag:"mo",output:"\u2154",ttype:CONST},{input:"\\frac15",tag:"mo",output:"\u2155",ttype:CONST},{input:"\\frac25",tag:"mo",output:"\u2156",ttype:CONST},{input:"\\frac35",tag:"mo",output:"\u2157",ttype:CONST},{input:"\\frac45",tag:"mo",output:"\u2158",ttype:CONST},{input:"\\frac16",tag:"mo",output:"\u2159",ttype:CONST},{input:"\\frac56",tag:"mo",output:"\u215A",ttype:CONST},{input:"\\frac18",tag:"mo",output:"\u215B",ttype:CONST},{input:"\\frac38",tag:"mo",output:"\u215C",ttype:CONST},{input:"\\frac58",tag:"mo",output:"\u215D",ttype:CONST},{input:"\\frac78",tag:"mo",output:"\u215E",ttype:CONST},{input:"\\pm",tag:"mo",output:"\u00B1",ttype:CONST},{input:"\\mp",tag:"mo",output:"\u2213",ttype:CONST},{input:"\\triangleleft",tag:"mo",output:"\u22B2",ttype:CONST},{input:"\\triangleright",tag:"mo",output:"\u22B3",ttype:CONST},{input:"\\cdot",tag:"mo",output:"\u22C5",ttype:CONST},{input:"\\star",tag:"mo",output:"\u22C6",ttype:CONST},{input:"\\ast",tag:"mo",output:"\u002A",ttype:CONST},{input:"\\times",tag:"mo",output:"\u00D7",ttype:CONST},{input:"\\div",tag:"mo",output:"\u00F7",ttype:CONST},{input:"\\circ",tag:"mo",output:"\u2218",ttype:CONST},{input:"\\bullet",tag:"mo",output:"\u2022",ttype:CONST},{input:"\\oplus",tag:"mo",output:"\u2295",ttype:CONST},{input:"\\ominus",tag:"mo",output:"\u2296",ttype:CONST},{input:"\\otimes",tag:"mo",output:"\u2297",ttype:CONST},{input:"\\bigcirc",tag:"mo",output:"\u25CB",ttype:CONST},{input:"\\oslash",tag:"mo",output:"\u2298",ttype:CONST},{input:"\\odot",tag:"mo",output:"\u2299",ttype:CONST},{input:"\\land",tag:"mo",output:"\u2227",ttype:CONST},{input:"\\wedge",tag:"mo",output:"\u2227",ttype:CONST},{input:"\\lor",tag:"mo",output:"\u2228",ttype:CONST},{input:"\\vee",tag:"mo",output:"\u2228",ttype:CONST},{input:"\\cap",tag:"mo",output:"\u2229",ttype:CONST},{input:"\\cup",tag:"mo",output:"\u222A",ttype:CONST},{input:"\\sqcap",tag:"mo",output:"\u2293",ttype:CONST},{input:"\\sqcup",tag:"mo",output:"\u2294",ttype:CONST},{input:"\\uplus",tag:"mo",output:"\u228E",ttype:CONST},{input:"\\amalg",tag:"mo",output:"\u2210",ttype:CONST},{input:"\\bigtriangleup",tag:"mo",output:"\u25B3",ttype:CONST},{input:"\\bigtriangledown",tag:"mo",output:"\u25BD",ttype:CONST},{input:"\\dag",tag:"mo",output:"\u2020",ttype:CONST},{input:"\\dagger",tag:"mo",output:"\u2020",ttype:CONST},{input:"\\ddag",tag:"mo",output:"\u2021",ttype:CONST},{input:"\\ddagger",tag:"mo",output:"\u2021",ttype:CONST},{input:"\\lhd",tag:"mo",output:"\u22B2",ttype:CONST},{input:"\\rhd",tag:"mo",output:"\u22B3",ttype:CONST},{input:"\\unlhd",tag:"mo",output:"\u22B4",ttype:CONST},{input:"\\unrhd",tag:"mo",output:"\u22B5",ttype:CONST},{input:"\\sum",tag:"mo",output:"\u2211",ttype:UNDEROVER},{input:"\\prod",tag:"mo",output:"\u220F",ttype:UNDEROVER},{input:"\\bigcap",tag:"mo",output:"\u22C2",ttype:UNDEROVER},{input:"\\bigcup",tag:"mo",output:"\u22C3",ttype:UNDEROVER},{input:"\\bigwedge",tag:"mo",output:"\u22C0",ttype:UNDEROVER},{input:"\\bigvee",tag:"mo",output:"\u22C1",ttype:UNDEROVER},{input:"\\bigsqcap",tag:"mo",output:"\u2A05",ttype:UNDEROVER},{input:"\\bigsqcup",tag:"mo",output:"\u2A06",ttype:UNDEROVER},{input:"\\coprod",tag:"mo",output:"\u2210",ttype:UNDEROVER},{input:"\\bigoplus",tag:"mo",output:"\u2A01",ttype:UNDEROVER},{input:"\\bigotimes",tag:"mo",output:"\u2A02",ttype:UNDEROVER},{input:"\\bigodot",tag:"mo",output:"\u2A00",ttype:UNDEROVER},{input:"\\biguplus",tag:"mo",output:"\u2A04",ttype:UNDEROVER},{input:"\\int",tag:"mo",output:"\u222B",ttype:CONST},{input:"\\oint",tag:"mo",output:"\u222E",ttype:CONST},{input:":=",tag:"mo",output:":=",ttype:CONST},{input:"\\lt",tag:"mo",output:"<",ttype:CONST},{input:"\\gt",tag:"mo",output:">",ttype:CONST},{input:"\\ne",tag:"mo",output:"\u2260",ttype:CONST},{input:"\\neq",tag:"mo",output:"\u2260",ttype:CONST},{input:"\\le",tag:"mo",output:"\u2264",ttype:CONST},{input:"\\leq",tag:"mo",output:"\u2264",ttype:CONST},{input:"\\leqslant",tag:"mo",output:"\u2264",ttype:CONST},{input:"\\ge",tag:"mo",output:"\u2265",ttype:CONST},{input:"\\geq",tag:"mo",output:"\u2265",ttype:CONST},{input:"\\geqslant",tag:"mo",output:"\u2265",ttype:CONST},{input:"\\equiv",tag:"mo",output:"\u2261",ttype:CONST},{input:"\\ll",tag:"mo",output:"\u226A",ttype:CONST},{input:"\\gg",tag:"mo",output:"\u226B",ttype:CONST},{input:"\\doteq",tag:"mo",output:"\u2250",ttype:CONST},{input:"\\prec",tag:"mo",output:"\u227A",ttype:CONST},{input:"\\succ",tag:"mo",output:"\u227B",ttype:CONST},{input:"\\preceq",tag:"mo",output:"\u227C",ttype:CONST},{input:"\\succeq",tag:"mo",output:"\u227D",ttype:CONST},{input:"\\subset",tag:"mo",output:"\u2282",ttype:CONST},{input:"\\supset",tag:"mo",output:"\u2283",ttype:CONST},{input:"\\subseteq",tag:"mo",output:"\u2286",ttype:CONST},{input:"\\supseteq",tag:"mo",output:"\u2287",ttype:CONST},{input:"\\sqsubset",tag:"mo",output:"\u228F",ttype:CONST},{input:"\\sqsupset",tag:"mo",output:"\u2290",ttype:CONST},{input:"\\sqsubseteq",tag:"mo",output:"\u2291",ttype:CONST},{input:"\\sqsupseteq",tag:"mo",output:"\u2292",ttype:CONST},{input:"\\sim",tag:"mo",output:"\u223C",ttype:CONST},{input:"\\simeq",tag:"mo",output:"\u2243",ttype:CONST},{input:"\\approx",tag:"mo",output:"\u2248",ttype:CONST},{input:"\\cong",tag:"mo",output:"\u2245",ttype:CONST},{input:"\\Join",tag:"mo",output:"\u22C8",ttype:CONST},{input:"\\bowtie",tag:"mo",output:"\u22C8",ttype:CONST},{input:"\\in",tag:"mo",output:"\u2208",ttype:CONST},{input:"\\ni",tag:"mo",output:"\u220B",ttype:CONST},{input:"\\owns",tag:"mo",output:"\u220B",ttype:CONST},{input:"\\propto",tag:"mo",output:"\u221D",ttype:CONST},{input:"\\vdash",tag:"mo",output:"\u22A2",ttype:CONST},{input:"\\dashv",tag:"mo",output:"\u22A3",ttype:CONST},{input:"\\models",tag:"mo",output:"\u22A8",ttype:CONST},{input:"\\perp",tag:"mo",output:"\u22A5",ttype:CONST},{input:"\\smile",tag:"mo",output:"\u2323",ttype:CONST},{input:"\\frown",tag:"mo",output:"\u2322",ttype:CONST},{input:"\\asymp",tag:"mo",output:"\u224D",ttype:CONST},{input:"\\notin",tag:"mo",output:"\u2209",ttype:CONST},{input:"\\begin{eqnarray}",output:"X",ttype:MATRIX,invisible:true},{input:"\\begin{array}",output:"X",ttype:MATRIX,invisible:true},{input:"\\\\",output:"}&{",ttype:DEFINITION},{input:"\\end{eqnarray}",output:"}}",ttype:DEFINITION},{input:"\\end{array}",output:"}}",ttype:DEFINITION},{input:"\\big",tag:"mo",output:"X",atval:"1.2",ieval:"2.2",ttype:BIG},{input:"\\Big",tag:"mo",output:"X",atval:"1.6",ieval:"2.6",ttype:BIG},{input:"\\bigg",tag:"mo",output:"X",atval:"2.2",ieval:"3.2",ttype:BIG},{input:"\\Bigg",tag:"mo",output:"X",atval:"2.9",ieval:"3.9",ttype:BIG},{input:"\\left",tag:"mo",output:"X",ttype:LEFTBRACKET},{input:"\\right",tag:"mo",output:"X",ttype:RIGHTBRACKET},{input:"{",output:"{",ttype:LEFTBRACKET,invisible:true},{input:"}",output:"}",ttype:RIGHTBRACKET,invisible:true},{input:"(",tag:"mo",output:"(",atval:"1",ttype:STRETCHY},{input:"[",tag:"mo",output:"[",atval:"1",ttype:STRETCHY},{input:"\\lbrack",tag:"mo",output:"[",atval:"1",ttype:STRETCHY},{input:"\\{",tag:"mo",output:"{",atval:"1",ttype:STRETCHY},{input:"\\lbrace",tag:"mo",output:"{",atval:"1",ttype:STRETCHY},{input:"\\langle",tag:"mo",output:"\u2329",atval:"1",ttype:STRETCHY},{input:"\\lfloor",tag:"mo",output:"\u230A",atval:"1",ttype:STRETCHY},{input:"\\lceil",tag:"mo",output:"\u2308",atval:"1",ttype:STRETCHY},{input:")",tag:"mo",output:")",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"]",tag:"mo",output:"]",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\rbrack",tag:"mo",output:"]",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\}",tag:"mo",output:"}",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\rbrace",tag:"mo",output:"}",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\rangle",tag:"mo",output:"\u232A",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\rfloor",tag:"mo",output:"\u230B",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"\\rceil",tag:"mo",output:"\u2309",rtag:"mi",atval:"1",ttype:STRETCHY},{input:"|",tag:"mo",output:"\u2223",atval:"1",ttype:STRETCHY},{input:"\\|",tag:"mo",output:"\u2225",atval:"1",ttype:STRETCHY},{input:"\\vert",tag:"mo",output:"\u2223",atval:"1",ttype:STRETCHY},{input:"\\Vert",tag:"mo",output:"\u2225",atval:"1",ttype:STRETCHY},{input:"\\mid",tag:"mo",output:"\u2223",atval:"1",ttype:STRETCHY},{input:"\\parallel",tag:"mo",output:"\u2225",atval:"1",ttype:STRETCHY},{input:"/",tag:"mo",output:"/",atval:"1.01",ttype:STRETCHY},{input:"\\backslash",tag:"mo",output:"\u2216",atval:"1",ttype:STRETCHY},{input:"\\setminus",tag:"mo",output:"\\",ttype:CONST},{input:"\\!",tag:"mspace",atname:"width",atval:"-0.167em",ttype:SPACE},{input:"\\,",tag:"mspace",atname:"width",atval:"0.167em",ttype:SPACE},{input:"\\>",tag:"mspace",atname:"width",atval:"0.222em",ttype:SPACE},{input:"\\:",tag:"mspace",atname:"width",atval:"0.222em",ttype:SPACE},{input:"\\;",tag:"mspace",atname:"width",atval:"0.278em",ttype:SPACE},{input:"~",tag:"mspace",atname:"width",atval:"0.333em",ttype:SPACE},{input:"\\quad",tag:"mspace",atname:"width",atval:"1em",ttype:SPACE},{input:"\\qquad",tag:"mspace",atname:"width",atval:"2em",ttype:SPACE},{input:"\\prime",tag:"mo",output:"\u2032",ttype:CONST},{input:"'",tag:"mo",output:"\u02B9",ttype:CONST},{input:"''",tag:"mo",output:"\u02BA",ttype:CONST},{input:"'''",tag:"mo",output:"\u2034",ttype:CONST},{input:"''''",tag:"mo",output:"\u2057",ttype:CONST},{input:"\\ldots",tag:"mo",output:"\u2026",ttype:CONST},{input:"\\cdots",tag:"mo",output:"\u22EF",ttype:CONST},{input:"\\vdots",tag:"mo",output:"\u22EE",ttype:CONST},{input:"\\ddots",tag:"mo",output:"\u22F1",ttype:CONST},{input:"\\forall",tag:"mo",output:"\u2200",ttype:CONST},{input:"\\exists",tag:"mo",output:"\u2203",ttype:CONST},{input:"\\Re",tag:"mo",output:"\u211C",ttype:CONST},{input:"\\Im",tag:"mo",output:"\u2111",ttype:CONST},{input:"\\aleph",tag:"mo",output:"\u2135",ttype:CONST},{input:"\\hbar",tag:"mo",output:"\u210F",ttype:CONST},{input:"\\ell",tag:"mo",output:"\u2113",ttype:CONST},{input:"\\wp",tag:"mo",output:"\u2118",ttype:CONST},{input:"\\emptyset",tag:"mo",output:"\u2205",ttype:CONST},{input:"\\infty",tag:"mo",output:"\u221E",ttype:CONST},{input:"\\surd",tag:"mo",output:"\\sqrt{}",ttype:DEFINITION},{input:"\\partial",tag:"mo",output:"\u2202",ttype:CONST},{input:"\\nabla",tag:"mo",output:"\u2207",ttype:CONST},{input:"\\triangle",tag:"mo",output:"\u25B3",ttype:CONST},{input:"\\therefore",tag:"mo",output:"\u2234",ttype:CONST},{input:"\\angle",tag:"mo",output:"\u2220",ttype:CONST},{input:"\\diamond",tag:"mo",output:"\u22C4",ttype:CONST},{input:"\\Diamond",tag:"mo",output:"\u25C7",ttype:CONST},{input:"\\neg",tag:"mo",output:"\u00AC",ttype:CONST},{input:"\\lnot",tag:"mo",output:"\u00AC",ttype:CONST},{input:"\\bot",tag:"mo",output:"\u22A5",ttype:CONST},{input:"\\top",tag:"mo",output:"\u22A4",ttype:CONST},{input:"\\square",tag:"mo",output:"\u25AB",ttype:CONST},{input:"\\Box",tag:"mo",output:"\u25A1",ttype:CONST},{input:"\\wr",tag:"mo",output:"\u2240",ttype:CONST},{input:"\\arccos",tag:"mi",output:"arccos",ttype:UNARY,func:true},{input:"\\arcsin",tag:"mi",output:"arcsin",ttype:UNARY,func:true},{input:"\\arctan",tag:"mi",output:"arctan",ttype:UNARY,func:true},{input:"\\arg",tag:"mi",output:"arg",ttype:UNARY,func:true},{input:"\\cos",tag:"mi",output:"cos",ttype:UNARY,func:true},{input:"\\cosh",tag:"mi",output:"cosh",ttype:UNARY,func:true},{input:"\\cot",tag:"mi",output:"cot",ttype:UNARY,func:true},{input:"\\coth",tag:"mi",output:"coth",ttype:UNARY,func:true},{input:"\\csc",tag:"mi",output:"csc",ttype:UNARY,func:true},{input:"\\deg",tag:"mi",output:"deg",ttype:UNARY,func:true},{input:"\\det",tag:"mi",output:"det",ttype:UNARY,func:true},{input:"\\dim",tag:"mi",output:"dim",ttype:UNARY,func:true},{input:"\\exp",tag:"mi",output:"exp",ttype:UNARY,func:true},{input:"\\gcd",tag:"mi",output:"gcd",ttype:UNARY,func:true},{input:"\\hom",tag:"mi",output:"hom",ttype:UNARY,func:true},{input:"\\inf",tag:"mo",output:"inf",ttype:UNDEROVER},{input:"\\ker",tag:"mi",output:"ker",ttype:UNARY,func:true},{input:"\\lg",tag:"mi",output:"lg",ttype:UNARY,func:true},{input:"\\lim",tag:"mo",output:"lim",ttype:UNDEROVER},{input:"\\liminf",tag:"mo",output:"liminf",ttype:UNDEROVER},{input:"\\limsup",tag:"mo",output:"limsup",ttype:UNDEROVER},{input:"\\ln",tag:"mi",output:"ln",ttype:UNARY,func:true},{input:"\\log",tag:"mi",output:"log",ttype:UNARY,func:true},{input:"\\max",tag:"mo",output:"max",ttype:UNDEROVER},{input:"\\min",tag:"mo",output:"min",ttype:UNDEROVER},{input:"\\Pr",tag:"mi",output:"Pr",ttype:UNARY,func:true},{input:"\\sec",tag:"mi",output:"sec",ttype:UNARY,func:true},{input:"\\sin",tag:"mi",output:"sin",ttype:UNARY,func:true},{input:"\\sinh",tag:"mi",output:"sinh",ttype:UNARY,func:true},{input:"\\sup",tag:"mo",output:"sup",ttype:UNDEROVER},{input:"\\tan",tag:"mi",output:"tan",ttype:UNARY,func:true},{input:"\\tanh",tag:"mi",output:"tanh",ttype:UNARY,func:true},{input:"\\gets",tag:"mo",output:"\u2190",ttype:CONST},{input:"\\leftarrow",tag:"mo",output:"\u2190",ttype:CONST},{input:"\\to",tag:"mo",output:"\u2192",ttype:CONST},{input:"\\rightarrow",tag:"mo",output:"\u2192",ttype:CONST},{input:"\\leftrightarrow",tag:"mo",output:"\u2194",ttype:CONST},{input:"\\uparrow",tag:"mo",output:"\u2191",ttype:CONST},{input:"\\downarrow",tag:"mo",output:"\u2193",ttype:CONST},{input:"\\updownarrow",tag:"mo",output:"\u2195",ttype:CONST},{input:"\\Leftarrow",tag:"mo",output:"\u21D0",ttype:CONST},{input:"\\Rightarrow",tag:"mo",output:"\u21D2",ttype:CONST},{input:"\\Leftrightarrow",tag:"mo",output:"\u21D4",ttype:CONST},{input:"\\iff",tag:"mo",output:"~\\Longleftrightarrow~",ttype:DEFINITION},{input:"\\Uparrow",tag:"mo",output:"\u21D1",ttype:CONST},{input:"\\Downarrow",tag:"mo",output:"\u21D3",ttype:CONST},{input:"\\Updownarrow",tag:"mo",output:"\u21D5",ttype:CONST},{input:"\\mapsto",tag:"mo",output:"\u21A6",ttype:CONST},{input:"\\longleftarrow",tag:"mo",output:"\u2190",ttype:LONG},{input:"\\longrightarrow",tag:"mo",output:"\u2192",ttype:LONG},{input:"\\longleftrightarrow",tag:"mo",output:"\u2194",ttype:LONG},{input:"\\Longleftarrow",tag:"mo",output:"\u21D0",ttype:LONG},{input:"\\Longrightarrow",tag:"mo",output:"\u21D2",ttype:LONG},{input:"\\Longleftrightarrow",tag:"mo",output:"\u21D4",ttype:LONG},{input:"\\longmapsto",tag:"mo",output:"\u21A6",ttype:CONST},AMsqrt,AMroot,AMfrac,AMover,AMsub,AMsup,AMtext,AMmbox,AMatop,AMchoose,{input:"\\acute",tag:"mover",output:"\u00B4",ttype:UNARY,acc:true},{input:"\\grave",tag:"mover",output:"\u0060",ttype:UNARY,acc:true},{input:"\\breve",tag:"mover",output:"\u02D8",ttype:UNARY,acc:true},{input:"\\check",tag:"mover",output:"\u02C7",ttype:UNARY,acc:true},{input:"\\dot",tag:"mover",output:".",ttype:UNARY,acc:true},{input:"\\ddot",tag:"mover",output:"..",ttype:UNARY,acc:true},{input:"\\mathring",tag:"mover",output:"\u00B0",ttype:UNARY,acc:true},{input:"\\vec",tag:"mover",output:"\u20D7",ttype:UNARY,acc:true},{input:"\\overrightarrow",tag:"mover",output:"\u20D7",ttype:UNARY,acc:true},{input:"\\overleftarrow",tag:"mover",output:"\u20D6",ttype:UNARY,acc:true},{input:"\\hat",tag:"mover",output:"\u005E",ttype:UNARY,acc:true},{input:"\\widehat",tag:"mover",output:"\u0302",ttype:UNARY,acc:true},{input:"\\tilde",tag:"mover",output:"~",ttype:UNARY,acc:true},{input:"\\widetilde",tag:"mover",output:"\u02DC",ttype:UNARY,acc:true},{input:"\\bar",tag:"mover",output:"\u203E",ttype:UNARY,acc:true},{input:"\\overbrace",tag:"mover",output:"\uFE37",ttype:UNARY,acc:true},{input:"\\overbracket",tag:"mover",output:"\u23B4",ttype:UNARY,acc:true},{input:"\\overline",tag:"mover",output:"\u00AF",ttype:UNARY,acc:true},{input:"\\underbrace",tag:"munder",output:"\uFE38",ttype:UNARY,acc:true},{input:"\\underbracket",tag:"munder",output:"\u23B5",ttype:UNARY,acc:true},{input:"\\underline",tag:"munder",output:"\u00AF",ttype:UNARY,acc:true},{input:"\\displaystyle",tag:"mstyle",atname:"displaystyle",atval:"true",ttype:UNARY},{input:"\\textstyle",tag:"mstyle",atname:"displaystyle",atval:"false",ttype:UNARY},{input:"\\scriptstyle",tag:"mstyle",atname:"scriptlevel",atval:"1",ttype:UNARY},{input:"\\scriptscriptstyle",tag:"mstyle",atname:"scriptlevel",atval:"2",ttype:UNARY},{input:"\\textrm",tag:"mstyle",output:"\\mathrm",ttype:DEFINITION},{input:"\\mathbf",tag:"mstyle",atname:"mathvariant",atval:"bold",ttype:UNARY},{input:"\\textbf",tag:"mstyle",atname:"mathvariant",atval:"bold",ttype:UNARY},{input:"\\mathit",tag:"mstyle",atname:"mathvariant",atval:"italic",ttype:UNARY},{input:"\\textit",tag:"mstyle",atname:"mathvariant",atval:"italic",ttype:UNARY},{input:"\\mathtt",tag:"mstyle",atname:"mathvariant",atval:"monospace",ttype:UNARY},{input:"\\texttt",tag:"mstyle",atname:"mathvariant",atval:"monospace",ttype:UNARY},{input:"\\mathsf",tag:"mstyle",atname:"mathvariant",atval:"sans-serif",ttype:UNARY},{input:"\\mathbb",tag:"mstyle",atname:"mathvariant",atval:"double-struck",ttype:UNARY,codes:AMbbb},{input:"\\mathcal",tag:"mstyle",atname:"mathvariant",atval:"script",ttype:UNARY,codes:AMcal},{input:"\\mathfrak",tag:"mstyle",atname:"mathvariant",atval:"fraktur",ttype:UNARY,codes:AMfrk},{input:"\\textcolor",tag:"mstyle",atname:"mathvariant",atval:"mathcolor",ttype:BINARY},{input:"\\colorbox",tag:"mstyle",atname:"mathvariant",atval:"background",ttype:BINARY}];function compareNames(s1,s2){if(s1.input>s2.input)return 1
  else return-1;}
  var AMnames=[];function AMinitSymbols(){AMsymbols.sort(compareNames);for(i=0;i<AMsymbols.length;i++)AMnames[i]=AMsymbols[i].input;}
  var AMmathml="http://www.w3.org/1998/Math/MathML";function AMcreateElementMathML(t){if(isIE)return document.createElement("m:"+t);else return document.createElementNS(AMmathml,t);}
  function AMcreateMmlNode(t,frag){if(isIE)var node=document.createElement("m:"+t);else var node=document.createElementNS(AMmathml,t);node.appendChild(frag);return node;}
  function newcommand(oldstr,newstr){AMsymbols=AMsymbols.concat([{input:oldstr,tag:"mo",output:newstr,ttype:DEFINITION}]);}
  function AMremoveCharsAndBlanks(str,n){var st;st=str.slice(n);for(var i=0;i<st.length&&st.charCodeAt(i)<=32;i=i+1);return st.slice(i);}
  function AMposition(arr,str,n){if(n==0){var h,m;n=-1;h=arr.length;while(n+1<h){m=(n+h)>>1;if(arr[m]<str)n=m;else h=m;}
  return h;}else
  for(var i=n;i<arr.length&&arr[i]<str;i++);return i;}
  function AMgetSymbol(str){var k=0;var j=0;var mk;var st;var tagst;var match="";var more=true;for(var i=1;i<=str.length&&more;i++){st=str.slice(0,i);j=k;k=AMposition(AMnames,st,j);if(k<AMnames.length&&str.slice(0,AMnames[k].length)==AMnames[k]){match=AMnames[k];mk=k;i=match.length;}
  more=k<AMnames.length&&str.slice(0,AMnames[k].length)>=AMnames[k];}
  AMpreviousSymbol=AMcurrentSymbol;if(match!=""){AMcurrentSymbol=AMsymbols[mk].ttype;return AMsymbols[mk];}
  AMcurrentSymbol=CONST;k=1;st=str.slice(0,1);if("0"<=st&&st<="9")tagst="mn";else tagst=(("A">st||st>"Z")&&("a">st||st>"z")?"mo":"mi");return{input:st,tag:tagst,output:st,ttype:CONST};}
  var AMpreviousSymbol,AMcurrentSymbol;function AMparseSexpr(str){var symbol,node,result,result2,i,st,newFrag=document.createDocumentFragment();str=AMremoveCharsAndBlanks(str,0);symbol=AMgetSymbol(str);if(symbol==null||symbol.ttype==RIGHTBRACKET)
  return[null,str,null];if(symbol.ttype==DEFINITION){str=symbol.output+AMremoveCharsAndBlanks(str,symbol.input.length);symbol=AMgetSymbol(str);if(symbol==null||symbol.ttype==RIGHTBRACKET)
  return[null,str,null];}
  str=AMremoveCharsAndBlanks(str,symbol.input.length);switch(symbol.ttype){case SPACE:node=AMcreateElementMathML(symbol.tag);node.setAttribute(symbol.atname,symbol.atval);return[node,str,symbol.tag];case UNDEROVER:if(isIE){if(symbol.input.substr(0,4)=="\\big"){str="\\"+symbol.input.substr(4)+str;symbol=AMgetSymbol(str);symbol.ttype=UNDEROVER;str=AMremoveCharsAndBlanks(str,symbol.input.length);}}
  return[AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)),str,symbol.tag];case CONST:var output=symbol.output;if(isIE){if(symbol.input=="'")
  output="\u2032";else if(symbol.input=="''")
  output="\u2033";else if(symbol.input=="'''")
  output="\u2033\u2032";else if(symbol.input=="''''")
  output="\u2033\u2033";else if(symbol.input=="\\square")
  output="\u25A1";else if(symbol.input.substr(0,5)=="\\frac"){var denom=symbol.input.substr(6,1);if(denom=="5"||denom=="6"){str=symbol.input.replace(/\\frac/,"\\frac ")+str;return[node,str,symbol.tag];}}}
  node=AMcreateMmlNode(symbol.tag,document.createTextNode(output));return[node,str,symbol.tag];case LONG:node=AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output));node.setAttribute("minsize","1.5");node.setAttribute("maxsize","1.5");node=AMcreateMmlNode("mover",node);node.appendChild(AMcreateElementMathML("mspace"));return[node,str,symbol.tag];case STRETCHY:if(isIE&&symbol.input=="\\backslash")
  symbol.output="\\";node=AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output));if(symbol.input=="|"||symbol.input=="\\vert"||symbol.input=="\\|"||symbol.input=="\\Vert"){node.setAttribute("lspace","0em");node.setAttribute("rspace","0em");}
  node.setAttribute("maxsize",symbol.atval);if(symbol.rtag!=null)
  return[node,str,symbol.rtag];else
  return[node,str,symbol.tag];case BIG:var atval=symbol.atval;if(isIE)
  atval=symbol.ieval;symbol=AMgetSymbol(str);if(symbol==null)
  return[null,str,null];str=AMremoveCharsAndBlanks(str,symbol.input.length);node=AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output));if(isIE){var space=AMcreateElementMathML("mspace");space.setAttribute("height",atval+"ex");node=AMcreateMmlNode("mrow",node);node.appendChild(space);}else{node.setAttribute("minsize",atval);node.setAttribute("maxsize",atval);}
  return[node,str,symbol.tag];case LEFTBRACKET:if(symbol.input=="\\left"){symbol=AMgetSymbol(str);if(symbol!=null){if(symbol.input==".")
  symbol.invisible=true;str=AMremoveCharsAndBlanks(str,symbol.input.length);}}
  result=AMparseExpr(str,true,false);if(symbol==null||(typeof symbol.invisible=="boolean"&&symbol.invisible))
  node=AMcreateMmlNode("mrow",result[0]);else{node=AMcreateMmlNode("mo",document.createTextNode(symbol.output));node=AMcreateMmlNode("mrow",node);node.appendChild(result[0]);}
  return[node,result[1],result[2]];case MATRIX:if(symbol.input=="\\begin{array}"){var mask="";symbol=AMgetSymbol(str);str=AMremoveCharsAndBlanks(str,0);if(symbol==null)
  mask="l";else{str=AMremoveCharsAndBlanks(str,symbol.input.length);if(symbol.input!="{")
  mask="l";else do{symbol=AMgetSymbol(str);if(symbol!=null){str=AMremoveCharsAndBlanks(str,symbol.input.length);if(symbol.input!="}")
  mask=mask+symbol.input;}}while(symbol!=null&&symbol.input!=""&&symbol.input!="}");}
  result=AMparseExpr("{"+str,true,true);node=AMcreateMmlNode("mtable",result[0]);mask=mask.replace(/l/g,"left ");mask=mask.replace(/r/g,"right ");mask=mask.replace(/c/g,"center ");node.setAttribute("columnalign",mask);node.setAttribute("displaystyle","false");if(isIE)
  return[node,result[1],null];var lspace=AMcreateElementMathML("mspace");lspace.setAttribute("width","0.167em");var rspace=AMcreateElementMathML("mspace");rspace.setAttribute("width","0.167em");var node1=AMcreateMmlNode("mrow",lspace);node1.appendChild(node);node1.appendChild(rspace);return[node1,result[1],null];}else{result=AMparseExpr("{"+str,true,true);node=AMcreateMmlNode("mtable",result[0]);if(isIE)
  node.setAttribute("columnspacing","0.25em");else
  node.setAttribute("columnspacing","0.167em");node.setAttribute("columnalign","right center left");node.setAttribute("displaystyle","true");node=AMcreateMmlNode("mrow",node);return[node,result[1],null];}
  case TEXT:if(str.charAt(0)=="{")i=str.indexOf("}");else i=0;if(i==-1)
  i=str.length;st=str.slice(1,i);if(st.charAt(0)==" "){node=AMcreateElementMathML("mspace");node.setAttribute("width","0.33em");newFrag.appendChild(node);}
  newFrag.appendChild(AMcreateMmlNode(symbol.tag,document.createTextNode(st)));if(st.charAt(st.length-1)==" "){node=AMcreateElementMathML("mspace");node.setAttribute("width","0.33em");newFrag.appendChild(node);}
  str=AMremoveCharsAndBlanks(str,i+1);return[AMcreateMmlNode("mrow",newFrag),str,null];case UNARY:result=AMparseSexpr(str);if(result[0]==null)return[AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)),str];if(typeof symbol.func=="boolean"&&symbol.func){st=str.charAt(0);if(st=="^"||st=="_"||st==","){return[AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)),str,symbol.tag];}else{node=AMcreateMmlNode("mrow",AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)));if(isIE){var space=AMcreateElementMathML("mspace");space.setAttribute("width","0.167em");node.appendChild(space);}
  node.appendChild(result[0]);return[node,result[1],symbol.tag];}}
  if(symbol.input=="\\sqrt"){if(isIE){var space=AMcreateElementMathML("mspace");space.setAttribute("height","1.2ex");space.setAttribute("width","0em");node=AMcreateMmlNode(symbol.tag,result[0])
  node.appendChild(space);return[node,result[1],symbol.tag];}else
  return[AMcreateMmlNode(symbol.tag,result[0]),result[1],symbol.tag];}else if(typeof symbol.acc=="boolean"&&symbol.acc){node=AMcreateMmlNode(symbol.tag,result[0]);var output=symbol.output;if(isIE){if(symbol.input=="\\hat")
  output="\u0302";else if(symbol.input=="\\widehat")
  output="\u005E";else if(symbol.input=="\\bar")
  output="\u00AF";else if(symbol.input=="\\grave")
  output="\u0300";else if(symbol.input=="\\tilde")
  output="\u0303";}
  var node1=AMcreateMmlNode("mo",document.createTextNode(output));if(symbol.input=="\\vec"||symbol.input=="\\check")
  node1.setAttribute("maxsize","1.2");if(isIE&&symbol.input=="\\bar")
  node1.setAttribute("maxsize","0.5");if(symbol.input=="\\underbrace"||symbol.input=="\\underline")
  node1.setAttribute("accentunder","true");else
  node1.setAttribute("accent","true");node.appendChild(node1);if(symbol.input=="\\overbrace"||symbol.input=="\\underbrace")
  node.ttype=UNDEROVER;return[node,result[1],symbol.tag];}else{if(!isIE&&typeof symbol.codes!="undefined"){for(i=0;i<result[0].childNodes.length;i++)
  if(result[0].childNodes[i].nodeName=="mi"||result[0].nodeName=="mi"){st=(result[0].nodeName=="mi"?result[0].firstChild.nodeValue:result[0].childNodes[i].firstChild.nodeValue);var newst=[];for(var j=0;j<st.length;j++)
  if(st.charCodeAt(j)>64&&st.charCodeAt(j)<91)newst=newst+
  String.fromCharCode(symbol.codes[st.charCodeAt(j)-65]);else newst=newst+st.charAt(j);if(result[0].nodeName=="mi")
  result[0]=AMcreateElementMathML("mo").appendChild(document.createTextNode(newst));else result[0].replaceChild(AMcreateElementMathML("mo").appendChild(document.createTextNode(newst)),result[0].childNodes[i]);}}
  node=AMcreateMmlNode(symbol.tag,result[0]);node.setAttribute(symbol.atname,symbol.atval);if(symbol.input=="\\scriptstyle"||symbol.input=="\\scriptscriptstyle")
  node.setAttribute("displaystyle","false");return[node,result[1],symbol.tag];}
  case BINARY:result=AMparseSexpr(str);if(result[0]==null)return[AMcreateMmlNode("mo",document.createTextNode(symbol.input)),str,null];result2=AMparseSexpr(result[1]);if(result2[0]==null)return[AMcreateMmlNode("mo",document.createTextNode(symbol.input)),str,null];if(symbol.input=="\\textcolor"||symbol.input=="\\colorbox"){var tclr=str.match(/\{\s*([#\w]+)\s*\}/);str=str.replace(/\{\s*[#\w]+\s*\}/,"");if(tclr!=null){if(IsColorName.test(tclr[1].toLowerCase())){tclr=LaTeXColor[tclr[1].toLowerCase()];}else{tclr=tclr[1];}
  node=AMcreateElementMathML("mstyle");node.setAttribute(symbol.atval,tclr);node.appendChild(result2[0]);return[node,result2[1],symbol.tag];}}
  if(symbol.input=="\\root"||symbol.input=="\\stackrel")newFrag.appendChild(result2[0]);newFrag.appendChild(result[0]);if(symbol.input=="\\frac")newFrag.appendChild(result2[0]);return[AMcreateMmlNode(symbol.tag,newFrag),result2[1],symbol.tag];case INFIX:str=AMremoveCharsAndBlanks(str,symbol.input.length);return[AMcreateMmlNode("mo",document.createTextNode(symbol.output)),str,symbol.tag];default:return[AMcreateMmlNode(symbol.tag,document.createTextNode(symbol.output)),str,symbol.tag];}}
  function AMparseIexpr(str){var symbol,sym1,sym2,node,result,tag,underover;str=AMremoveCharsAndBlanks(str,0);sym1=AMgetSymbol(str);result=AMparseSexpr(str);node=result[0];str=result[1];tag=result[2];symbol=AMgetSymbol(str);if(symbol.ttype==INFIX){str=AMremoveCharsAndBlanks(str,symbol.input.length);result=AMparseSexpr(str);if(result[0]==null)
  result[0]=AMcreateMmlNode("mo",document.createTextNode("\u25A1"));str=result[1];tag=result[2];if(symbol.input=="_"||symbol.input=="^"){sym2=AMgetSymbol(str);tag=null;underover=((sym1.ttype==UNDEROVER)||(node.ttype==UNDEROVER));if(symbol.input=="_"&&sym2.input=="^"){str=AMremoveCharsAndBlanks(str,sym2.input.length);var res2=AMparseSexpr(str);str=res2[1];tag=res2[2];node=AMcreateMmlNode((underover?"munderover":"msubsup"),node);node.appendChild(result[0]);node.appendChild(res2[0]);}else if(symbol.input=="_"){node=AMcreateMmlNode((underover?"munder":"msub"),node);node.appendChild(result[0]);}else{node=AMcreateMmlNode((underover?"mover":"msup"),node);node.appendChild(result[0]);}
  node=AMcreateMmlNode("mrow",node);}else{node=AMcreateMmlNode(symbol.tag,node);if(symbol.input=="\\atop"||symbol.input=="\\choose")
  node.setAttribute("linethickness","0ex");node.appendChild(result[0]);if(symbol.input=="\\choose")
  node=AMcreateMmlNode("mfenced",node);}}
  return[node,str,tag];}
  function AMparseExpr(str,rightbracket,matrix){var symbol,node,result,i,tag,newFrag=document.createDocumentFragment();do{str=AMremoveCharsAndBlanks(str,0);result=AMparseIexpr(str);node=result[0];str=result[1];tag=result[2];symbol=AMgetSymbol(str);if(node!=undefined){if((tag=="mn"||tag=="mi")&&symbol!=null&&typeof symbol.func=="boolean"&&symbol.func){var space=AMcreateElementMathML("mspace");space.setAttribute("width","0.167em");node=AMcreateMmlNode("mrow",node);node.appendChild(space);}
  newFrag.appendChild(node);}}while((symbol.ttype!=RIGHTBRACKET)&&symbol!=null&&symbol.output!="");tag=null;if(symbol.ttype==RIGHTBRACKET){if(symbol.input=="\\right"){str=AMremoveCharsAndBlanks(str,symbol.input.length);symbol=AMgetSymbol(str);if(symbol!=null&&symbol.input==".")
  symbol.invisible=true;if(symbol!=null)
  tag=symbol.rtag;}
  if(symbol!=null)
  str=AMremoveCharsAndBlanks(str,symbol.input.length);var len=newFrag.childNodes.length;if(matrix&&len>0&&newFrag.childNodes[len-1].nodeName=="mrow"&&len>1&&newFrag.childNodes[len-2].nodeName=="mo"&&newFrag.childNodes[len-2].firstChild.nodeValue=="&"){var pos=[];var m=newFrag.childNodes.length;for(i=0;matrix&&i<m;i=i+2){pos[i]=[];node=newFrag.childNodes[i];for(var j=0;j<node.childNodes.length;j++)
  if(node.childNodes[j].firstChild.nodeValue=="&")
  pos[i][pos[i].length]=j;}
  var row,frag,n,k,table=document.createDocumentFragment();for(i=0;i<m;i=i+2){row=document.createDocumentFragment();frag=document.createDocumentFragment();node=newFrag.firstChild;n=node.childNodes.length;k=0;for(j=0;j<n;j++){if(typeof pos[i][k]!="undefined"&&j==pos[i][k]){node.removeChild(node.firstChild);row.appendChild(AMcreateMmlNode("mtd",frag));k++;}else frag.appendChild(node.firstChild);}
  row.appendChild(AMcreateMmlNode("mtd",frag));if(newFrag.childNodes.length>2){newFrag.removeChild(newFrag.firstChild);newFrag.removeChild(newFrag.firstChild);}
  table.appendChild(AMcreateMmlNode("mtr",row));}
  return[table,str];}
  if(typeof symbol.invisible!="boolean"||!symbol.invisible){node=AMcreateMmlNode("mo",document.createTextNode(symbol.output));newFrag.appendChild(node);}}
  return[newFrag,str,tag];}
  function AMparseMath(str){var result,node=AMcreateElementMathML("mstyle");var cclr=str.match(/\\color\s*\{\s*([#\w]+)\s*\}/);str=str.replace(/\\color\s*\{\s*[#\w]+\s*\}/g,"");if(cclr!=null){if(IsColorName.test(cclr[1].toLowerCase())){cclr=LaTeXColor[cclr[1].toLowerCase()];}else{cclr=cclr[1];}
  node.setAttribute("mathcolor",cclr);}else{if(mathcolor!="")node.setAttribute("mathcolor",mathcolor);};if(mathfontfamily!="")node.setAttribute("fontfamily",mathfontfamily);node.appendChild(AMparseExpr(str.replace(/^\s+/g,""),false,false)[0]);node=AMcreateMmlNode("math",node);if(showasciiformulaonhover)
  node.setAttribute("title",str.replace(/\s+/g," "));if(false){var fnode=AMcreateElementXHTML("font");fnode.setAttribute("face",mathfontfamily);fnode.appendChild(node);return fnode;}
  return node;}
  function AMstrarr2docFrag(arr,linebreaks){var newFrag=document.createDocumentFragment();var expr=false;for(var i=0;i<arr.length;i++){if(expr)newFrag.appendChild(AMparseMath(arr[i]));else{var arri=(linebreaks?arr[i].split("\n\n"):[arr[i]]);newFrag.appendChild(AMcreateElementXHTML("span").appendChild(document.createTextNode(arri[0])));for(var j=1;j<arri.length;j++){newFrag.appendChild(AMcreateElementXHTML("p"));newFrag.appendChild(AMcreateElementXHTML("span").appendChild(document.createTextNode(arri[j])));}}
  expr=!expr;}
  return newFrag;}
  function AMprocessNodeR(n,linebreaks){var mtch,str,arr,frg,i;if(n.childNodes.length==0){if((n.nodeType!=8||linebreaks)&&n.parentNode.nodeName!="form"&&n.parentNode.nodeName!="FORM"&&n.parentNode.nodeName!="textarea"&&n.parentNode.nodeName!="TEXTAREA"&&n.parentNode.nodeName!="pre"&&n.parentNode.nodeName!="PRE"){str=n.nodeValue;if(!(str==null)){str=str.replace(/\r\n\r\n/g,"\n\n");str=str.replace(/\x20+/g," ");str=str.replace(/\s*\r\n/g," ");mtch=(str.indexOf("\$")==-1?false:true);str=str.replace(/([^\\])\$/g,"$1 \$");str=str.replace(/^\$/," \$");arr=str.split(" \$");for(i=0;i<arr.length;i++)
  arr[i]=arr[i].replace(/\\\$/g,"\$");if(arr.length>1||mtch){if(checkForMathML){checkForMathML=false;var nd=AMisMathMLavailable();AMnoMathML=nd!=null;if(AMnoMathML&&notifyIfNoMathML)
  if(alertIfNoMathML)
  alert("To view the ASCIIMathML notation use Internet Explorer 6 +\nMathPlayer (free from www.dessci.com)\nor Firefox/Mozilla/Netscape");else AMbody.insertBefore(nd,AMbody.childNodes[0]);}
  if(!AMnoMathML){frg=AMstrarr2docFrag(arr,n.nodeType==8);var len=frg.childNodes.length;n.parentNode.replaceChild(frg,n);return len-1;}else return 0;}}}else return 0;}else if(n.nodeName!="math"){for(i=0;i<n.childNodes.length;i++)
  i+=AMprocessNodeR(n.childNodes[i],linebreaks);}
  return 0;}
  function AMprocessNode(n,linebreaks,spanclassAM){var frag,st;if(spanclassAM!=null){frag=document.getElementsByTagName("span")
  for(var i=0;i<frag.length;i++)
  if(frag[i].className=="AM")
  AMprocessNodeR(frag[i],linebreaks);}else{try{st=n.innerHTML;}catch(err){}
  if(st==null||st.indexOf("\$")!=-1)
  AMprocessNodeR(n,linebreaks);}
  if(isIE){frag=document.getElementsByTagName('math');for(var i=0;i<frag.length;i++)frag[i].update()}}
  var inAppendix=false;var sectionCntr=0;var IEcommentWarning=true;var biblist=[];var bibcntr=0;var LaTeXCounter=[];LaTeXCounter["definition"]=0;LaTeXCounter["proposition"]=0;LaTeXCounter["lemma"]=0;LaTeXCounter["theorem"]=0;LaTeXCounter["corollary"]=0;LaTeXCounter["example"]=0;LaTeXCounter["exercise"]=0;LaTeXCounter["subsection"]=0;LaTeXCounter["subsubsection"]=0;LaTeXCounter["figure"]=0;LaTeXCounter["equation"]=0;LaTeXCounter["table"]=0;var LaTeXColor=[];LaTeXColor["greenyellow"]="#D9FF4F";LaTeXColor["yellow"]="#FFFF00";LaTeXColor["goldenrod"]="#FFE529";LaTeXColor["dandelion"]="#FFB529";LaTeXColor["apricot"]="#FFAD7A";LaTeXColor["peach"]="#FF804D";LaTeXColor["melon"]="#FF8A80";LaTeXColor["yelloworange"]="#FF9400";LaTeXColor["orange"]="#FF6321";LaTeXColor["burntorange"]="#FF7D00";LaTeXColor["bittersweet"]="#C20300";LaTeXColor["redorange"]="#FF3B21";LaTeXColor["mahogany"]="#A60000";LaTeXColor["maroon"]="#AD0000";LaTeXColor["brickred"]="#B80000";LaTeXColor["red"]="#FF0000";LaTeXColor["orangered"]="#FF0080";LaTeXColor["rubinered"]="#FF00DE";LaTeXColor["wildstrawberry"]="#FF0A9C";LaTeXColor["salmon"]="#FF789E";LaTeXColor["carnationpink"]="#FF5EFF";LaTeXColor["magenta"]="#FF00FF";LaTeXColor["violetred"]="#FF30FF";LaTeXColor["rhodamine"]="#FF2EFF";LaTeXColor["mulberry"]="#A314FA";LaTeXColor["redviolet"]="#9600A8";LaTeXColor["fuchsia"]="#7303EB";LaTeXColor["lavender"]="#FF85FF";LaTeXColor["thistle"]="#E069FF";LaTeXColor["orchid"]="#AD5CFF";LaTeXColor["darkorchid"]="#9933CC";LaTeXColor["purple"]="#8C24FF";LaTeXColor["plum"]="#8000FF";LaTeXColor["violet"]="#361FFF";LaTeXColor["royalpurple"]="#401AFF";LaTeXColor["blueviolet"]="#1A0DF5";LaTeXColor["periwinkle"]="#6E73FF";LaTeXColor["cadetblue"]="#616EC4";LaTeXColor["cornflowerblue"]="#59DEFF";LaTeXColor["midnightblue"]="#007091";LaTeXColor["navyblue"]="#0F75FF";LaTeXColor["royalblue"]="#0080FF";LaTeXColor["blue"]="#0000FF";LaTeXColor["cerulean"]="#0FE3FF";LaTeXColor["cyan"]="#00FFFF";LaTeXColor["processblue"]="#0AFFFF";LaTeXColor["skyblue"]="#61FFE0";LaTeXColor["turquoise"]="#26FFCC";LaTeXColor["tealblue"]="#1FFAA3";LaTeXColor["aquamarine"]="#2EFFB2";LaTeXColor["bluegreen"]="#26FFAB";LaTeXColor["emerald"]="#00FF80";LaTeXColor["junglegreen"]="#03FF7A";LaTeXColor["seagreen"]="#4FFF80";LaTeXColor["green"]="#00FF00";LaTeXColor["forestgreen"]="#00E000";LaTeXColor["pinegreen"]="#00BF29";LaTeXColor["limegreen"]="#80FF00";LaTeXColor["yellowgreen"]="#8FFF42";LaTeXColor["springgreen"]="#BDFF3D";LaTeXColor["olivegreen"]="#009900";LaTeXColor["rawsienna"]="#8C0000";LaTeXColor["sepia"]="#4D0000";LaTeXColor["brown"]="#660000";LaTeXColor["tan"]="#DB9470";LaTeXColor["gray"]="#808080";LaTeXColor["grey"]="#808080";LaTeXColor["black"]="#000000";LaTeXColor["white"]="#FFFFFF";var IsColorName=/^(?:greenyellow|yellow|goldenrod|dandelion|apricot|peach|melon|yelloworange|orange|burntorange|bittersweet|redorange|mahogany|maroon|brickred|red|orangered|rubinered|wildstrawberry|salmon|carnationpink|magenta|violetred|rhodamine|mulberry|redviolet|fuchsia|lavender|thistle|orchid|darkorchid|purple|plum|violet|royalpurple|blueviolet|periwinkle|cadetblue|cornflowerblue|midnightblue|navyblue|royalblue|blue|cerulean|cyan|processblue|skyblue|turquoise|tealblue|aquamarine|bluegreen|emerald|junglegreen|seagreen|green|forestgreen|pinegreen|limegreen|yellowgreen|springgreen|olivegreen|rawsienna|sepia|brown|tan|gray|grey|black|white)$/;var IsCounter=/^(?:definition|proposition|lemma|theorem|corollary|example|exercise|subsection|subsubsection|figure|equation|table)$/;var IsLaTeXElement=/^(?:displayequation|title|author|address|date|abstract|keyword|section|subsection|subsubsection|ref|cite|thebibliography|definition|proposition|lemma|theorem|corollary|example|exercise|itemize|enumerate|enddefinition|endproposition|endlemma|endtheorem|endcorollary|endexample|endexercise|enditemize|endenumerate|LaTeXMathMLlabel|LaTeXMathML|smallskip|medskip|bigskip|quote|quotation|endquote|endquotation|center|endcenter|description|enddescription|inlinemath)$/;var IsTextOnlyArea=/^(?:form|textarea|pre)$/i;var tableid=0;function makeNumberString(cntr){if(sectionCntr>0){if(inAppendix){return"A"+sectionCntr+"."+cntr;}else{return sectionCntr+"."+cntr;}}else{return""+cntr;}};function LaTeXpreProcess(thebody){var TheBody=thebody;if(TheBody.hasChildNodes()){if(!(IsLaTeXElement.test(TheBody.className)))
  {for(var i=0;i<TheBody.childNodes.length;i++){LaTeXpreProcess(TheBody.childNodes[i])}}}
  else{if(TheBody.nodeType==3&&!(IsTextOnlyArea.test(TheBody.parentNode.nodeName)))
  {var str=TheBody.nodeValue;if(!(str==null)){str=str.replace(/\\%/g,"<per>");str=str.replace(/%[^\n]*(?=\n)/g,"");str=str.replace(/%[^\r]*(?=\r)/g,"");str=str.replace(/%[^\n]*$/,"")
  if(isIE&&str.match(/%/g)!=null&&IEcommentWarning){alert("Comments may not have parsed properly.  Try putting in <pre class='LaTeX><div>..</div></pre> structure.");IEcommentWarning=false;}
  str=str.replace(/<per>/g,"%");if(str.match(/XXX[\s\S]*/)!=null){var tmp=str.match(/XXX[\s\S]*/)[0];var tmpstr=tmp.charCodeAt(7)+"::"+tmp.charCodeAt(8)+"::"+tmp.charCodeAt(9)+"::"+tmp.charCodeAt(10)+"::"+tmp.charCodeAt(11)+"::"+tmp.charCodeAt(12)+"::"+tmp.charCodeAt(13);alert(tmpstr);}
  str=str.replace(/([^\\])\\(\s)/g,"$1\u00A0$2");str=str.replace(/\\quad/g,"\u2001");str=str.replace(/\\qquad/g,"\u2001\u2001");str=str.replace(/\\enspace/g,"\u2002");str=str.replace(/\\;/g,"\u2004");str=str.replace(/\\:/g,"\u2005");str=str.replace(/\\,/g,"\u2006");str=str.replace(/\\thinspace/g,"\u200A");str=str.replace(/([^\\])~/g,"$1\u00A0");str=str.replace(/\\~/g,"~");str=str.replace(/\\\[/g," <DEQ> $\\displaystyle{");str=str.replace(/\\\]/g,"}$ <DEQ> ");str=str.replace(/\$\$/g,"${$<DEQ>$}$");str=str.replace(/\\begin\s*\{\s*array\s*\}/g,"\\begin{array}");str=str.replace(/\\end\s*\{\s*array\s*\}/g,"\\end{array}");str=str.replace(/\\begin\s*\{\s*eqnarray\s*\}/g,"  <DEQ>eqno$\\begin{eqnarray}");str=str.replace(/\\end\s*\{\s*eqnarray\s*\}/g,"\\end{eqnarray}$<DEQ>  ");str=str.replace(/\\begin\s*\{\s*eqnarray\*\s*\}/g,"  <DEQ>$\\begin{eqnarray}");str=str.replace(/\\end\s*\{\s*eqnarray\*\s*\}/g,"\\end{eqnarray}$<DEQ>  ");str=str.replace(/\\begin\s*\{\s*displaymath\s*\}/g," <DEQ> $\\displaystyle{");str=str.replace(/\\end\s*\{\s*displaymath\s*\}/g,"}$ <DEQ> ");str=str.replace(/\\begin\s*\{\s*equation\s*\*\s*\}/g," <DEQ> $\\displaystyle{");str=str.replace(/\\end\s*\{\s*equation\s*\*\s*\}/g,"}$ <DEQ> ");str=str.replace(/\\begin\s*\{\s*equation\s*\}/g," <DEQ>eqno$\\displaystyle{");str=str.replace(/\\end\s*\{\s*equation\s*\}/g,"}$ <DEQ> ");str=str.split("<DEQ>");var newFrag=document.createDocumentFragment();for(var i=0;i<str.length;i++){if(i%2){var DEQtable=document.createElement("table");DEQtable.className='displayequation';var DEQtbody=document.createElement("tbody");var DEQtr=document.createElement("tr");var DEQtdeq=document.createElement("td");DEQtdeq.className='eq';str[i]=str[i].replace(/\$\}\$/g,"$\\displaystyle{");str[i]=str[i].replace(/\$\{\$/g,"}");var lbl=str[i].match(/\\label\s*\{\s*(\w+)\s*\}/);var ISeqno=str[i].match(/^eqno/);str[i]=str[i].replace(/^eqno/," ");str[i]=str[i].replace(/\\label\s*\{\s*\w+\s*\}/," ");DEQtdeq.appendChild(document.createTextNode(str[i]));DEQtr.appendChild(DEQtdeq);str[i]=str[i].replace(/\\nonumber/g,"");if(ISeqno!=null||lbl!=null){var DEQtdno=document.createElement("td");DEQtdno.className='eqno';LaTeXCounter["equation"]++;var eqnoString=makeNumberString(LaTeXCounter["equation"]);var DEQanchor=document.createElement("a");if(lbl!=null){DEQanchor.id=lbl[1]};DEQanchor.className="eqno";var anchorSpan=document.createElement("span");anchorSpan.className="eqno";anchorSpan.style.display="none";anchorSpan.appendChild(document.createTextNode(eqnoString));DEQanchor.appendChild(anchorSpan);DEQtdno.appendChild(DEQanchor);var DEQspan=document.createElement("span");DEQspan.className="eqno";DEQspan.appendChild(document.createTextNode("("+eqnoString+")"));DEQtdno.appendChild(DEQspan);DEQtr.appendChild(DEQtdno);}
  DEQtbody.appendChild(DEQtr);DEQtable.appendChild(DEQtbody);newFrag.appendChild(DEQtable);}
  else{str[i]=str[i].replace(/\$\}\$/g,"");str[i]=str[i].replace(/\$\{\$/g,"");str[i]=str[i].replace(/\\maketitle/g,"");str[i]=str[i].replace(/\\begin\s*\{\s*document\s*\}/g,"");str[i]=str[i].replace(/\\end\s*\{\s*document\s*\}/g,"");str[i]=str[i].replace(/\\documentclass[^\}]*?\}/g,"");str[i]=str[i].replace(/\\usepackage[^\}]*?\}/g,"");str[i]=str[i].replace(/\\noindent/g,"");str[i]=str[i].replace(/\\notag/g,"");str[i]=str[i].replace(/\\ref\s*\{\s*(\w+)\}/g," \\[ref\\]$1\\[ ");str[i]=str[i].replace(/\\url\s*\{\s*([^\}\n]+)\}/g," \\[url\\]$1\\[ ");str[i]=str[i].replace(/\\href\s*\{\s*([^\}]+)\}\s*\{\s*([^\}]+)\}/g," \\[href\\]$1\\]$2\\[ ");str[i]=str[i].replace(/\\cite\s*\{\s*(\w+)\}/g," \\[cite\\]$1\\[ ");str[i]=str[i].replace(/\\qed/g,"\u220E");str[i]=str[i].replace(/\\endproof/g,"\u220E");str[i]=str[i].replace(/\\proof/g,"\\textbf{Proof: }");str[i]=str[i].replace(/\\n(?=\s)/g," \\[br\\] \\[ ");str[i]=str[i].replace(/\\newline/g," \\[br\\] \\[ ");str[i]=str[i].replace(/\\linebreak/g," \\[br\\] \\[ ");str[i]=str[i].replace(/\\smallskip/g," \\[logicalbreak\\]smallskip\\[ ");str[i]=str[i].replace(/\\medskip/g," \\[logicalbreak\\]medskip\\[ ");str[i]=str[i].replace(/\\bigskip/g," \\[logicalbreak\\]bigskip\\[ ");str[i]=str[i].replace(/[\n\r]+[ \f\n\r\t\v\u2028\u2029]*[\n\r]+/g," \\[logicalbreak\\]LaTeXMathML\\[ ");if(isIE){str[i]=str[i].replace(/\r/g," ");}
  str[i]=str[i].replace(/\\bibitem\s*([^\{]*\{\s*\w*\s*\})/g," \\[bibitem\\]$1\\[ ");str[i]=str[i].replace(/\\bibitem\s*/g," \\[bibitem\\] \\[ ");str[i]=str[i].replace(/\\item\s*\[\s*(\w+)\s*\]/g," \\[alistitem\\]$1\\[ ");str[i]=str[i].replace(/\\item\s*/g," \\[alistitem\\] \\[ ");str[i]=str[i].replace(/\\appendix/g," \\[appendix\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*figure\s*\}([\s\S]+?)\\end\s*\{\s*figure\s*\}/g," \\[figure\\]$1\\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*table\s*\}([\s\S]+?)\\end\s*\{\s*table\s*\}/g," \\[table\\]$1\\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*theorem\s*\}/g," \\[theorem\\]Theorem \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*theorem\s*\}/g," \\[endtheorem\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*definition\s*\}/g," \\[definition\\]Definition \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*definition\s*\}/g," \\[enddefinition\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*lemma\s*\}/g," \\[lemma\\]Lemma \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*lemma\s*\}/g," \\[endlemma\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*corollary\s*\}/g," \\[corollary\\]Corollary \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*corollary\s*\}/g," \\[endcorollary\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*proposition\s*\}/g," \\[proposition\\]Proposition \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*proposition\s*\}/g," \\[endproposition\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*example\s*\}/g," \\[example\\]Example \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*example\s*\}/g," \\[endexample\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*exercise\s*\}/g," \\[exercise\\]Exercise \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*exercise\s*\}/g," \\[endexercise\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*thebibliography\s*\}\s*\{\s*\w+\s*\}/g," \\[thebibliography\\]References \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*thebibliography\s*\}/g," \\[thebibliography\\]References \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*thebibliography\s*\}/g," \\[endthebibliography\\]References \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*proof\s*\}/g," \\[proof\\]Proof: \\[ ");if(isIE){str[i]=str[i].replace(/\\end\s*\{\s*proof\s*\}/g,"\u220E \\[endproof\\] \\[ ");}else{str[i]=str[i].replace(/\\end\s*\{\s*proof\s*\}/g," \\[endproof\\] \\[ ");}
  str[i]=str[i].replace(/\\title\s*\{\s*([^\}]+)\}/g," \\[title\\] \\[$1 \\[endtitle\\] \\[ ");str[i]=str[i].replace(/\\author\s*\{\s*([^\}]+)\}/g," \\[author\\] \\[$1 \\[endauthor\\] \\[ ");str[i]=str[i].replace(/\\address\s*\{\s*([^\}]+)\}/g," \\[address\\] \\[$1 \\[endaddress\\] \\[ ");str[i]=str[i].replace(/\\date\s*\{\s*([^\}]+)\}/g," \\[date\\] \\[$1 \\[enddate\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*keyword\s*\}/g," \\[keyword\\] \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*keyword\s*\}/g," \\[endkeyword\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*abstract\s*\}/g," \\[abstract\\] \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*abstract\s*\}/g," \\[endabstract\\] \\[ ");str[i]=str[i].replace(/\\begin\s*\{\s*(?!array|tabular)(\w+)\s*\}/g," \\[$1\\] \\[ ");str[i]=str[i].replace(/\\end\s*\{\s*(?!array|tabular)(\w+)\s*\}/g," \\[end$1\\] \\[ ");var sectionIndex=str[i].search(/\\section\s*\{\s*[\s\S]+\}/);while(sectionIndex>=0){str[i]=str[i].replace(/\\section\s*\{/," \\[section\\]");var delimcnt=1;for(var ii=sectionIndex;ii<str[i].length;ii++){if(str[i].charAt(ii)=="{"){delimcnt++};if(str[i].charAt(ii)=="}"){delimcnt--};if(delimcnt==0){str[i]=str[i].substring(0,ii)+"\\[ "+str[i].substring(ii+1,str[i].length);break;}};sectionIndex=str[i].search(/\\section\s*\{\s*[\s\S]+\}/);}
  sectionIndex=str[i].search(/\\subsection\s*\{\s*[\s\S]+\}/);while(sectionIndex>=0){str[i]=str[i].replace(/\\subsection\s*\{/," \\[subsection\\]");var delimcnt=1;for(var ii=sectionIndex;ii<str[i].length;ii++){if(str[i].charAt(ii)=="{"){delimcnt++};if(str[i].charAt(ii)=="}"){delimcnt--};if(delimcnt==0){str[i]=str[i].substring(0,ii)+"\\[ "+str[i].substring(ii+1,str[i].length);break;}};sectionIndex=str[i].search(/\\subsection\s*\{\s*[\s\S]+\}/);}
  sectionIndex=str[i].search(/\\subsubsection\s*\{\s*[\s\S]+\}/);while(sectionIndex>=0){str[i]=str[i].replace(/\\subsubsection\s*\{/," \\[subsubsection\\]");var delimcnt=1;for(var ii=sectionIndex;ii<str[i].length;ii++){if(str[i].charAt(ii)=="{"){delimcnt++};if(str[i].charAt(ii)=="}"){delimcnt--};if(delimcnt==0){str[i]=str[i].substring(0,ii)+"\\[ "+str[i].substring(ii+1,str[i].length);break;}};sectionIndex=str[i].search(/\\subsubsection\s*\{\s*[\s\S]+\}/);}
  var CatToNextEven="";var strtmp=str[i].split("\\[");for(var j=0;j<strtmp.length;j++){if(j%2){var strtmparray=strtmp[j].split("\\]");switch(strtmparray[0]){case"section":var nodeTmp=document.createElement("H2");nodeTmp.className='section';sectionCntr++;for(var div in LaTeXCounter){LaTeXCounter[div]=0};var nodeAnchor=document.createElement("a");if(inAppendix){nodeAnchor.className='appendixsection';}else{nodeAnchor.className='section';}
  var nodeNumString=makeNumberString("");var anchorSpan=document.createElement("span");anchorSpan.className="section";anchorSpan.style.display="none";anchorSpan.appendChild(document.createTextNode(nodeNumString));nodeAnchor.appendChild(anchorSpan);nodeTmp.appendChild(nodeAnchor);var nodeSpan=document.createElement("span");nodeSpan.className='section';nodeSpan.appendChild(document.createTextNode(nodeNumString+" "));nodeTmp.appendChild(nodeSpan);nodeTmp.appendChild(document.createTextNode(strtmparray[1]));newFrag.appendChild(nodeTmp);break;case"subsection":var nodeTmp=document.createElement("H3");nodeTmp.className='subsection';LaTeXCounter["subsection"]++;LaTeXCounter["subsubsection"]=0;var nodeAnchor=document.createElement("a");nodeAnchor.className='subsection';var nodeNumString=makeNumberString(LaTeXCounter["subsection"]);var anchorSpan=document.createElement("span");anchorSpan.className="subsection";anchorSpan.style.display="none";anchorSpan.appendChild(document.createTextNode(nodeNumString));nodeAnchor.appendChild(anchorSpan);nodeTmp.appendChild(nodeAnchor);var nodeSpan=document.createElement("span");nodeSpan.className='subsection';nodeSpan.appendChild(document.createTextNode(nodeNumString+". "));nodeTmp.appendChild(nodeSpan);nodeTmp.appendChild(document.createTextNode(strtmparray[1]));newFrag.appendChild(nodeTmp);break;case"subsubsection":var nodeTmp=document.createElement("H4");nodeTmp.className='subsubsection';LaTeXCounter["subsubsection"]++;var nodeAnchor=document.createElement("a");nodeAnchor.className='subsubsection';var nodeNumString=makeNumberString(LaTeXCounter["subsection"]+"."+LaTeXCounter["subsubsection"]);var anchorSpan=document.createElement("span");anchorSpan.className="subsubsection";anchorSpan.style.display="none";anchorSpan.appendChild(document.createTextNode(nodeNumString));nodeAnchor.appendChild(anchorSpan);nodeTmp.appendChild(nodeAnchor);var nodeSpan=document.createElement("span");nodeSpan.className='subsubsection';nodeSpan.appendChild(document.createTextNode(nodeNumString+". "));nodeTmp.appendChild(nodeSpan);nodeTmp.appendChild(document.createTextNode(strtmparray[1]));newFrag.appendChild(nodeTmp);break;case"href":var nodeTmp=document.createElement("a");nodeTmp.className='LaTeXMathML';nodeTmp.href=strtmparray[1];nodeTmp.appendChild(document.createTextNode(strtmparray[2]));newFrag.appendChild(nodeTmp);break;case"url":var nodeTmp=document.createElement("a");nodeTmp.className='LaTeXMathML';nodeTmp.href=strtmparray[1];nodeTmp.appendChild(document.createTextNode(strtmparray[1]));newFrag.appendChild(nodeTmp);break;case"figure":var nodeTmp=document.createElement("table");nodeTmp.className='figure';var FIGtbody=document.createElement("tbody");var FIGlbl=strtmparray[1].match(/\\label\s*\{\s*(\w+)\s*\}/);strtmparray[1]=strtmparray[1].replace(/\\label\s*\{\w+\}/g,"");var capIndex=strtmparray[1].search(/\\caption\s*\{[\s\S]+\}/);var FIGcap="";if(capIndex>=0){var tmp=strtmparray[1];var delimcnt=0;var capstart=-1;for(var pos=capIndex;pos<tmp.length;pos++){if(tmp.charAt(pos)=="{"){delimcnt++};if(tmp.charAt(pos)=="}"){delimcnt--};if(delimcnt==1&&capstart<0){capstart=pos+1};if(delimcnt==0&&capstart>0){capend=pos-1;FIGcap=tmp.substring(capstart,pos);break}}}
  var FIGtr2=document.createElement("tr");var FIGtd2=document.createElement("td");FIGtd2.className="caption";var FIGanchor=document.createElement("a");FIGanchor.className="figure";if(FIGlbl!=null){FIGanchor.id=FIGlbl[1];}
  LaTeXCounter["figure"]++;var fignmbr=makeNumberString(LaTeXCounter["figure"]);var anchorSpan=document.createElement("span");anchorSpan.className="figure";anchorSpan.style.display="none";anchorSpan.appendChild(document.createTextNode(fignmbr));FIGanchor.appendChild(anchorSpan);FIGtd2.appendChild(FIGanchor);var FIGspan=document.createElement("span");FIGspan.className="figure";FIGspan.appendChild(document.createTextNode("Figure "+fignmbr+". "));FIGtd2.appendChild(FIGspan);FIGtd2.appendChild(document.createTextNode(""+FIGcap));FIGtr2.appendChild(FIGtd2);FIGtbody.appendChild(FIGtr2);var IsSpecial=false;var FIGinfo=strtmparray[1].match(/\\includegraphics\s*\{([^\}]+)\}/);if(FIGinfo==null){FIGinfo=strtmparray[1].match(/\\includegraphics\s*\[[^\]]*\]\s*\{\s*([^\}]+)\s*\}/);}
  if(FIGinfo==null){FIGinfo=strtmparray[1].match(/\\special\s*\{\s*([^\}]+)\}/);IsSpecial=true};if(FIGinfo!=null){var FIGtr1=document.createElement("tr");var FIGtd1=document.createElement("td");FIGtd1.className="image";var FIGimg=document.createElement("img");var FIGsrc=FIGinfo[1];FIGimg.src=FIGsrc;FIGimg.alt="Figure "+FIGsrc+" did not load";FIGimg.title="Figure "+fignmbr+". "+FIGcap;FIGimg.id="figure"+fignmbr;FIGtd1.appendChild(FIGimg);FIGtr1.appendChild(FIGtd1);FIGtbody.appendChild(FIGtr1);}
  nodeTmp.appendChild(FIGtbody);newFrag.appendChild(nodeTmp);break;case"table":var nodeTmp=document.createElement("table");if(strtmparray[1].search(/\\centering/)>=0){nodeTmp.className='LaTeXtable centered';nodeTmp.align="center";}else{nodeTmp.className='LaTeXtable';};tableid++;nodeTmp.id="LaTeXtable"+tableid;var TABlbl=strtmparray[1].match(/\\label\s*\{\s*(\w+)\s*\}/);strtmparray[1]=strtmparray[1].replace(/\\label\s*\{\w+\}/g,"");var capIndex=strtmparray[1].search(/\\caption\s*\{[\s\S]+\}/);var TABcap="";if(capIndex>=0){var tmp=strtmparray[1];var delimcnt=0;var capstart=-1;for(var pos=capIndex;pos<tmp.length;pos++){if(tmp.charAt(pos)=="{"){delimcnt++};if(tmp.charAt(pos)=="}"){delimcnt--};if(delimcnt==1&&capstart<0){capstart=pos+1};if(delimcnt==0&&capstart>0){capend=pos-1;TABcap=tmp.substring(capstart,pos);break}}}
  if(TABcap!=""){var TABtbody=document.createElement("tbody");var TABcaption=document.createElement("caption");TABcaption.className="LaTeXtable centered";var TABanchor=document.createElement("a");TABanchor.className="LaTeXtable";if(TABlbl!=null){TABanchor.id=TABlbl[1];}
  LaTeXCounter["table"]++;var tabnmbr=makeNumberString(LaTeXCounter["table"]);var anchorSpan=document.createElement("span");anchorSpan.className="LaTeXtable";anchorSpan.style.display="none";anchorSpan.appendChild(document.createTextNode(tabnmbr));TABanchor.appendChild(anchorSpan);TABcaption.appendChild(TABanchor);var TABspan=document.createElement("span");TABspan.className="LaTeXtable";TABspan.appendChild(document.createTextNode("Table "+tabnmbr+". "));TABcaption.appendChild(TABspan);TABcaption.appendChild(document.createTextNode(""+TABcap));nodeTmp.appendChild(TABcaption);}
  var TABinfo=strtmparray[1].match(/\\begin\s*\{\s*tabular\s*\}([\s\S]+)\\end\s*\{\s*tabular\s*\}/);if(TABinfo!=null){var TABtbody=document.createElement('tbody');var TABrow=null;var TABcell=null;var row=0;var col=0;var TABalign=TABinfo[1].match(/^\s*\{([^\}]+)\}/);TABinfo=TABinfo[1].replace(/^\s*\{[^\}]+\}/,"");TABinfo=TABinfo.replace(/\\hline/g,"");TABalign[1]=TABalign[1].replace(/\|/g,"");TABalign[1]=TABalign[1].replace(/\s/g,"");TABinfo=TABinfo.split("\\\\");for(row=0;row<TABinfo.length;row++){TABrow=document.createElement("tr");TABinfo[row]=TABinfo[row].split("&");for(col=0;col<TABinfo[row].length;col++){TABcell=document.createElement("td");switch(TABalign[1].charAt(col)){case"l":TABcell.align="left";break;case"c":TABcell.align="center";break;case"r":TABcell.align="right";break;default:TABcell.align="left";};TABcell.appendChild(document.createTextNode(TABinfo[row][col]));TABrow.appendChild(TABcell);}
  TABtbody.appendChild(TABrow);}
  nodeTmp.appendChild(TABtbody);}
  newFrag.appendChild(nodeTmp);break;case"logicalbreak":var nodeTmp=document.createElement("p");nodeTmp.className=strtmparray[1];nodeTmp.appendChild(document.createTextNode("\u00A0"));newFrag.appendChild(nodeTmp);break;case"appendix":inAppendix=true;sectionCntr=0;break;case"alistitem":var EndDiv=document.createElement("div");EndDiv.className="endlistitem";newFrag.appendChild(EndDiv);var BegDiv=document.createElement("div");BegDiv.className="listitem";if(strtmparray[1]!=" "){var BegSpan=document.createElement("span");BegSpan.className="listitemmarker";var boldBegSpan=document.createElement("b");boldBegSpan.appendChild(document.createTextNode(strtmparray[1]+" "));BegSpan.appendChild(boldBegSpan);BegDiv.appendChild(BegSpan);}
  newFrag.appendChild(BegDiv);break;case"br":newFrag.appendChild(document.createElement("br"));break;case"bibitem":newFrag.appendChild(document.createElement("br"));var nodeTmp=document.createElement("a");nodeTmp.className='bibitem';var nodeSpan=document.createElement("span");nodeSpan.className='bibitem';bibcntr++;var lbl=strtmparray[1].match(/\{\s*(\w+)\s*\}/);strtmparray[1]=strtmparray[1].replace(/\s*\{\s*\w+\s*\}/g,"");strtmparray[1]=strtmparray[1].replace(/^\s*\[/,"");strtmparray[1]=strtmparray[1].replace(/\s*\]$/,"");strtmparray[1]=strtmparray[1].replace(/^\s+|\s+$/g,"");if(lbl==null){biblist[bibcntr]="bibitem"+bibcntr}else{biblist[bibcntr]=lbl[1];};nodeTmp.name=biblist[bibcntr];nodeTmp.id=biblist[bibcntr];if(strtmparray[1]!=""){nodeSpan.appendChild(document.createTextNode(strtmparray[1]));}else{nodeSpan.appendChild(document.createTextNode("["+bibcntr+"]"));}
  nodeTmp.appendChild(nodeSpan);newFrag.appendChild(nodeTmp);break;case"cite":var nodeTmp=document.createElement("a");nodeTmp.className='cite';nodeTmp.name='cite';nodeTmp.href="#"+strtmparray[1];newFrag.appendChild(nodeTmp);break;case"ref":var nodeTmp=document.createElement("a");nodeTmp.className='ref';nodeTmp.name='ref';nodeTmp.href="#"+strtmparray[1];newFrag.appendChild(nodeTmp);break;default:var nodeTmp=document.createElement("div");nodeTmp.className=strtmparray[0];if(IsCounter.test(strtmparray[0])){LaTeXCounter[strtmparray[0]]++;var nodeAnchor=document.createElement("a");nodeAnchor.className=strtmparray[0];var divnum=makeNumberString(LaTeXCounter[strtmparray[0]]);var anchorSpan=document.createElement("span");anchorSpan.className=strtmparray[0];anchorSpan.appendChild(document.createTextNode(divnum));anchorSpan.style.display="none";nodeAnchor.appendChild(anchorSpan);nodeTmp.appendChild(nodeAnchor);var nodeSpan=document.createElement("span");nodeSpan.className=strtmparray[0];nodeSpan.appendChild(document.createTextNode(strtmparray[1]+" "+divnum+". "));nodeTmp.appendChild(nodeSpan);}
  if(isIE){if(strtmparray[0]==("thebibliography"||"abstract"||"keyword"||"proof")){var nodeSpan=document.createElement("span");nodeSpan.className=strtmparray[0];nodeSpan.appendChild(document.createTextNode(strtmparray[1]));nodeTmp.appendChild(nodeSpan);}}
  if(strtmparray[0]=="endenumerate"||strtmparray[0]=="enditemize"||strtmparray[0]=="enddescription"){var endDiv=document.createElement("div");endDiv.className="endlistitem";newFrag.appendChild(endDiv);}
  newFrag.appendChild(nodeTmp);if(strtmparray[0]=="enumerate"||strtmparray[0]=="itemize"||strtmparray[0]=="description"){var endDiv=document.createElement("div");endDiv.className="listitem";newFrag.appendChild(endDiv);}}}else{strtmp[j]=strtmp[j].replace(/\\\$/g,"<per>");strtmp[j]=strtmp[j].replace(/\$([^\$]+)\$/g," \\[$1\\[ ");strtmp[j]=strtmp[j].replace(/<per>/g,"\\$");strtmp[j]=strtmp[j].replace(/\\begin\s*\{\s*math\s*\}([\s\S]+?)\\end\s*\{\s*math\s*\}/g," \\[$1\\[ ");var strtmptmp=strtmp[j].split("\\[");for(var jjj=0;jjj<strtmptmp.length;jjj++){if(jjj%2){var nodeTmp=document.createElement("span");nodeTmp.className='inlinemath';nodeTmp.appendChild(document.createTextNode("$"+strtmptmp[jjj]+"$"));newFrag.appendChild(nodeTmp);}else{var TagIndex=strtmptmp[jjj].search(/\\\w+/);var tmpIndex=TagIndex;while(tmpIndex>-1){if(/^\\textcolor/.test(strtmptmp[jjj].substring(TagIndex,strtmptmp[jjj].length))){strtmptmp[jjj]=strtmptmp[jjj].replace(/\\textcolor\s*\{\s*(\w+)\s*\}\s*/," \\[textcolor\\]$1\\]|");}else{if(/^\\colorbox/.test(strtmptmp[jjj].substring(TagIndex,strtmptmp[jjj].length))){strtmptmp[jjj]=strtmptmp[jjj].replace(/\\colorbox\s*\{\s*(\w+)\s*\}\s*/," \\[colorbox\\]$1\\]|");}else{strtmptmp[jjj]=strtmptmp[jjj].substring(0,TagIndex)+strtmptmp[jjj].substring(TagIndex,strtmptmp[jjj].length).replace(/\\\s*(\w+)\s*/," \\[$1\\]|");}}
  TagIndex+=strtmptmp[jjj].substring(TagIndex,strtmptmp[jjj].length).search(/\|/);TagIndex++;strtmptmp[jjj]=strtmptmp[jjj].replace(/\\\]\|/,"\\] ");if(strtmptmp[jjj].charAt(TagIndex)=="{"){strtmptmp[jjj]=strtmptmp[jjj].substring(0,TagIndex)+strtmptmp[jjj].substring(TagIndex+1,strtmptmp[jjj].length);var delimcnt=1;for(var kk=TagIndex;kk<strtmptmp[jjj].length;kk++){if(strtmptmp[jjj].charAt(kk)=="{"){delimcnt++};if(strtmptmp[jjj].charAt(kk)=="}"){delimcnt--};if(delimcnt==0){break;}}
  strtmptmp[jjj]=strtmptmp[jjj].substring(0,kk)+"\\[ "+strtmptmp[jjj].substring(kk+1,strtmptmp[jjj].length);TagIndex=kk+3;}else{strtmptmp[jjj]=strtmptmp[jjj].substring(0,TagIndex)+"\\[ "+strtmptmp[jjj].substring(TagIndex+1,strtmptmp[jjj].length);TagIndex=TagIndex+3;}
  if(TagIndex<strtmptmp[jjj].length){tmpIndex=strtmptmp[jjj].substring(TagIndex,strtmptmp[jjj].length).search(/\\\w+/);}
  else{tmpIndex=-1};TagIndex+=tmpIndex;}
  strtmptmp[jjj]=strtmptmp[jjj].replace(/\\\\\s*\\\\/g,"\\\\");strtmptmp[jjj]=strtmptmp[jjj].replace(/\\\\/g," \\[br\\] \\[ ");strtmptmp[jjj]=strtmptmp[jjj].replace(/\\label\s*\{\s*(\w+)\s*\}/g," \\[a\\]$1\\[ ");var strlbls=strtmptmp[jjj].split("\\[");for(var jj=0;jj<strlbls.length;jj++){if(jj%2){var strtmparray=strlbls[jj].split("\\]");switch(strtmparray[0]){case"textcolor":var nodeTmp=document.createElement("span");nodeTmp.className='LaTeXColor';if(IsColorName.test(strtmparray[1].toLowerCase())){nodeTmp.style.color=LaTeXColor[strtmparray[1].toLowerCase()];}else{nodeTmp.style.color=strtmparray[1];};nodeTmp.appendChild(document.createTextNode(strtmparray[2]));newFrag.appendChild(nodeTmp);break;case"colorbox":var nodeTmp=document.createElement("span");nodeTmp.className='LaTeXColor';if(IsColorName.test(strtmparray[1].toLowerCase())){nodeTmp.style.background=LaTeXColor[strtmparray[1].toLowerCase()];}else{nodeTmp.style.background=strtmparray[1];};nodeTmp.appendChild(document.createTextNode(strtmparray[2]));newFrag.appendChild(nodeTmp);break;case"br":newFrag.appendChild(document.createElement("br"));break;case"a":var nodeTmp=document.createElement("a");nodeTmp.className='LaTeXMathMLlabel';nodeTmp.id=strtmparray[1];nodeTmp.style.display="none";newFrag.appendChild(nodeTmp);break;default:var nodeTmp=document.createElement("span");nodeTmp.className=strtmparray[0];nodeTmp.appendChild(document.createTextNode(strtmparray[1]))
  newFrag.appendChild(nodeTmp);}}else{newFrag.appendChild(document.createTextNode(strlbls[jj]));}}}}}}}};TheBody.parentNode.replaceChild(newFrag,TheBody);}}}
  return TheBody;}
  function LaTeXDivsAndRefs(thebody){var TheBody=thebody;var EndDivClass=null;var AllDivs=TheBody.getElementsByTagName("div");var lbl2id="";var lblnode=null;for(var i=AllDivs.length-1;i>=0;i--){EndDivClass=AllDivs[i].className.match(/end\w+/);if(EndDivClass!=null){EndDivClass=EndDivClass[0];var DivClass=EndDivClass.substring(3,EndDivClass.length);var EndDivNode=AllDivs[i];break;}}
  while(EndDivClass!=null){var newFrag=document.createDocumentFragment();var RootNode=EndDivNode.parentNode;var ClassCount=1;while(EndDivNode.previousSibling!=null&&ClassCount>0){switch(EndDivNode.previousSibling.className){case EndDivClass:ClassCount++;newFrag.insertBefore(EndDivNode.previousSibling,newFrag.firstChild);break;case DivClass:if(EndDivNode.previousSibling.nodeName=="DIV"){ClassCount--;if(lbl2id!=""){EndDivNode.previousSibling.id=lbl2id;lbl2id=""}
  if(ClassCount==0){RootNode=EndDivNode.previousSibling;}else{newFrag.insertBefore(EndDivNode.previousSibling,newFrag.firstChild);}};break;case'LaTeXMathMLlabel':lbl2id=EndDivNode.previousSibling.id;EndDivNode.parentNode.removeChild(EndDivNode.previousSibling);break;default:newFrag.insertBefore(EndDivNode.previousSibling,newFrag.firstChild);}}
  RootNode.appendChild(newFrag);EndDivNode.parentNode.removeChild(EndDivNode);AllDivs=TheBody.getElementsByTagName("DIV");for(i=AllDivs.length-1;i>=0;i--){EndDivClass=AllDivs[i].className.match(/end\w+/);if(EndDivClass!=null){ClassCount=0;EndDivClass=EndDivClass[0];DivClass=EndDivClass.substring(3,EndDivClass.length);EndDivNode=AllDivs[i];RootNode=EndDivNode.parentNode;break;}}}
  var AllDivs=TheBody.getElementsByTagName("div");var DIV2LI=null;for(var i=0;i<AllDivs.length;i++){if(AllDivs[i].className=="itemize"||AllDivs[i].className=="enumerate"||AllDivs[i].className=="description"){if(AllDivs[i].className=="itemize"){RootNode=document.createElement("UL");}else{RootNode=document.createElement("OL");}
  RootNode.className='LaTeXMathML';if(AllDivs[i].hasChildNodes()){AllDivs[i].removeChild(AllDivs[i].firstChild)};while(AllDivs[i].hasChildNodes()){if(AllDivs[i].firstChild.hasChildNodes()){DIV2LI=document.createElement("LI");while(AllDivs[i].firstChild.hasChildNodes()){DIV2LI.appendChild(AllDivs[i].firstChild.firstChild);}
  if(DIV2LI.firstChild.className=="listitemmarker"){DIV2LI.style.listStyleType="none";}
  RootNode.appendChild(DIV2LI)}
  AllDivs[i].removeChild(AllDivs[i].firstChild);}
  AllDivs[i].appendChild(RootNode);}}
  var AllAnchors=TheBody.getElementsByTagName("a");for(var i=0;i<AllAnchors.length;i++){if(AllAnchors[i].className=="ref"||AllAnchors[i].className=="cite"){var label=AllAnchors[i].href.match(/\#(\w+)/);if(label!=null){var labelNode=document.getElementById(label[1]);if(labelNode!=null){var TheSpans=labelNode.getElementsByTagName("SPAN");if(TheSpans!=null){var refNode=TheSpans[0].cloneNode(true);refNode.style.display="inline"
  refNode.className=AllAnchors[i].className;AllAnchors[i].appendChild(refNode);}}}}}
  return TheBody;}
  var AMbody;var AMnoMathML=false,AMtranslated=false;function translate(spanclassAM){if(!AMtranslated){AMtranslated=true;AMinitSymbols();var LaTeXContainers=[];var AllContainers=document.getElementsByTagName('*');var ExtendName="";for(var k=0,l=0;k<AllContainers.length;k++){ExtendName=" "+AllContainers[k].className+" ";if(ExtendName.match(/\sLaTeX\s/)!=null){LaTeXContainers[l]=AllContainers[k];l++;}};if(LaTeXContainers.length>0){for(var m=0;m<LaTeXContainers.length;m++){AMbody=LaTeXContainers[m];try{AMbody=LaTeXDivsAndRefs(LaTeXpreProcess(AMbody));}catch(err){alert("Unknown Error: Defaulting to Original LaTeXMathML");}
  if(AMbody.tagName=="PRE"){var PreChilds=document.createDocumentFragment();var DivChilds=document.createElement("DIV");while(AMbody.hasChildNodes()){DivChilds.appendChild(AMbody.firstChild);}
  PreChilds.appendChild(DivChilds);AMbody.parentNode.replaceChild(PreChilds,AMbody);AMbody=DivChilds;}
  AMprocessNode(AMbody,false,spanclassAM);}}else{AMbody=document.getElementsByTagName("body")[0];try{AMbody=LaTeXDivsAndRefs(LaTeXpreProcess(AMbody));}catch(err){alert("Unknown Error: Defaulting to Original LaTeXMathML");}
  AMprocessNode(AMbody,false,spanclassAM);}}}
  if(isIE){document.write("<object id=\"mathplayer\" classid=\"clsid:32F66A20-7614-11D4-BD11-00104BD3F987\"></object>");document.write("<?import namespace=\"m\" implementation=\"#mathplayer\"?>");}
  function generic()
  {translate();};if(typeof window.addEventListener!='undefined')
  {window.addEventListener('load',generic,false);}
  else if(typeof document.addEventListener!='undefined')
  {document.addEventListener('load',generic,false);}
  else if(typeof window.attachEvent!='undefined')
  {window.attachEvent('onload',generic);}
  else
  {if(typeof window.onload=='function')
  {var existing=onload;window.onload=function()
  {existing();generic();};}
  else
  {window.onload=generic;}}
  /*]]>*/
  </script>
  <!-- Material Design Icons Extension -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css" media="all" rel="stylesheet" type="text/css">
  
  <!-- Material Design Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
   <!-- Materialize CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
  <style>
    
    /* Move content so that side-nav doesn't hide it */
    header, main, footer {
      padding-left: 320px; 
    }
    
    @media only screen and (max-width : 992px) {
      header, main, footer {
        padding-left: 0;
      }
    }
    
    @media print {    
      header, main, footer {
        padding-left: 0;
      }
      .side-nav {
        display: none;
      }
      .container {
        width: 100%;
      }
    }
    
    .side-nav {
      width: 320px;
      border-top: none;
    }
    
    /* Containers a bit larger than default 70% */
    .container {
      width: 75%;
    }
    
    /* Make nested collapsibles look nice in side-nav */
    .side-nav .collapsible-body {
      padding: 0;
    }
    
    /* Make images' width be slightly smaller than text */
    main .figure {
      width: 90%;
      margin: 0 auto;
    }
    
    main img {
      width: 100%;
    }
    
    /* Make text look prettier */
    p {
      text-align: justify;
    }
    
    /* Make anchors to titles look better by changing margin-top to padding-top */
    /* Reduce title fonts by ~35% each to look less jarring */
    main h1 { margin-top: 0; padding-top: 2.10rem; font-size: 40px; }
    main h2 { margin-top: 0; padding-top: 1.78rem; font-size: 32px; } 
    main h3 { margin-top: 0; padding-top: 1.46rem; font-size: 28px; }
    main h4 { font-size: 22px; }
    
    
    /* Make avatar better */
    .side-nav img.logo, .side-nav img.circle.avatar {
      height: 120px;
      width: 150px;
    }
    
    
    .side-nav a.inline {
      display: inline-block;
    }
    
    
    /* Bottom divider */
    .divider.bottom {
      margin: 0 0 8px 0;
    }
    
    /* Fix navbar collapsible elements padding */
    #TOC > ul > li > a { padding-left: 32px; }
    #TOC > ul > li > ul > li > a { padding-left: 48px; }
    #TOC > ul > li > ul > li > ul li a { padding-left: 64px; }
    
    h1.title {
     text-align: center;
     font-size: 48px;
    }
    
    ul.side-nav li a.title {
      font-weight: 900;
      font-size: 16px;
    }
    
    /* Main title */
    h1.title.first {
      font-size: 44px;
      margin-bottom: 0;
      font-weight: bolder;
    }
    
    h1.title.second {
      font-size: 36px;
      font-style: italic;
      padding-top: 0;
      font-weight: 100;
    }
    
    /* Contaxt icons in the sidebar */
    .userView a.inline-icon {
      display: inline-block;
      height: auto;
      padding: 0;
      margin-left: 16px;
    }
    
    .userView a.inline-icon i {
      font-size: 16px;
      vertical-align: text-bottom;
    }
    
    /* Fix margin of section numbers */
    .toc-section-number {
      margin-right: 8px;
    }
    
    </style>
</head>
<body>
<main>
<div class="container">
<div id="TOC">
<ul>
<li><a href="#acronyms-terminology">Acronyms &amp; Terminology</a></li>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a><ul>
<li><a href="#background-motivation"><span class="toc-section-number">1.1</span> Background &amp; motivation</a><ul>
<li><a href="#ecosystem-services-natural-capital-assessments"><span class="toc-section-number">1.1.1</span> Ecosystem services &amp; natural capital assessments</a></li>
<li><a href="#communicating-natural-capital-information"><span class="toc-section-number">1.1.2</span> Communicating natural capital information</a></li>
</ul></li>
<li><a href="#objectives-outline"><span class="toc-section-number">1.2</span> Objectives &amp; outline</a></li>
<li><a href="#how-to-read-this-document"><span class="toc-section-number">1.3</span> How to read this document</a></li>
<li><a href="#sec:criterion"><span class="toc-section-number">1.4</span> Assessment of the quality of a visualization</a></li>
</ul></li>
<li><a href="#sec:elements"><span class="toc-section-number">2</span> Elements of data visualization</a><ul>
<li><a href="#notions-and-techniques-in-data-visualization"><span class="toc-section-number">2.1</span> Notions and techniques in data visualization</a><ul>
<li><a href="#sec:graphintegrity"><span class="toc-section-number">2.1.1</span> Information visualization and graphical integrity</a></li>
<li><a href="#vocabulary-and-grammar-of-graphics"><span class="toc-section-number">2.1.2</span> Vocabulary and grammar of graphics</a></li>
<li><a href="#modes-of-visualization"><span class="toc-section-number">2.1.3</span> Modes of visualization</a></li>
<li><a href="#sec:disto"><span class="toc-section-number">2.1.4</span> Distortion techniques</a></li>
<li><a href="#sec:interactivefeatures"><span class="toc-section-number">2.1.5</span> Interaction techniques</a></li>
</ul></li>
<li><a href="#sec:colors"><span class="toc-section-number">2.2</span> Graphical best practices and guidelines</a><ul>
<li><a href="#legibility-and-intuitiveness"><span class="toc-section-number">2.2.1</span> Legibility and intuitiveness</a></li>
<li><a href="#scale-and-ratios"><span class="toc-section-number">2.2.2</span> Scale and ratios</a></li>
<li><a href="#legend"><span class="toc-section-number">2.2.3</span> Legend</a></li>
<li><a href="#color-scheme"><span class="toc-section-number">2.2.4</span> Color scheme</a></li>
<li><a href="#interactivity"><span class="toc-section-number">2.2.5</span> Interactivity</a></li>
</ul></li>
<li><a href="#overview-of-visualization-tools"><span class="toc-section-number">2.3</span> Overview of visualization tools</a><ul>
<li><a href="#data-analysis-and-visualization-software"><span class="toc-section-number">2.3.1</span> Data analysis and visualization software</a></li>
<li><a href="#charting-libraries"><span class="toc-section-number">2.3.2</span> Charting libraries</a></li>
</ul></li>
</ul></li>
<li><a href="#sec:UserGuide"><span class="toc-section-number">3</span> Design strategies to display natural capital information</a><ul>
<li><a href="#multi-dimensional-data"><span class="toc-section-number">3.1</span> Multi-dimensional data</a><ul>
<li><a href="#sec:scatterplots"><span class="toc-section-number">3.1.1</span> Scatterplots</a></li>
<li><a href="#sec:timeseries"><span class="toc-section-number">3.1.2</span> Time-series data: line charts, streamgraphs and more</a></li>
<li><a href="#sec:parcoords"><span class="toc-section-number">3.1.3</span> Parallel coordinates plot</a></li>
<li><a href="#sec:radar"><span class="toc-section-number">3.1.4</span> Radar charts</a></li>
<li><a href="#sec:smallmultiples"><span class="toc-section-number">3.1.5</span> Small Multiples</a></li>
<li><a href="#sec:rdim"><span class="toc-section-number">3.1.6</span> Reduce dimensions</a></li>
<li><a href="#sec:multiplelinked"><span class="toc-section-number">3.1.7</span> Multiple linked views</a></li>
</ul></li>
<li><a href="#spatial-data"><span class="toc-section-number">3.2</span> Spatial data</a><ul>
<li><a href="#general-classification-of-maps"><span class="toc-section-number">3.2.1</span> General classification of maps</a></li>
<li><a href="#sec:twowidely"><span class="toc-section-number">3.2.2</span> Two widely used ES maps</a></li>
<li><a href="#sec:hotspot"><span class="toc-section-number">3.2.3</span> Spatial visualization of tradeoffs</a></li>
<li><a href="#sec:beneficiaries"><span class="toc-section-number">3.2.4</span> Relationship between variables</a></li>
</ul></li>
<li><a href="#sec:compare"><span class="toc-section-number">3.3</span> Comparison of multiple spatial runs</a><ul>
<li><a href="#sec:comp_map"><span class="toc-section-number">3.3.1</span> Maps displays</a></li>
<li><a href="#sec:metricsmultrunscat"><span class="toc-section-number">3.3.2</span> Aspatial metrics to summarize results and agreements of categorical maps</a></li>
<li><a href="#sec:scale"><span class="toc-section-number">3.3.3</span> Influence of scale in map comparison and taking patterns into account</a></li>
<li><a href="#sec:metricsmultrunscont"><span class="toc-section-number">3.3.4</span> Aspatial metrics to summarize results and agreements of continuous maps</a></li>
</ul></li>
<li><a href="#sec:uncertainty"><span class="toc-section-number">3.4</span> Uncertainty</a><ul>
<li><a href="#introduction-to-uncertainty-sensitivity-analysis-visualization"><span class="toc-section-number">3.4.1</span> Introduction to uncertainty &amp; sensitivity analysis visualization</a></li>
<li><a href="#sec:uncert_aspat"><span class="toc-section-number">3.4.2</span> Non-spatial data uncertainty displays</a></li>
<li><a href="#sec:uncert_non_maps"><span class="toc-section-number">3.4.3</span> Spatial data uncertainty metrics</a></li>
<li><a href="#sec:uncert_maps"><span class="toc-section-number">3.4.4</span> Spatial data uncertainty map displays</a></li>
<li><a href="#sec:SA"><span class="toc-section-number">3.4.5</span> Parametric uncertainty: sensitivity analysis displays</a></li>
</ul></li>
<li><a href="#summary"><span class="toc-section-number">3.5</span> Summary</a><ul>
<li><a href="#key-take-aways"><span class="toc-section-number">3.5.1</span> Key take-aways</a></li>
<li><a href="#sec:table"><span class="toc-section-number">3.5.2</span> Summary table for specific display needs</a></li>
<li><a href="#sec:resou"><span class="toc-section-number">3.5.3</span> Resources</a></li>
</ul></li>
</ul></li>
<li><a href="#conclusion"><span class="toc-section-number">4</span> Conclusion</a><ul>
<li><a href="#on-standardizing-approaches-to-communicate-natural-capital-results"><span class="toc-section-number">4.1</span> On standardizing approaches to communicate natural capital results</a></li>
<li><a href="#engaging-a-broader-audience-into-major-decisions-on-natural-capital-sustainable-management"><span class="toc-section-number">4.2</span> Engaging a broader audience into major decisions on natural capital sustainable management</a></li>
</ul></li>
<li><a href="#bibliography">Bibliography</a></li>
</ul>
</div>
<p><em>This document aims to support ES analysts striving to communicate effectively natural capital information. It proposes approaches to ES visualizations and summaries in the form of a toolbox tailored to the specific needs of ES analysts, supported by fundamental and applied data visualization guidelines. This toolbox was developed as part of a <a href="http://www.charlotteweil.fr/masterthesis">master thesis</a>, and contains subset of its chapters.</em></p>

<h1 id="acronyms-terminology" class="unnumbered">Acronyms &amp; Terminology</h1>
<p><strong>Important concepts &amp; terminology</strong><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a></p>
<ul>
<li>Natural capital: Natural capital includes all environmental assets, it is the stock of resources, such a rivers, trees, the atmosphere and all living organisms <span class="citation">(Natural Capital Scotland Ltd 2015)</span></li>
<li>ES: Ecosystem services are the benefits natural capital assets provide to humanity <span class="citation">(Cardinale et al. 2012)</span></li>
<li>SDU: spatial decision unit, corresponding to a geometric feature such as polygon, pixel, lines or point. In the context of map comparisons, the word “cell” is used in this work for SDU, to match with the literature on the topic. SDU represent the scale at which a discrete spatial decision/intervention is undertaken.</li>
<li>LULC: land use/land cover</li>
<li>intervention/activity: an action that can be taken on a spatial decision unit that gets reflected in parameters that feed an ecosystem services model</li>
<li>portfolio: A set of SDU’s and chosen activities for each SDU, emerging from an optimizer, from RIOS, or a participatory prioritization process. Portfolios get overlayed on LULC’s to run the model</li>
<li>scenarios: storylines that describe possible futures (but are not predictions) <span class="citation">(Verutes et al. 2015)</span> (e.g an LULC scenario corresponds to an LULC map that has been changed based on modeled or user-defined changes to represent plausible futures)</li>
<li>spatial targeting: prioritization of interventions and their location on a landscape, can be undertaken with formal optimization methods, or heuristic or participatory approaches</li>
<li>SOW: state of the world (scenario with quantitative definition)<br />
<br />
</li>
</ul>
<p><strong>Jargon of the field</strong></p>
<ul>
<li>ABM: Agent-Based Modeling (computational modeling of phenomena as dynamical systems of interacting agents)</li>
<li>API: Application Programming Interface</li>
<li>EIA: Environmental Impact Assessment</li>
<li>GIS: Geographical Information Systems</li>
<li>IWS: investments in watershed services (known as waterfund)</li>
<li>MOEA: Multi-objective evolutionary algorithm</li>
<li>MOVA: Multi-objective visual analytics</li>
<li>OGR: OpenGIS Simple Features Reference Implementation</li>
<li>OR: Operational research</li>
<li>PCA: Principal component analysis</li>
<li>PFF: Production possibilities frontier (economical term for tradeoff curve)</li>
<li>RO: Robust optimization</li>
<li>SA: Sensitivity analysis</li>
<li>SLR: Sea Level Rise</li>
<li>SDSS: Spatial decision support systems</li>
<li>SDU: spatial decision unit</li>
<li>UA: uncertainty analysis<br />
<br />
</li>
</ul>
<p><strong>Softwares and models</strong></p>
<ul>
<li>CV: Coastal Vulnerability (model)</li>
<li>HRA: Habitat Risk Assessment (model)</li>
<li>InVEST: Integrated Valuation of Ecosystem Services and Trade-offs</li>
<li>GDAL: Geospatial Data Abstraction Library</li>
<li>MESH: Mapping Ecosystem Services to Human well-being</li>
<li>RIOS: The Resource Investment Optimization System</li>
<li>SDR: Sediment delivery ratio (a model in InVEST)</li>
<li>VIDEO: Visually Interactive Decision-making and Design using Evolutionary Multi-objective Optimization</li>
</ul>
<h1 id="introduction"><span class="header-section-number">1</span> Introduction</h1>
<blockquote>
<p><em>“Often the importance of ecosystem services is widely appreciated only upon their loss”</em></p>
<p><br />
<em>Gretchen Daily, in The Value of Nature and the Nature of Value</em></p>
</blockquote>
<h2 id="background-motivation"><span class="header-section-number">1.1</span> Background &amp; motivation</h2>
<h3 id="ecosystem-services-natural-capital-assessments"><span class="header-section-number">1.1.1</span> Ecosystem services &amp; natural capital assessments</h3>
<p>Ecosystem services (ES) are essential gifts from nature making life possible and worthwhile. They rely on complex interactions of many forms of natural capital. However, about 60% of the ecosystem services are being degraded<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> or are not used sustainably. As the stock of natural capital decreases, due to clear and increasing human alteration <span class="citation">(Vitousek et al. 1997)</span>, citizens and scholars are increasingly highlighting the urgency of taking action to protect it. To do so, efficient policy design requires a strong (often quantitative) understanding of ecosystem services functioning.</p>
<p>Such an understanding can be achieved through natural capital assessments, which locate the sources of ecosystem services, provide indications for sustainable management, identify and prioritize conservation activities, help build understanding of synergies and trade-offs between the needs and impacts of different projects or sectors, support policy design, and contribute to climate resilience and adaptation planning. These assessments document ecosystem services at different levels, from local ones such as pest control, to regional ones like flood control, to global services such as climate stabilization. They reveal interdependencies between services, critical points and timescales for degradation and recovery <span class="citation">(Daily et al. 2000)</span>.</p>
<p>Natural capital assessements aim to reveal the specific benefits provided by nature, in order to develop approaches to manage environmental assets sustainably and make it easier for nature to become a primary consideration in all decisions</p>
<h3 id="communicating-natural-capital-information"><span class="header-section-number">1.1.2</span> Communicating natural capital information</h3>
<p>Given their complexity, natural capital assessments involve a substantial understanding of phenomena and their interactions, often requiring significant studies and modeling efforts. However, these efforts will do little to achieve their intended goal of informing decisions unless the insights they generate are effectively communicated to provide usable information to decision-makers. Therefore, the present work aims to put an emphasis on this last step of process, that is, conveying the results – in particular, strategies for visualization, which are often neglected in time-limited projects which had focused on the previous steps.</p>
<p>Visualization is the main focus of this work, because it has been proven to be easier for the brain to understand an image than words or numbers <span class="citation">(Cukier 2010)</span>. Because of their abilities to synthesize large amounts of data into effective displays <span class="citation">(Ware 2000)</span>, graphics have been widely used in the literature. Plus, it had been shown that judgement often results from fast and automatic processing, generally prompted by visuals <span class="citation">(McMahon et al. 2016)</span> and that combining optimization with visualization promotes design innovations and empowers decision makers with a better understanding of systems behaviors (see for example the work of <span class="citation">Kollat and Reed (2007)</span>, <span class="citation">Reed and Minsker (2004)</span>, <span class="citation">Fleming et al. (2005)</span>, <span class="citation">Winer and Bloebaum (2002)</span>. More specifically for spatial data, mapping, defined by <span class="citation">Englund et al. (2017)</span> as the organization of spatially explicit quantitative information, has proven essential for many assessments of ES <span class="citation">(Troy and Wilson 2006)</span>. <span class="citation">Hauck et al. (2013)</span> showed how maps are tremendously helpful to support proper management of ecosystems and ecosystem services. However, he also brings attention to the fact that they should be used carefully.</p>
<p>Not only visuals, but effective visuals are crucial to achieve the intended goal of informing their audience. This work draws from the widely studied topic of information visualization (by Cleveland, Ware, Tufte among others). Visualizations of large datasets and complex information is a very effective way to conveying knowledge, but it is also non-trivial, which might explain why this topic is given so much attention in the literature.</p>
<p>Visualizations support both data analysis and data presentation. The latter is the focus of this work, which assumes that at least some initial results are generated. However, visualizations are not distinctly intended to serve just one purpose, and the same displays may also be of use for exploratory analysis by the analyst, to help build insight, especially to the extent that both an analyst’s own work and their stakeholder engagement are iterative.</p>
<p>Developing visuals that communicate the complexities of natural capital assessments is admittedly difficult, even with existing visual tools and expertise. A preliminary part of this work consisted in identifying the specific challenges related to displaying ES results. ES information consists in varied, large, multi-dimensional datasets, often including large numbers of results that come from considering multiple objectives, scenarios, and uncertainties. These can be categorical or continuous, spatial or aspatial. The main tasks that these displays aim to support include scenario analysis, multi-objective comparisons, and expression of uncertainty. Some cases may require combinations of these tasks.</p>
<h2 id="objectives-outline"><span class="header-section-number">1.2</span> Objectives &amp; outline</h2>
<p>This document is intended to support and guide analysts in their task of communicating natural capital information. This work proposes approaches to ES visualizations and summaries in a toolbox tailored to the specific needs of ES analysts, supported by fundamental and applied data visualization guidelines. The toolbox of visualization techniques is structured around four main themes: displaying multi-dimensional data, displaying spatial data, comparing multiple versions of spatial data, and expressing uncertainty (this organization attempts to follow these themes despite the many overlaps).</p>
<p>First, one may ask <em>what makes a visualization successful ?</em> Chapter 2 provides the background knowledge on the fundamentals of data visualization, key principles, guidelines and also briefly addresses the question of which tools to use.</p>
<p>Then, chapter 3 gives an overview of design strategies for displaying the type of data encountered in natural capital projects. It suggests effective solutions to synthesize and communicate spatial, multi-dimensional outputs of multiple runs for multiple ES models, based on an extended literature review about visualization approaches in neighboring fields.</p>
<h2 id="how-to-read-this-document"><span class="header-section-number">1.3</span> How to read this document</h2>
<p>The document is organized to allow a reader to skim through the display tasks and suggested solutions, and focus on details where relevant. Embedded references and hyperlinks allows to navigate between sections in this interactive document; the web visualizations listed have embedded links. For a quick answer to a specific display need, table <span class="ref">sec:table</span> summarizes the relevant options for the main display tasks.</p>
<p>Because of the context-specific nature of efficient data visualization, the approach of selecting a “best” solution for each display appears to be irrelevant. Therefore this document is organized as a toolbox suggesting several strategies for each case, from which the analyst can take inspiration and adapt the solution to fit his or her needs. Each proposed display is explained, discussed (pros and cons) and illustrated with relevant use cases and/or examples. This user guidance aims to serve as a basis and an inspiration to the analyst, suggesting several options to be used and adapted to each case. It is essential to tailor the display according to:</p>
<ul>
<li>the goal of the display: <em>What is the key message to convey?</em></li>
<li>the audience targeted: <em>Who is the display intended for? What is their level of knowledge about the project and their familiarity with scientific visualizations?</em></li>
<li>the time available: <em>Both the time expected spent by the user on the display, and the time to build the visualization. Should this convey just the key results or go in depth about the analysis?</em></li>
<li>the document type: <em>Static, dynamic, interactive?</em></li>
<li>the presentation type: <em>How will it be released? Should this be self explanatory or will it be presented by the analyst?</em><br />
</li>
</ul>
<h2 id="sec:criterion"><span class="header-section-number">1.4</span> Assessment of the quality of a visualization</h2>
<p>Based on the knowledge from the literature review, and the current state of existing visualizations, display solutions were suggested. For the tasks where no satisfying solutions could be found, new ones were developed, or adapted from solutions existing in neighboring fields in the literature.</p>
<p>The selection of solutions was guided by several established criteria (see section <span class="ref">sec:criterion</span>). However, when assessing clarity and effectiveness of a visualization, some subjectivity cannot be avoided.</p>
<p>It is a rather subjective task to assess the quality of suggested solutions. To increase objectivity, several criteria were considered, specifically the imperatives for visualization, defined by <span class="citation">(Stephens et al. 2012)</span> in the context of ensemble predictions (figure <span class="ref">fig:crit1</span>), see also the criteria of clarity and completeness detailed by <span class="citation">Allen et al. (2012)</span>.</p>
<div class="figure">
<img src="../images/criterias.png" alt="Figure 1: Imperatives for visualization, defined by (Stephens et al. 2012) in the context of ensemble predictions: richness, saliency, and robustness." id="fig:crit1" style="width:40.0%" />
<p class="caption">Figure 1: Imperatives for visualization, defined by <span class="citation">(Stephens et al. 2012)</span> in the context of ensemble predictions: richness, saliency, and robustness.</p>
</div>
<h1 id="sec:elements"><span class="header-section-number">2</span> Elements of data visualization</h1>
<blockquote>
<p><em>“Excellence in statistical graphics consists of complex ideas communicated with clarity, precision and efficiency.”</em></p>
<p><em>Edward Tufte</em></p>
</blockquote>
<p>This chapter aims to lay out the context and basics of data visualization, and thereby establish the background knowledge to contextualize and further investigate specific display strategies. First, a brief overview of some general notions in data visualization is given to familiarize with the context, along with guidelines for successful implementation. Then, an overview of the multiple visualization tools is provided, aiming to support ES analysts to choose the most adapted software or library for each application.</p>
<h2 id="notions-and-techniques-in-data-visualization"><span class="header-section-number">2.1</span> Notions and techniques in data visualization</h2>
<h3 id="sec:graphintegrity"><span class="header-section-number">2.1.1</span> Information visualization and graphical integrity</h3>
<p>Information visualization, or visual communication, consists in transforming complex and abstract data into an accessible and concrete form, that a human brain can perceive with as little as possible cognitive effort. It consists simply in encoding data into visual objects, such as lines or points <span class="citation">(Tufte 1983)</span>. The goal of a visualization is to effectively convey information <span class="citation">(Kelleher and Wagener 2011)</span>.</p>
<p>In order to achieve this aim honestly, <em>graphical integrity</em> considerations must be kept in mind throughout the process of building visualizations. It has been shown that graphs can clearly be misleading because of design choices <span class="citation">(Allen et al. 2012)</span>. Graphical integrity consists in accurate representations of data, avoiding distortions or misleading designs. To this end, data must be shown in its context, well-known units and clear labeling should be used to avoid ambiguity and true proportions must be kept in representing numbers <span class="citation">(Tufte 1983)</span>.</p>
<p>Graphical integrity considerations in the context of ES are especially relevant concerning uncertainty representation, scenarios displays and scales. Hiding some uncertainties, or some scenarios considered during the analysis, may be considered dishonest <span class="citation">(McMahon et al. 2016)</span>, however analyst may decide to show a subset only in order to focus on the core message but showing the relevant context is necessary to a global understanding. Graphical integrity considerations also needs to be taken into account in the choice of the scale: it is important to normalize<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a> it, and use the same scale on comparable figures, to avoid biasing comparisons.</p>
<h3 id="vocabulary-and-grammar-of-graphics"><span class="header-section-number">2.1.2</span> Vocabulary and grammar of graphics</h3>
<p>Graphs, charts, diagrams and plots, despite ambiguous nuances, are all defined as representations of data, these words will be used synonymously in this work. A graph consists in at least one dataset translated into a set of mappings (i.e. visual encodings), forming layers that are statistically transformed according to the scale, the coordinate system and the facet specification<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a>. Refer to <span class="citation">Wickham (2008)</span> and <span class="citation">Wilkinson (2006)</span> for additional details about the <em>grammar of graphics</em>.</p>
<p>Spatial data , presents its own visualization and handling challenges, it is therefore typically handled with specific tools, so called geographical information systems (GIS) which link geographic (e.g. maps) and descriptive information. Data is organized in different layers, associated based on their geography. Spatial data can be stored in two types: raster, which is a gridded collection of pixels referenced with coordinates, and vector, which corresponds to a set of points, lines, and polygons. Different projections and coordinate systems are of great importance when dealing with spatial data: the round shape of the earth is different from the flat projections of the maps and this means that distortion cannot be avoided. These projections conserve either the shape, or the area for example but cannot conserve all measures <span class="citation">(Medeiros 2016)</span>. For further information regarding GIS, we point out to the myriad of work in this vast field, among others, the book written by <span class="citation">De Smith et al. (2007)</span>.</p>
<h3 id="modes-of-visualization"><span class="header-section-number">2.1.3</span> Modes of visualization</h3>
<p>Visualization can be delivered in different forms. There are three main groupings of visual information delivery modes:</p>
<ul>
<li><strong>Static presentations</strong> are required for printed format and often essential. In the context of inter-organizational projects, there is almost always a need to summarize results in static reports.</li>
<li><strong>Dynamic user-interactive visualizations</strong> give the greatest flexibility to the user who is given options to test and visualize results while having some control on the display. In many cases, user interactivity enhances the user’s implication and satisfaction <span class="citation">(Teo et al. 2003)</span>. Dynamic displays offers many options to tailored and multi-dimensional visualizations. Section <span class="ref">sec:interactivefeatures</span> will detail some of the main features of interest.</li>
<li><strong>Dynamic storytelling</strong> is part way between the two previous visualization modes: it is a dynamic animation, but not fully interactive. The viewer is guided through the visualization, either by a presenter, or step-by-step through the storyline, (s)he therefore has less flexibility to “play around” with the variables, but it can result in easier delivery of key messages. Especially useful during presentations, but also on webpages, the dynamic storytelling allows the flexibility and multi-dimensional displays options of dynamic visualizations, while keeping control on the selected options, i.e. walking the user through the visualization to lead to the envisioned goal.</li>
</ul>
<h3 id="sec:disto"><span class="header-section-number">2.1.4</span> Distortion techniques</h3>
<p>When displaying large datasets, combining information on different scales can become very tricky. As noted earlier (<span class="ref">sec:graphintegrity</span>), graphical integrity requires to present the context of the dataset. However, when attempting to show local variations, displaying two scales at once is a notable challenge. Some distortion techniques have been developed in order to view precisely local details in their global context. They allows a greater space to the display of a focused zone, while still embedding its surrounding context. Generally, linear or hyperbolic geometry supports the smooth connection of the focus area and the background, that have different scales <span class="citation">(Leung and Apperley 1994)</span>. Distortion techniques include:</p>
<ul>
<li><strong>bifocal display</strong> (or lens) corresponds simply to a linear transformation (in one or two directions) (<span class="citation">Apperley et al. (1982)</span>, <span class="citation">Leung and Apperley (1994)</span>).</li>
<li><strong>polyfocal lens</strong> is similar to bifocal lens, but using a more complex hyperbolic (or polynomial) transformation function <span class="citation">(Leung and Apperley 1994)</span>.</li>
<li><strong>fisheye view</strong>, originally called <em>Focus + Context</em> technique (<span class="citation">Lamping et al. (1995)</span> and <span class="citation">Furnas (1986)</span>) uses a continuous magnification function (that also transforms the boundaries). Tough this term has been used with different definitions, it is broadly used and very intuitive.</li>
<li>there are other less common options among which can be mentioned the <strong>perspective wall</strong> <span class="citation">(Mackinlay et al. 1991)</span>, that simulates the perspective effect or the <strong>hyperbolic tree</strong> that extends the fisheye view using hyperbolic plane mapped onto a circular display region <span class="citation">(Lamping et al. 1995)</span>.</li>
</ul>
<h3 id="sec:interactivefeatures"><span class="header-section-number">2.1.5</span> Interaction techniques</h3>
<p>A few interactive features of interest include <span class="citation">(Wilhelm et al. 1995)</span>:</p>
<ul>
<li><strong>Scaling</strong>, which is simply the ability to zoom in and out, is powerful in the sense that it allows the user to both a global view of the whole dataset and a view of precise details on smaller variations, therefore removing the need for a distorted view. Some scaling options also combine distortion techniques (see section <span class="ref">sec:disto</span>) to both zoom in and keep the background context in the surroundings.</li>
<li><strong>Identification</strong> (also called <em>pointing</em>) allows access to detailed information of a subset of the graph by clicking on it.</li>
<li><strong>Generalized selection</strong> visually highlights or extracts in some way every linked graphical element that is associated with the user’s selection for an overview of subsets. The association rules are defined according to the case.</li>
<li><strong>Brushing</strong> consists in selecting a subset of data, that is then highlighted. Also, brushing can be used to remove unwanted data, when a specific threshold defines a subset of interest <span class="citation">(Kollat and Reed 2007)</span>. Brushing can be done with a slider, or with direct selection on the plot <span class="citation">(Ward 1994)</span>.</li>
<li>In a context where the displays consists in several views (different plots), <strong>linking</strong> adds value to brushing: it is the dynamic update of the other graphs displayed, to undergo the corresponding «brushed» selection <span class="citation">(Buja et al. 1996)</span>.</li>
</ul>
<h2 id="sec:colors"><span class="header-section-number">2.2</span> Graphical best practices and guidelines</h2>
<p>What makes a good visualization? Keeping in mind the goal which is to effectively convey information, i.e. to gain insight on the data, an efficient visualization reduces the cognitive effort of understanding the graph, in order to bring the observer’s attention to the actual facts. Some may seem trivial, nevertheless the guidelines summarized in the following paragraphs are essential to achieving the intended purpose. As described by an expert in data visualization, Tufte (1983) in his classic text (p.13), graphical displays should:</p>
<blockquote>
<ul>
<li>“show the data</li>
<li>induce the viewer to think about the substance rather than about methodology, graphic design, the technology of graphic production…</li>
<li>avoid distorting what the data has to say</li>
<li>present many numbers in a small space</li>
<li>make large data sets coherent</li>
<li>encourage the eye to compare different pieces of data</li>
<li>reveal the data at several levels of detail, from a broad overview to the fine structure</li>
<li>serve a reasonably clear purpose: description, exploration, tabulation or decoration</li>
<li>be closely integrated with the statistical and verbal descriptions of a dataset“.</li>
</ul>
</blockquote>
<p>In the context of maps, <span class="citation">Buckley (2012)</span> states five major maps design principles, namely legibility, visual contrast (for which the choice of an appropriate color scheme is essential), figure-ground organization, hierarchical organization, and balance (see her work for further details and guidance specific to maps).</p>
<p>Best practices seem to be summarized by three main points. An efficient display should be self-explanatory, tailored to the audience, and most importantly convey the key message. Moreover a good visualization is highly dependent on the task and the type of display and other design choices are very specific to the dataset considered.</p>
<h3 id="legibility-and-intuitiveness"><span class="header-section-number">2.2.1</span> Legibility and intuitiveness</h3>
<p>Simplicity is key to an effective display. <span class="citation">(Tufte 1983)</span> advocates to minimize the design complexity, to maximize the time spent on reasoning on the actual content. Redundancy introduces needless complication and should be avoided. For example, the data ink ratio (i.e. the ratio of ink used to display data over the total ink of the figure) should be minimized as far as possible. Additionally, <span class="citation">Kelleher and Wagener (2011)</span> argues to maintain axis ranges across subplots for easier comparison, connect sequential data (but, for example in time series plots, disconnect specifically the area of missing data) and express density of overlapping points (e.g. with color gradient in scatterplots). Appropriate encoding of objects and attributes lead to intuitive plots, as detailed by <span class="citation">Cleveland and McGill (1984)</span>.</p>
<h3 id="scale-and-ratios"><span class="header-section-number">2.2.2</span> Scale and ratios</h3>
<p>The success of a visualization is contingent upon the careful selection of appropriate scales and aspect ratios. There is always trade-offs between showing the zero, or zooming on variations. Dynamic features and distortion techniques allow to overcome some of this difficult choices, but are not always possible. Making the right choice between displaying patterns or details is crucial <span class="citation">(Kosslyn and Chabris 1992)</span>. Meaningful axis ranges, data transformations (e.g. log scale) and aggregation level (e.g. temporal aggregation by averaging over a larger time step for long time-series) are essential too <span class="citation">(Kelleher and Wagener 2011)</span>.</p>
<h3 id="legend"><span class="header-section-number">2.2.3</span> Legend</h3>
<p>For the graph to be self-explanatory, a clear labeling must be included. If opting for a legend, it should be ordered by some properties of data, never alphabetically according to <span class="citation">Tufte (1983)</span> because a space to express something about the data would be wasted. Creating logical groups assists the understanding. For color codes, it is advised to display adjacent to each other in the legend the colors that are adjacent in the corresponding map <span class="citation">(Brewer 2004)</span>.</p>
<h3 id="color-scheme"><span class="header-section-number">2.2.4</span> Color scheme</h3>
<p>The color scheme is an another important choice to be made when displaying data<span class="citation">(Kelleher and Wagener 2011)</span>. Sequential color scheme ought to be chosen when the underlying data shows ranked differences; diverging scheme when dealing with negative and positive differences around a mean or a neutral value; and a categorical scheme for discrete values (see figure <span class="ref">fig:colorschemes</span> and recommendations of <a href="https://tilemill-project.github.io/tilemill/docs/guides/tips-for-color/">the tilemill project</a>. Moreover, many sources suggests to use only a few colors (about 6), while choosing them distinct, and striving for color harmony. Other considerations to bear in mind: cultural conventions and intuitive tints facilitate fast perception, colorblind and printing safe schemes are prudent. Also, the color scale should be normalized<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a>, considering which datapoints should appear in different categories. Websites like <a href="http://colorbrewer2.org/">Colorbrewer</a>, <a href="http://colrd.com/palette/">Colrdl</a> or <a href="https://color.adobe.com">Adobe Kuler</a> provide good color palettes, based on color theory.</p>
<div class="figure">
<img src="../images/0_colorschemes.png" alt="Figure 2: Color schemes" id="fig:colorschemes" style="width:80.0%" />
<p class="caption">Figure 2: Color schemes</p>
</div>
<h3 id="interactivity"><span class="header-section-number">2.2.5</span> Interactivity</h3>
<p>The success of an interactive display results from the appropriate interface complexity for a certain user motivation <span class="citation">(Roth and Harrower 2008)</span>. In the field of interactive maps, <span class="citation">(Roth and Harrower 2008)</span> examines when cartographic interaction positively supports work. Interactivity is not always beneficial to the graphs, but relevant for users who wish to customize the communicated information to their particular interests, also relevant to overcome some display problematics. Interactivity also helps enhance the user’s involvement with the map, by offering a sense of control over the experience.</p>
<h2 id="overview-of-visualization-tools"><span class="header-section-number">2.3</span> Overview of visualization tools</h2>
<p>To put the above principles into practice, various tools are available to create data visualizations. A few important things to consider when choosing an appropriate tool are the features supported (user interactivity, spatial data, 3D, web), and also the price, speed, scalability, robustness, customizability and user adoption. Then, it is often a trade-off between customizability and ease of use. Such software is usually easier to utilize, and the resulting visualizations are often more aesthetic, but if the user is willing to code, custom scripts offer the most flexibility in design, and various charting libraries allow to tailor the figure to specific needs. This section does not pretend to be exhaustive but attempts to give an overview of the available data visualization tools, based on a review conducted in late 2016. Emphasis will be given on spatial data as it constitutes an essential part of natural capital information.</p>
<div class="figure">
<img src="../images/toolz.png" alt="Figure 3: Overview of some existing visualization tools" id="fig:boooo" style="width:90.0%" />
<p class="caption">Figure 3: Overview of some existing visualization tools</p>
</div>
<h3 id="data-analysis-and-visualization-software"><span class="header-section-number">2.3.1</span> Data analysis and visualization software</h3>
<p>There is a myriad of data visualization software available, usually combining some analytics features. Some of the main ones are <strong>Tableau</strong>, <strong>Spotfire</strong>, <strong>Qlickview</strong> and <strong>MS BI Stack</strong>. Dynamic visualization has historically been supported by software like <strong>Xmdv Tool</strong> and <strong>OpenDX</strong> (both open source) and is recently proposed by many new software, as visual data analytics is becoming very trendy.</p>
<p>In terms of maps, some software support spatial data (namely Tableau, Spotfire and OpenDX). Moreover, GIS software are designed to build maps from any data and to perform spatial data analysis; <strong>ArcGIS</strong> and <strong>QGIS</strong> are the most common. The former integrates in its desktop version several applications, namely ArcMap to build maps, ArcCatalog for data management, ArcToolbox for geoprocessing, and also ArcScene, ArcGlobe, and ArcGIS Pro. QGIS (formerly Quantum GIS) is the corresponding open-source software. According to synthesis of users’ forums, it seems that ArcGIS seems to have more functionalities, especially when dealing with rasters and better support tools, and QGIS a steeper learning curve. However, they are really comparable. To combine spatial data and dynamic displays, some software such as <strong>InstantAtlas</strong> provide interactive mapping services. <a href="http://geoawesomeness.com/top-19-online-geovisualization-tools-apis-libraries-beautiful-maps/">More details and examples of geovisualization tools are presented by</a> <span class="citation">Buczkowski (2016)</span> and include Carto, the Mapzen API, Maps4news, as well as Tableau, mentioned above.</p>
<h3 id="charting-libraries"><span class="header-section-number">2.3.2</span> Charting libraries</h3>
<p>Charts and maps can also be generated through scripting, allowing greater flexibility. Sorted by programming languages, some of the main plotting and mapping libraries are listed below. On the spatial data side, <span class="citation">Hügel (2015)</span> advocates for these over GIS software for exploratory data analysis.</p>
<h4 id="javascript"><span class="header-section-number">2.3.2.1</span> Javascript</h4>
<p>Javascript is, without a doubt, the go-to language for <em>fancy</em> - and definitely for interactive - data visualization, considering the multiple charting libraries written in this language. The one that stands out is <strong>D3.js</strong> (or just D3 for Data-Driven Documents). Formerly <em>Protovis</em>, it produces dynamic, interactive and very customizable web visualizations. In the same vein, <em>Processing, Anychart, FusionCharts, Dygraphs, Highchart, Zingchart, Three (3D)</em> can be cited among others. Several tools build upon D3, the library <strong>Dc.js</strong> adds crossfiltering functionalities, such as brushing and linking, <em>Raw</em> provides a user interface to build D3 typical examples without having to code <span class="citation">(Caviglia and al 2013)</span>. Also <strong>Plotly</strong> API libraries that build on D3.js not only for javascript but also with versions for Python, Matlab and R.</p>
<p><strong>Leaflet</strong> is probably the most adopted mapping library for spatial data. <strong>Mapbox</strong> supports similar functionalities with the <em>Mapbox GL library</em>. Other mapping libraries include <em>ModestMap</em> (from the makers of Mapbox) and <em>Highmaps</em>.</p>
<h4 id="r"><span class="header-section-number">2.3.2.2</span> R</h4>
<p>R plotting packages <strong>ggplot</strong> and <strong>ggplot2</strong> are very efficient for static visualizations. The map package built on top of the latter, <strong>ggmap</strong> combines spatial information from GoogleMaps, OpenStreetMap with the grammar of graphics of ggplot2 <span class="citation">(Kahle and Wickham 2013)</span>. The interactive version of ggplot2 would be <strong>ggvis</strong>, however its dynamic functionalities are quite limited. A powerful package for interactive (web) visualizations is <strong>Shiny</strong>, it can be combined to <em>Leaflet</em> for spatial data. R spatial packages include <strong>sp</strong>, <strong>raster</strong>, <strong>maptools</strong> and <strong>rasterVis</strong>.<a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a> Also, as mentioned above, Plotly has an R version too, converting ggplot2 charts to interactive ones. Another way to connect to the multiple javascript charting libraries is to use the package rCharts.</p>
<p>The OpenMORDM visualization toolkit <span class="citation">(Hadka et al. 2015)</span> is a dynamic visualization platform built from R Shiny. It allows to explore, gain insight on the data, and make static plots, with a focus on deep uncertainty and robustness visualizations.</p>
<h4 id="python"><span class="header-section-number">2.3.2.3</span> Python</h4>
<p><strong>Matplotlib</strong> is the main Python graphing library. It contains a toolkit for plotting 2D data on maps: <strong>basemap</strong><a href="#fn7" class="footnoteRef" id="fnref7"><sup>7</sup></a>. Also, <strong>geopandas</strong> extends the data analysis library Pandas to spatial data, using also Fiona for file access, Shapely and Descartes for geometric operations, PySal for spatial analysis, and of course Matplotlib for plotting <span class="citation">(Hügel 2015)</span>. Interactive plots are based on <strong>Bokeh</strong> which imitates D3, or, as mentioned previously, Plotly.</p>
<h1 id="sec:UserGuide"><span class="header-section-number">3</span> Design strategies to display natural capital information</h1>
<p>This chapter gathers the knowledge acquired from an extended literature review on static and dynamic approaches to displaying complex data and existing strategies in use. This literature review explored the design strategies to express and visualize multi-dimensional, spatial, multi-objective, uncertain data and combinations of these. This focus corresponds to the specific challenges faced while communicating natural capital information. The variety of mapping and synthesizing approaches in the field of ES leads to difficult choices of methods for the analysts <span class="citation">(Englund et al. 2017)</span>. So this practical toolbox aims to put together the various options, hopefully providing a clearer vision on the variety of visualization strategies.</p>
<p>An important preliminary note: plots and graphs are not always necessary. Sometimes, the full data table is the best visualization, particularly for small datasets where presenting the data alone could be sufficient. In some cases, visualization will lead to the desire to inspect the data, in which case presenting directly the data itself may be more efficient. For example, in the case of a mid-project intermediary report for a meeting with experts on the project, it is likely that plots will lead to questions digging in details, where showing the full dataset and how solutions were selected and compared to each other is necessary.</p>
<h2 id="multi-dimensional-data"><span class="header-section-number">3.1</span> Multi-dimensional data</h2>
<p>In the context of ES, multi-dimensionality arises often from multi-objective problems such as cases where multiple services are considered and their trade-offs are to be explored, but also from multiple scenarios, due for example to exploration of alternate development pathways. Visual decision support tools are very relevant in the field of multi-objective optimization problems<a href="#fn8" class="footnoteRef" id="fnref8"><sup>8</sup></a>, as well as for scenario comparison. For multi-objective optimization under uncertainty, the number of scenario considered can be very large. In the typical cases, there is no unique optimal solution, but a collection of Pareto optimal ones <span class="citation">(Hadka et al. 2015)</span>, i.e. solutions where improving the result towards one objective result a decrease in performance with regards to another objective <span class="citation">(Pareto 1896)</span>. Efficient visualizations empower the user with the ability to navigate through thousands of potential solutions, compare them and understand trade-offs, leading to performant decision-making.</p>
<p>Multi-dimensional data visualization has been given considerable attention, as computational capacities have been increasing and the amount of produced data exploding. Multi-dimensional data exploration has taken several directions, based on geometric projection techniques, to which distortion and interaction techniques (discussed in sections <span class="ref">sec:disto</span> and <span class="ref">sec:interactivefeatures</span>) can be added to further improve these visualizations <span class="citation">(Keim 2000)</span>. The curse of multi-dimensionality, as explained by <span class="citation">Allen et al. (2012)</span> is that graphical displays become less informative as the dimensions and complexity of datasets increase. However, she argues in favor of detailed graphs because their ability to show more data and reveal more information outweighs the drawbacks of this curse.</p>
<h3 id="sec:scatterplots"><span class="header-section-number">3.1.1</span> Scatterplots</h3>
<p>The classic scatterplot displays data with two to three dimensions, using cartesian coordinates and two or three axes. In a <strong>3D scatterplot</strong> (figure <span class="ref">fig:hadka</span>a) solutions are represented as points in the space. Additional dimensions can be represented by changing attributes (color, shape, size, orientation, etc), however this may negatively impact clarity or risk ovewhelming key messages of the plot. Interactivity allows the user to perform selections of one or multiple point(s).</p>
<p>When relationships between several variables are to be explored, <strong>scatter plot matrix</strong> (SPLOM) are suitable. They combines the small multiple strategy (further described in section <span class="ref">sec:smallmultiples</span>) with the classic scatterplot to display relationships between every pair of variables<a href="#fn9" class="footnoteRef" id="fnref9"><sup>9</sup></a>.</p>
<p>In the context of multi-objective optimization, to understand trade-offs and synergies between several objectives under many scenarios, scatterplots are a great option. The commonly used <strong>trade-off curve</strong> is a scatterplot displaying objective scores, with an axis per objective, and a datapoint per scenario (see for example figures <span class="ref">fig:Peter</span> and <span class="ref">fig:addl</span>c). A third objective can be displayed by adding a colorscale or size-scale. Also, 3D scatterplots are often used for up to four objectives (e.g. in figure <span class="ref">fig:hadka</span> or the VIDEO software of <span class="citation">Kollat and Reed (2007)</span>). Over 4 objectives, small multiples of trade-off curves are very relevant.</p>
<div class="figure">
<img src="../images/scatter.png" alt="Figure 4: Several options to display multiple variables with scatterplots: (a) Two axis scatterplot (Vogl et al. 2014), (b) Small multiples of scatterplots with color coded trade off curves (Courtesy Benjamin Bryant). For trade-off curves example, see also figure fig:Peter." id="fig:scatterplots" style="width:100.0%" />
<p class="caption">Figure 4: Several options to display multiple variables with scatterplots: (a) Two axis scatterplot <span class="citation">(Vogl et al. 2014)</span>, (b) Small multiples of scatterplots with color coded trade off curves (Courtesy Benjamin Bryant). For trade-off curves example, see also figure <span class="ref">fig:Peter</span>.</p>
</div>
<h3 id="sec:timeseries"><span class="header-section-number">3.1.2</span> Time-series data: line charts, streamgraphs and more</h3>
<p>For data including several independent variables, and a dependent one, a <strong>line chart</strong> is a version of a scatterplot (see <span class="ref">sec:scatterplots</span>) where points are ordered (on the x-axis), and joined with segments. Line charts (also referred to as run charts for time-series data, or index charts when interactive) highlight relative changes, these are a good options when comparing the independent variables. <strong>Streamgraphs</strong> (figure <span class="ref">fig:line_img</span>b), also called stacked graphs, sums visually the time-series values around a central axis by stacking area charts on top of each other <span class="citation">(Heer et al. 2010)</span>. These work only for positive values, and provide general view of the data, but are not effective for visualizing details, also they are more efficient in interactive form than static <span class="citation">(Ribecca n.d.)</span>. In the case of very large timeseries datasets, <strong>horizon graphs</strong> (figure <span class="ref">fig:line_img</span>a)is a very space-effective option, despite a certain learning time for the reader to understand the graph style. Horizon graphs consists in filled line charts, where negative values are mirrored (and colored typically in red) to appear on the upper side, and then the chart divided into bands that are overlayed using transparency effects to limit the space required for peaks. Thus the space used is divided by four thanks to these two transformations <span class="citation">(Heer et al. 2009)</span>. When the goal is to compare monthly values within and across multiple years, a fairly recent display solution has been suggested: <strong>temporal maps</strong> as shown in figure <span class="ref">fig:line_img</span>d <span class="citation">(Koehler 2014)</span>. An extension of this concept, for very high-dimensional datasets, is <strong>pixel-oriented visualization</strong> which consists in using each pixel to display one data value in highly structured arrangements <span class="citation">(Keim 2000)</span>. Both are grids, displaying a value per cell, by a color. Other strategies extend these plots, for example multi-variate metrics can be visualized through comprehensive plotting (figure <span class="ref">fig:line_img</span>c). Spatial metrics can also be visualized through histograms comparing main summary statistics in different scenarios (e.g. the percentage of land areas covered by each 3 category is displayed for 3 drivers, and 4 scenarios using small multiples histograms in figure 4 of the work of <span class="citation">Villamor et al. (2014)</span>)<a href="#fn10" class="footnoteRef" id="fnref10"><sup>10</sup></a>.</p>
<div class="figure">
<img src="../images/horizon_etc.png" alt="Figure 5: Illustrations of concepts of (a) horizon graphs (Heer et al. 2009), (b) streamgraph (Vallandingham n.d.), (c) line graph (Sun et al. 2014) and (d) temporal map (Koehler 2014). (c) comprehensive plotting example for a case of a 4-dimensions dataset plotted with four 3-dimensions figures to display 4*3^3 data points. This is one of the 4 figures, where Sun et al. (2014) displays results of one of the 4 metrics as several line plots (for several variables, here one per market level), and varying parameters (here 3 parameters with 3 possible values each resulting in 3^3 data points per market level, per figure." id="fig:line_img" style="width:100.0%" />
<p class="caption">Figure 5: Illustrations of concepts of (a) horizon graphs <span class="citation">(Heer et al. 2009)</span>, (b) streamgraph <span class="citation">(Vallandingham n.d.)</span>, (c) line graph <span class="citation">(Sun et al. 2014)</span> and (d) temporal map <span class="citation">(Koehler 2014)</span>. (c) comprehensive plotting example for a case of a 4-dimensions dataset plotted with four 3-dimensions figures to display <span class="LaTeX">$4*3^3$</span> data points. This is one of the 4 figures, where <span class="citation">Sun et al. (2014)</span> displays results of one of the 4 metrics as several line plots (for several variables, here one per market level), and varying parameters (here 3 parameters with 3 possible values each resulting in <span class="LaTeX">$3^3$</span> data points per market level, per figure.</p>
</div>
<h3 id="sec:parcoords"><span class="header-section-number">3.1.3</span> Parallel coordinates plot</h3>
<p>Parallel coordinates plots (figure <span class="ref">fig:hadka</span>b) are very effective to display different solutions in a multi-objective context and visualize trade-offs and synergies between objectives under several scenarios. They make relationship and correlation patterns clearly visible <span class="citation">(Achtert et al. 2013)</span>.</p>
<p>The number of scenarios is then nearly unlimited, and so is the number of objectives, to the limit that the axis fit the page. Scenarios are represented as lines, distinguished by varying colors, which intersect horizontal axis representing the objectives. The vertical direction of preferred solution must be clearly indicated to assist interpretation.</p>
<p>Tradeoffs are illustrated by crossing lines. However, one limitation is that each axis having at most two neighboring axis, only N-1 relationships of <span class="LaTeX">$\binom{N}{2}$</span> combinations for an N-dimensional dataset can be visualized at once. This can be overcome by re-ordering the axis, possibly with an interactive tool, or by upgrading to a 3D parallel coordinate plot where the axis are still in parallel, but some appear closer <span class="citation">(Achtert et al. 2013)</span>, although this approach is more difficult to interpret, which may explain why it is not widely used.</p>
<p>Combining parallel coordinates with interactive features offers interesting options to explore the data. For example, brushing allows to extract trends over subsets, furthermore <span class="citation">(Andrienko and Andrienko 2001)</span> recommend linking to other graphics. To contrast alternative options and explore the effects of trade-offs, <span class="citation">Hadka et al. (2015)</span> recommends adjacent 3D scatterplot and parallel coordinates plot,as shown in figure <span class="ref">fig:hadka</span>. The equivalent of parallel coordinates plot for categorical data is the <strong>alluvial plot</strong>; it is also useful to discretize the data into subsets when the dataset is too large for the lines to be distinguished, <span class="citation">Trindade (2017)</span> provides more details. Several tools and packages exist to make both parallel and alluvial plots<a href="#fn11" class="footnoteRef" id="fnref11"><sup>11</sup></a>.</p>
<div class="figure">
<img src="http://ars.els-cdn.com/content/image/1-s2.0-S1364815215300190-gr3.jpg" alt="Figure 6: Four objectives visualization with (a) 3D scatterplot and colors and (b) parallel coordinate plot, achieved with the OpenMORDM open-source R library (Hadka et al. 2015)" id="fig:hadka" style="width:80.0%" />
<p class="caption">Figure 6: Four objectives visualization with (a) 3D scatterplot and colors and (b) parallel coordinate plot, achieved with the OpenMORDM open-source R library <span class="citation">(Hadka et al. 2015)</span></p>
</div>
<h3 id="sec:radar"><span class="header-section-number">3.1.4</span> Radar charts</h3>
<p>The radar chart, as shown in figure <span class="ref">fig:coastal_sm</span>, is the version of parallel coordinates plot in polar coordinates. It has also been referred to as spider chart<a href="#fn12" class="footnoteRef" id="fnref12"><sup>12</sup></a>, web chart, star chart, polar chart, or Kiviat diagram. It can be an interesting way to visualize trade-offs. However, they tend to become cluttered and complicated if with many variables, making comparisons very difficult <span class="citation">Ribecca (n.d.)</span>]<a href="#fn13" class="footnoteRef" id="fnref13"><sup>13</sup></a></p>
<div class="figure">
<img src="../images/radaar.png" alt="Figure 7: (a) Radar chart, in the context of a NatCap project in Kamehameha schools, Hawaii. (b) Small multiples strategy applied to radar charts by Arkema et al. (2015). The multiples correspond here to the 9 considered regions. The difference between these two types of radar charts must be noted: the latter (b) may be criticized and raise graphical integrity concerns, as it leads the reader to interpret on the area but the metric is scaled over the distance from center (doubling the distance out from the center quadruples the area, which could be misleading)" id="fig:coastal_sm" />
<p class="caption">Figure 7: (a) Radar chart, in the context of a NatCap project in Kamehameha schools, Hawaii. (b) Small multiples strategy applied to radar charts by <span class="citation">Arkema et al. (2015)</span>. The multiples correspond here to the 9 considered regions. The difference between these two types of radar charts must be noted: the latter (b) may be criticized and raise graphical integrity concerns, as it leads the reader to interpret on the area but the metric is scaled over the distance from center (doubling the distance out from the center quadruples the area, which could be misleading)</p>
</div>
<h3 id="sec:smallmultiples"><span class="header-section-number">3.1.5</span> Small Multiples</h3>
<p>An effective alternative to coercing all the data in a single plot (risking overplotting) is displaying small multiples. The concept is to replicate the same simple graph structure (in terms of axis, shape and scale), for many datasets, ordered logically. The cognitive process of understanding the graph is undertaken only once, and the understanding then is replicated while scanning all other multiples. This strategy is very efficient in many cases for comparison and broadly used. Referred by the data visualization expert <span class="citation">Tufte (1983)</span>, as “multivariate and data bountiful”, they enforces comparisons of alternatives, differences and changes. This displaying strategy has also been called trellis chart, lattice chart, grid chart, or panel chart. It can be applied to many types of graphs, or maps. Other examples of the small multiple strategy and variants of it can be found in figures <span class="ref">fig:arkemaa</span>a, <span class="ref">fig:coastal_sm</span>b, <span class="ref">fig:addl</span>a.</p>
<h3 id="sec:rdim"><span class="header-section-number">3.1.6</span> Reduce dimensions</h3>
<p>Another approach to reduce cognitive complexity of multi-dimensional data, is to reduce the dimensions in some coherent way. For example, the <strong>principal components analysis</strong> (PCA) can be conducted to reduce the number of variables by combining the correlated ones <span class="citation">(Hotelling 1933)</span>. Similarly, the <strong>choice modeler approach</strong> aims to evaluate multiple decision variants, in a very large decision space. The concept is to identify criteria that do not influence the output (here, the decision option ranking), and remove these dimensions, to simplify without losing correctness <span class="citation">(Jankowski et al. 2008)</span>.</p>
<p>In the same vein, multiple dimensions can be summarized by creating an <strong>aggregated metric</strong>, e.g. an indication of a lake recreation value would combine variables such as water quality, lake size, boat options (Ryan Noe, personal communication). The basic concept to get this aggregated value is to sum each dimension once all have been put into comparable units and weighted according to preference.</p>
<h3 id="sec:multiplelinked"><span class="header-section-number">3.1.7</span> Multiple linked views</h3>
<div class="figure">
<img src="../images/arkemaa.png" alt="Figure 8: Examples of combining static plots: (a) the bar plots display the area of habitat in each risk category (low, medium, high) per planning region (1 to 9), by Arkema et al. (2014). (b) Dense figure using a story-telling approach to present scenarios. It combines bar plots, maps and the small multiples approach. This figure is self-explanatory, and by including a few sentences, it replaces several paragraphs (Arkema et al. 2015)" id="fig:arkemaa" style="width:100.0%" />
<p class="caption">Figure 8: Examples of combining static plots: (a) the bar plots display the area of habitat in each risk category (low, medium, high) per planning region (1 to 9), by <span class="citation">Arkema et al. (2014)</span>. (b) Dense figure using a story-telling approach to present scenarios. It combines bar plots, maps and the small multiples approach. This figure is self-explanatory, and by including a few sentences, it replaces several paragraphs <span class="citation">(Arkema et al. 2015)</span></p>
</div>
<p>Several options to display multi-variate data were discussed above. However they all realistically apply to a limited number of variables. As dimensions of the data increase, it is often interesting to show several linked graphs of the same dataset to convey the complex information. This solution gives different perspectives to the viewer. In the case of a static display, the graphs are connected by matching color coding or other corresponding parameters, as in figures <span class="ref">fig:hadka</span>, <span class="ref">fig:arkemaa</span>a, <span class="ref">fig:arkemaa</span>b and <span class="ref">fig:addl</span>c.</p>
<p>Furthermore, dynamic displays allow improvement by adding brushing and linking features (see <span class="ref">sec:interactivefeatures</span>), examples of interactive dashboards with multiple linked views include <em>(click on the title to be directed to the online version)</em>:</p>
<ul>
<li><a href="https://phawthorne.github.io/mc-vis/">The Middle Cedar visualization</a> (figure <span class="ref">fig:Peter</span>)</li>
<li><a href="http://nascience.us/roi/public/">The Conservation ROI Dashboard</a> (figure <span class="ref">fig:ConservationROIDashboard</span>)</li>
<li><a href="http://vulpes.sefs.uw.edu/ttapp/hra-dash.php">Habitat Risk Assessment Dashboard</a>. This interactive web application displays user’s InVEST output workspace, and was developped in R and Javascript.</li>
<li><a href="https://charlottegiseleweil.github.io/webviz_natcap/">Tana Water Fund Spatial Optimization Results Dashboard (prototype)</a> (figure <span class="ref">fig:webapp_full</span>)</li>
<li><a href="http://vulpes.sefs.uw.edu/ttapp/cv-dash.php">Coastal Vulnerability Dashboard</a></li>
</ul>
<h2 id="spatial-data"><span class="header-section-number">3.2</span> Spatial data</h2>
<h3 id="general-classification-of-maps"><span class="header-section-number">3.2.1</span> General classification of maps</h3>
<div class="figure">
<img src="../images/0_types_of_maps.png" alt="Figure 9: Main types of maps (source: the data visualization catalogue)" id="fig:typesofmaps" style="width:70.0%" />
<p class="caption">Figure 9: Main types of maps (source: <a href="http://www.datavizcatalogue.com/">the data visualization catalogue)</a></p>
</div>
<h4 id="choropleth-maps-and-proportional-symbol-maps"><span class="header-section-number">3.2.1.1</span> Choropleth maps and proportional symbol maps</h4>
<p>Choropleth maps (see figure <span class="ref">fig:typesofmaps</span>a) are very effective and widely used to display a continuous or categorical spatial variable aggregated by regions. The variable of interest is expressed by coloring (or using patterns on) these geographical areas. Particular attention needs to be given to the choice of patterns (see section <span class="ref">sec:colors</span>). Furthermore, it may be necessary to normalize<a href="#fn14" class="footnoteRef" id="fnref14"><sup>14</sup></a> raw data values to ensure graphical integrity <span class="citation">(Heer et al. 2010)</span>. The main drawback of choropleth maps is that larger areas appear emphasised <span class="citation">(Ribecca n.d.)</span>.</p>
<p>Another solution for continuous spatial data aggregated by regions is the graduated symbol map (or proportional symbol map, also called bubble map <span class="citation">(Ribecca n.d.)</span>) that overlays symbols to the base map. In this case, the underlying area does not affect the perception of the variable considered <span class="citation">(Heer et al. 2010)</span>. These two approaches can also be combined, allowing to express more than one variable.</p>
<h4 id="heatmaps-and-dot-density-maps"><span class="header-section-number">3.2.1.2</span> Heatmaps and dot density maps</h4>
<p>Displaying density of occurrence, and identifying clusters can be achieved with heatmaps and hotspot maps. The heatmap can be understood as the continuous version of the choropleth map, without aggregation of the data. It visualizes a scalar function over a geographical area <span class="citation">(Brodlie et al. 2012)</span>. Similarly, in the dot distribution map (or dot density map), the density of dots represents the intensity of the variable. The dots are randomly placed, which may be misleading if unclear to the viewer. Figure <span class="ref">fig:typesofmaps</span> illustrates these.</p>
<h4 id="contour-maps"><span class="header-section-number">3.2.1.3</span> Contour maps</h4>
<p>Also know by contour maps or isarithmic maps, isopleth maps display a variable with contour lines (isopleths) joining the points where the variable has a constant value. For example in the field of ecology, isoflors are isopleths connecting areas of comparable biological diversity <span class="citation">(Specht 1981)</span>. Color fills may be used to enhance the map pattern. Contouring can also be used to highlight areas on a map, as in figure <span class="ref">fig:myanmar_biodiv-ppl</span>b), which combines information about two independent variables, overlaying two types of maps.</p>
<h4 id="cartograms"><span class="header-section-number">3.2.1.4</span> Cartograms</h4>
<p>Cartogram also illustrate data aggregated over regions. The variable to be expressed is substituted to the geographical distance or area. The regions are in the same locations with respect to each other, but their geometry is distorted in proportion to the variable of interest <span class="citation">(Heer et al. 2010)</span></p>
<div class="figure">
<img src="../images/carto.png" alt="Figure 10: Cartogram displaying population (variable) per country (regions of aggregation) (Hennig 2011)" id="fig:carto" style="width:70.0%" />
<p class="caption">Figure 10: Cartogram displaying population (variable) per country (regions of aggregation) <span class="citation">(Hennig 2011)</span></p>
</div>
<h4 id="flow-maps"><span class="header-section-number">3.2.1.5</span> Flow maps</h4>
<p>A flow map illustrates movement in space and/or in time. The intensity of a flow is represented by the thickness of the line depicting it <span class="citation">(Ribecca n.d.)</span>. Flow maps are commonly used to visualize migrations of animals, but can also be applied to pollution load transfer, or groundwater movement from one zone to another.</p>
<p>![Minard’s Napoleon’s March figurative map. This classic example of flow map, drawn up by M. Minard in 1869, depicts the successive losses in men of the French army in the Russian campaign of 1812-1813<a href="#fn15" class="footnoteRef" id="fnref15"><sup>15</sup></a>. It figures multi-variate data, including 6 dimensions that are the army size, its direction, its location in (x,y) coordinates, the dates and the temperature in the lower part of the display. <em>“The best statistical graphic ever drawn”</em> according to Edward Tufte is an example of displaying complexity with clarity. Its great strength reside in its capacity to encode many variables. This example reminds also that successful and effective visualization are very specific to the dataset and message, and its beauty resides in the fact that it is very tailored to the story to be conveyed, here: the numerous deaths of soldiers.</p>
<h3 id="sec:twowidely"><span class="header-section-number">3.2.2</span> Two widely used ES maps</h3>
<p>In the context of ES modeling to inform decisions about landscape management, two types of choropleth maps are very often used:</p>
<h4 id="sec:portfolios"><span class="header-section-number">3.2.2.1</span> Portfolios</h4>
<p>Landcover maps, also called LULC for land use/land cover, represent the full landscape with its corresponding land uses. In a spatial targeting context, oftentimes ES modelers will refer to a <strong>portfolio</strong>, meaning a landcover map which correspond to a subset of the full landscape where interventions or other land management actions are to be undertaken (e.g. protection, restoration, conversion to a specific type of agriculture. Portfolios may be thought of as special cases of land use (or coastal management) <em>scenarios</em><a href="#fn16" class="footnoteRef" id="fnref16"><sup>16</sup></a> – the latter term often being used when a small number of specific land or coastal management options have been developed to reflect stakeholder concerns. When used in this sense, the visualization challenges are essentially the same between the two terms, and we use portfolio for consistency.</p>
<p>When displaying portfolios, highest care must be given to symbology (see recommendations in section <span class="ref">sec:colors</span>). Land cover color schemes can be very tricky, depending on the number of classes and the arrangement. A good example is given by figure <span class="ref">fig:lulc</span>b.</p>
<div class="figure">
<img src="../images/portfolio_lulc.png" alt="Figure 11: Portfolio and land cover maps: (a) a portfolio map of the Nathpa Jhakri catchment (Vogl et al. 2014) and (b) a many-classes LULC color scheme (Courtesy Stacie Wolny)" id="fig:lulc" />
<p class="caption">Figure 11: Portfolio and land cover maps: (a) a portfolio map of the Nathpa Jhakri catchment <span class="citation">(Vogl et al. 2014)</span> and (b) a many-classes LULC color scheme (Courtesy Stacie Wolny)</p>
</div>
<h4 id="sec:objs"><span class="header-section-number">3.2.2.2</span> Objective score maps</h4>
<p>Objective score maps are choropleths with the area of aggregation being generally at the level of the spatial decision unit (which may be a pixel or polygon). These are widely used to visualize ES model outputs. Often, the objective score maps of different ES objectives are combined in a single one summarizing the overall scores (e.g. in the combined figures in appendix <span class="ref">fig:hawaii4</span>).</p>
<p>Objective score maps can display either absolute scores, or the change in score relative to a baseline, in which case they are also referred to as marginal value maps. Examples of marginal objective score maps can be found in appendices <span class="ref">fig:hawaii2</span> and <span class="ref">fig:hawaii3</span>.</p>
<p>A variant of these are the activity score maps, which display the objective score specific to an intervention, by decision unit. They detail the impact of an intervention on a specific ES metric, and therefore help answer questions like: <em>Where in space does a given intervention or scenario improve or worsen a specific ES metric? Where does an activity contribute to objectives?</em>, which the usual objective score maps, looking at the overall change in ES, fails to address. The concept of activity score maps is detailed in figure 6 of <span class="citation">Vogl et al. (2016)</span>.</p>
<h3 id="sec:hotspot"><span class="header-section-number">3.2.3</span> Spatial visualization of tradeoffs</h3>
<p>In the context of spatial targeting of interventions, ES analysts often have to figure out where, on a landscape, do activities produce co-benefits, and where are they in conflict. That is: where does an intervention move multiple ES metrics (objectives) in the same direction to produce <em>win-wins</em> locations? And on the other hand, where in space is a given intervention contributing to some metrics at the expense of others?</p>
<h4 id="hotspot-map" class="unnumbered">Hotspot map</h4>
<p>In the case of only 2 scenarios or only 2 objectives, one could show change maps, or side by side maps, i.e. techniques used to compare 2 maps, detailed in <span class="ref">sec:comp_map_2</span>. For more objectives or scenarios, hotspot maps (figure <span class="ref">fig:Stacie20</span>a) can display location of synergies/tradeoffs of intervention/scenario on multiple ES metrics. The idea of the hotspot map is to select the areas of highest score, for each objective, and find areas of overlaps. For example, as shown in figure <span class="ref">fig:Stacie20</span>a, the top 20% of each service are selected, the selection are then added to construct the hotspot map. The categorical version of a hotspot map details priority/conflicts zones for each objective, as in figure <span class="ref">fig:Stacie20</span>b. This one may appear less intuitive, mostly because of the qualitative colorscale, but is more detailed: one can see precisely which objectives are in conflict.</p>
<div class="figure">
<img src="../images/hotspots.png" alt="Figure 12: (a) Hotspot map in Myanmar for 3 objectives (Wolny, 2016) and (b) Categorical version of a hotspot map: Priority and conflicts areas, in the case of 3 objectives: biodiversity (BD), water quality (WQ) and profit. Thanks to this map, the decision-maker can decide where to intervene on the landscape, depending on which objective(s) (s)he prioritizes (Bryant and Hawthorne n.d.)" id="fig:Stacie20" />
<p class="caption">Figure 12: (a) Hotspot map in Myanmar for 3 objectives (Wolny, 2016) and (b) Categorical version of a hotspot map: Priority and conflicts areas, in the case of 3 objectives: biodiversity (BD), water quality (WQ) and profit. Thanks to this map, the decision-maker can decide where to intervene on the landscape, depending on which objective(s) (s)he prioritizes <span class="citation">(Bryant and Hawthorne n.d.)</span></p>
</div>
<p>A remaining subquestion is about the intensity of tradeoffs and synergies in space: where are tradeoffs more or less stark? An extension of figure <span class="ref">fig:Stacie20</span>b could be envisioned, varying transparency to represent intensity, or using a diverging color scheme (figure <span class="ref">fig:colorschemes</span>c)to convey both intensity and direction of agreement/disagreement Fig 3.1c].</p>
<p>Another strategy consists in combining trade-off curves with small multiples of objective score maps. On trade-offs curves (see section <span class="ref">sec:scatterplots</span>), each point corresponds to a portfolio: displaying these together greatly enhances user understanding. Examples of strategies to display together the trade-off curve and the corresponding maps are presented in figures <span class="ref">fig:addl</span>c and <span class="ref">fig:Peter</span>.</p>
<h3 id="sec:beneficiaries"><span class="header-section-number">3.2.4</span> Relationship between variables</h3>
<p>Expressing relationships between independent or correlated variables is often needed when dealing with several objectives or metrics. For example, it is very relevant in the context of displaying the beneficiaries of a project. This topics seems to trigger growing interest <span class="citation">(Weil 2017)</span>. However, this tasks appears to be very context specific. Typically, the displays would aim to quantify and show the impact on beneficiaries, possibly by subgroups, defined based on demographics or their location. It is also often of interest to contrast beneficiary distribution in space with service distribution in space. For example, figure <span class="ref">fig:myanmar_biodiv-ppl</span>b highlights the relationship between people’s dependency on forests and the location of key biodiversity areas (KBAs).</p>
<h4 id="relationship-between-independent-variables"><span class="header-section-number">3.2.4.1</span> Relationship between independent variables</h4>
<p>Two variables can be expressed at once by combining two maps. Figure <span class="ref">fig:mycombine</span>a shows only the resulting map, while figure <span class="ref">fig:mycombine</span>b displays side by side the two input map and the one combining these, a more self-explanatory but also space-consuming approach.</p>
<div class="figure">
<img src="../images/combine_my.png" alt="Figure 13: Examples of combining two maps by multiplying them, in Myanmar (Mandle et al. 2016). (a) Combining ES maps with population maps to show people’s dependency to ES. This map results from the multiplication of (1) an objective score map for sediment retention, and (2) a map of the number of people who use surface water for drinking, as provided by the national census (b) the top small map displays the number of villages located downstream from regions affected by the flood, the bottom small one indicates how much the natural vegetation contributes to reducing flood risk. The third map results from the multiplication of the two others, and therefore displays the flood risk reduction provided by natural vegetation that benefits the most villages downstream. Displaying these 3 maps on the same page within eyespan facilitates understanding (here, there are squeezed for purposes of space efficiency, but are originally displayed side by side)" id="fig:mycombine" />
<p class="caption">Figure 13: Examples of combining two maps by multiplying them, in Myanmar <span class="citation">(Mandle et al. 2016)</span>. (a) Combining ES maps with population maps to show people’s dependency to ES. This map results from the multiplication of (1) an objective score map for sediment retention, and (2) a map of the number of people who use surface water for drinking, as provided by the national census (b) the top small map displays the number of villages located downstream from regions affected by the flood, the bottom small one indicates how much the natural vegetation contributes to reducing flood risk. The third map results from the multiplication of the two others, and therefore displays the flood risk reduction provided by natural vegetation that benefits the most villages downstream. Displaying these 3 maps on the same page within eyespan facilitates understanding (here, there are squeezed for purposes of space efficiency, but are originally displayed side by side)</p>
</div>
<h4 id="spatial-correlation"><span class="header-section-number">3.2.4.2</span> Spatial correlation</h4>
<p>Spatial correlation can be expressed by displaying correlation statistics computed for corresponding pixels (as in figure <span class="ref">fig:myanmar_biodiv-ppl</span>a displaying correlation coefficients) or by overlaying different maps (as in figure <span class="ref">fig:myanmar_biodiv-ppl</span>b)</p>
<div class="figure">
<img src="../images/spatial_correl.png" alt="Figure 14: Expressing spatial correlation (a) through displaying spatial correlation coefficients between two variables. Here,between each ES considered and the landscape ecological risk (LER) (Gong et al. 2016) (b) Overlaying variables: combining information about biodiversity (contour maps in red showing the key biodiversity areas) and about ES benefits (choropleth map with green gradient), overlayed on a relief map (Mandle et al. 2016)" id="fig:myanmar_biodiv-ppl" />
<p class="caption">Figure 14: Expressing spatial correlation (a) through displaying spatial correlation coefficients between two variables. Here,between each ES considered and the landscape ecological risk (LER) <span class="citation">(Gong et al. 2016)</span> (b) Overlaying variables: combining information about biodiversity (contour maps in red showing the key biodiversity areas) and about ES benefits (choropleth map with green gradient), overlayed on a relief map <span class="citation">(Mandle et al. 2016)</span></p>
</div>
<h4 id="interactive-maps"><span class="header-section-number">3.2.4.3</span> Interactive maps</h4>
<p>Interactive maps allow one to overlay multiple layers corresponding to multiple variables, allowing to explore relationship between different variables/layers. Good examples include:</p>
<ul>
<li><a href="http://www.myanmarnaturalcapital.org/en">Myanmar Natural Capital: a storytelling approach for a project involving multiple ecosystem services</a>. The tools used here are D3.js, leaflet, openStreetMaps, Google Maps and photoshop.</li>
<li><a href="http://coastalresilience.org/tools/apps/#apps_id%7Cassess-risk%7C1">The Nature Conservancy also developed a visualization platform, gathering a suite of web applications based on maps</a>, aiming to convey and/or simplify ecological concepts, assess risk, identify and compare different solutions and scenarios. For example, <a href="http://maps.coastalresilience.org/gulfmex/">the coastal resilience interactive map in the Gulf of Mexico.</a></li>
<li><a href="http://www.geointerest.frih.org/NatCap/">The Mapping portal for the Belize project by Gregg Verutes, developped with Mapbox, and OpenStreetMap</a> and <a href="http://marineapps.naturalcapitalproject.org/bahamas/">a similar map web viewer from the same author, for coastal hazard model results in the Bahamas.</a></li>
</ul>

<h2 id="sec:compare"><span class="header-section-number">3.3</span> Comparison of multiple spatial runs</h2>
<p><em>Runs</em> refers here to different versions of a spatially explicit variable; this section is about comparing multiple maps expressing the same variable - while comparison of maps expressing different variables was treated in sections <span class="ref">sec:hotspot</span> and <span class="ref">sec:beneficiaries</span>. This multiplicity of outputs may correspond to multiple scenarios, objectives or varying parameters values (i.e. sensitivity analysis, this case is further described in section <span class="ref">sec:SA</span>). Summarizing these multiple spatial model outputs is necessary in applications such as:</p>
<ul>
<li>portfolios comparison, to understand trends in agreement and disagreement on recommended action, in contexts of land use change planning or spatial targeting.</li>
<li>comparison of ES model outputs such as objective scores at pixel or polygon level, to understand similarity and differences between maps of several ES objectives under one scenario, or the maps of same objective under several scenarios. Many maps are often generated under many combinations of scenarios or parametric uncertainty. Relevant examples also include comparing objective score maps associated with many points on an optimization frontier.</li>
</ul>
<p>Comparison and summaries of spatial data can be achieved either by visualizing spatially as maps (see <span class="ref">sec:comp_map</span>) or through quantitative indices and metrics synthesizing the results aspatially (see <span class="ref">sec:metricsmultrunscat</span> for categorical data summary indices, <span class="ref">sec:metricsmultrunscont</span> for continuous data).</p>
<h4 id="map-comparison-tools" class="unnumbered">Map comparison tools</h4>
<p>Automated comparison of maps can be achieved with software like the* Map Comparison Kit<em><a href="#fn17" class="footnoteRef" id="fnref17"><sup>17</sup></a> <span class="citation">(Visser and De Nijs 2006)</span>. An algorithm called</em>Mapcurves<em>, implemented in R and Matlab, provides a goodness-of-fit measure based on spatial overlap.</em>TerrSet* software also provdes GIS analysis features, including multiple map comparison and a variety of spatial statistics <span class="citation">(ClarkLabs 2015)</span>. The R packages <em>raster</em> and <em>lulcc</em> also provide basic statistical functionality like Moran’s I, and multi-resolution analysis (see <span class="citation">Pontius and Millones (2011)</span> for the last).</p>
<h3 id="sec:comp_map"><span class="header-section-number">3.3.1</span> Maps displays</h3>
<h4 id="sec:comp_map_2"><span class="header-section-number">3.3.1.1</span> Between two maps</h4>
<h4 id="interactive-switching-between-maps" class="unnumbered">Interactive switching between maps</h4>
<p>For the examination of (dis)agreement between two maps, analysts often like to flip back and forth between the two (from survey results). This is easy to do in GIS software and is a convenient solution for the data exploration purposes. Nevertheless, this method is not always suited for communication purposes. Plus, this interactive solution doesn’t apply to static documents.</p>
<h4 id="side-by-side-maps" class="unnumbered">Side by side maps</h4>
<p>A classic static option consists in showing the two maps next to each other. This is not the most space effective option, but allows an intuitive understanding and facilitates comparison. The two maps must be within eyespan (avoid page breaks).</p>
<h4 id="change-map" class="unnumbered">Change map</h4>
<p>Subtracting one map to the other (the other generally corresponding to the baseline scenario) results in a change map. Typically change maps use diverging color schemes, with two colors representing increase and decrease, and the intensity gradient reflects the amount of change. These are suited for scenario comparison with a baseline scenario, or how two future scenarios differ from each other. An example can be found in additional figure <span class="ref">fig:addl</span>b.</p>
<h4 id="sec:comp_map_many"><span class="header-section-number">3.3.1.2</span> Between many maps</h4>
<p>The problem complicates when comparing many runs. In the context of multiple continuous ES model outputs, such as objective score maps for several ES services, a hotspot map can be constructed (detailed in section <span class="ref">sec:hotspot</span>) but is limited to few objectives. Other strategies are suggested below.</p>
<h4 id="maps-matrix-small-multiples-strategy" class="unnumbered">Maps matrix (small multiples strategy)</h4>
<p>When the number of maps to compare is low enough to fit in a page, with a reasonable resolution, the small multiple approach (see section <span class="ref">sec:smallmultiples</span>) is relevant, as in figure <span class="ref">fig:addl</span>a.</p>
<h4 id="footprint-map" class="unnumbered">Footprint map</h4>
<p>To express the the extent of where interventions might be considered, footprint maps show which areas have been selected as part of any portfolio under consideration. Pixels are assigned a binary value (1 if the pixel was selected in any portfolio for any intervention, 0 otherwise). To express agreement about an activity across portfolios, footprint maps can also be done for a specific category (1 is assigned is the pixel was selected in this category).</p>
<h4 id="modal-portfolio-and-frequency-map" class="unnumbered">Modal portfolio and frequency map</h4>
<p>For categorical data, the frequency map approach would display the frequency with which the modal category is assigned to each unit across runs; the modal category being defined according to the context, typically the most assigned category to each area across <span class="citation">(Bryant et al. 2015)</span>. In the context of portfolios, this is called the modal portfolio, displaying the most often chosen activity for each spatial unit<a href="#fn18" class="footnoteRef" id="fnref18"><sup>18</sup></a>. The comparison part is held by the frequency map, which express how often was the activity chosen. Precisely, the frequency map is usually constructed as such: for each spatial unit, number of portfolios where the modal value is chosen divided by total number of portfolios. These two maps complement each other: the modal portfolio is about summarizing when the frequency map associated hold indications on comparison. They can be overlayed or displayed side by side, as in <span class="ref">fig:RIOS</span>.</p>
<div class="figure">
<img src="../images/RIOS.png" alt="Figure 15: Example for a set of 57 runs, over a subwatershed, modified from Bryant et al. (2015). In the frequency map (b), the prevalence of dark green indicates that most activities are quite robust." id="fig:RIOS" />
<p class="caption">Figure 15: Example for a set of 57 runs, over a subwatershed, modified from <span class="citation">Bryant et al. (2015)</span>. In the frequency map (b), the prevalence of dark green indicates that most activities are quite robust.</p>
</div>
<h4 id="categorical-map-diversity-indices" class="unnumbered">Categorical map diversity indices</h4>
<p>An alternative to frequency maps, to summarize the categorical variance across many runs is to use a diversity index, such as the <strong>Shannon diversity index</strong>: for each pixel <span class="LaTeX">$SDI = - \sum_{i=1}^{R} p_{i} \ln(p_{i})$</span>, with <span class="LaTeX">$\textrm{p}_{i}$</span> the proportion of cells assigned to category i, and <span class="LaTeX">$R$</span> the total number of categories. How to interpret the SDI: when evenly distributed, <span class="LaTeX">$SDI = \ln(R)$</span>, and as it approaches <span class="LaTeX">$0$</span>, proportions in each category vary more. Hence, SDI reflects the relative abundance of each category across the pixel stack. So, the smaller the SDI, the more confident one can be about the pixel’s most chosen category. Other diversity indices can also be substituted, such as the Evenness index, see the work of <span class="citation">Kitsiou and Karydis (2000)</span> for details.</p>
<p>The <strong>fuzzy set approach</strong> <span class="citation">(Hagen 2003)</span> assesses the similarity of several categorical maps, resulting in a fuzzy set comparison map where each cell displays a degree of similarity and an overall value for similarity, so-called <span class="LaTeX">$\kappa$</span>-Fuzzy as it extends the Kappa index including fuzziness of category and of location.</p>
<p>Similarly, a <strong>coefficient of unlikeability</strong> measure variability in categorical data by considering how often, not how much, observations differ <span class="citation">(Kader and Perry 2007)</span>. Calculated for each cell. It should be interpreted as such: the coefficient is high if different interventions were chosen (i.e. low agreement), and low if the same intervention tended to be chosen (high agreement). So it reflects (the inverse of) agreement across maps.</p>
<h4 id="variant-invariant-method" class="unnumbered">Variant-invariant method</h4>
<p>In the same vein, the <strong>variant-invariant method</strong> aims to distinguish the invariant regions, that is the areas where the category assigned is consistently the same (see <span class="citation">Brown et al. (2005)</span>).</p>
<h4 id="spaghetti-plots" class="unnumbered">Spaghetti plots</h4>
<p>Visualizing flow data, <strong>spaghetti plots</strong> (figure <span class="ref">fig:spag3D</span>a) express consistency between runs. Widely used in meteorology, the consistency of the runs is expressed by how tightly clustered they appear. Spaghetti plots may be translated to continuous spatial data by using the isocontour of each run, which is useful when concerned about a specific threshold.</p>
<h4 id="d-plots-overlaying-maps" class="unnumbered">3D plots overlaying maps</h4>
<p>For continuous data, <strong>3D plots overlaying maps</strong> (figure <span class="ref">fig:spag3D</span>b) have been used to highlight structural differences across maps. However, this solution seems limited to relatively small regions, and clearly distinguishable distributions of the variables expressed through color and height of the histogram.</p>
<div class="figure">
<img src="../images/spag3D.png" alt="Figure 16: (a) Spaghetti plots displaying ensemble datasets (Wilson and Potter 2009). The spaghetti plot is the isocontour of each run. If the runs agree (Fig. left), it will result in a coherent bundle. Slight disagrements induce divergence from the main bundle (Fig. right). (b) 3D histograms, organized according the geographical layout; extract from figure 8 of Huang et al. (2013)" id="fig:spag3D" />
<p class="caption">Figure 16: (a) Spaghetti plots displaying ensemble datasets <span class="citation">(Wilson and Potter 2009)</span>. The spaghetti plot is the isocontour of each run. If the runs agree (Fig. left), it will result in a coherent bundle. Slight disagrements induce divergence from the main bundle (Fig. right). (b) 3D histograms, organized according the geographical layout; extract from figure 8 of <span class="citation">Huang et al. (2013)</span></p>
</div>
<h4 id="interactive-map-comparisons" class="unnumbered">Interactive map comparisons</h4>
<p>Animation is of great interest in this context. Dynamic visualizations are very suited for displaying multiple spatial outputs, there are increasingly used to display results in the field of ABMs[^1back], encountering similar type of outputs <span class="citation">(Lee et al. 2015)</span>.<br />
[^1back]: Agent-based modeling (ABM), or indivisual-based modeling consist in representing phenomenas as dynamical systems of interacting agents, where an agent is a discrete and autonomous entity. Their individual behaviors are encoded, resulting in outputs describing the the agents’ interactions that are used to describe complex systems. These systems can be a variety of processes, phenomena, and situations in any field. <span class="citation">(Rand 2015)</span> In the context of this work, ABM is of interest because simulation runs often produce a high volume of multidimensional output data (e.g. induced by Monte Carlo sampling), requiring visualization and statistical analysis of the outputs.</p>
<h3 id="sec:metricsmultrunscat"><span class="header-section-number">3.3.2</span> Aspatial metrics to summarize results and agreements of categorical maps</h3>
<p>Visual comparisons of maps is efficient and not too intense cognitively for human perception. However, it fails to rank quantitatively the results, nor is adapted to an important number of maps. Screening through hundreds of maps produced is not a viable option. Therefore, other solutions must be considered. In particular, a variety of non-spatial statistics can be used to summarize results and agreement over maps of the same area. The quantitative indices presented in this section and the next one (<span class="ref">sec:metricsmultrunscont</span> for continuous data) are suited for the purposes of summarizing results across many maps. This list is not exhaustive but aims to give an overview of this broad topic.</p>
<h4 id="sec:comp_stat_cat_2"><span class="header-section-number">3.3.2.1</span> Between two maps</h4>
<p>There are different types of categorical (i.e. discrete attributes) map consistency measures <span class="citation">(Kuhnert et al. 2005)</span>:</p>
<h4 id="total-per-categories" class="unnumbered">Total per categories</h4>
<p>The coarsest approach would be to compare the total numbers of cells<a href="#fn19" class="footnoteRef" id="fnref19"><sup>19</sup></a> assigned to each category, neglecting any spatial patterns. This gives a very general quantitative overview of the total per categories, that can be delivered as tabular data. (All the other, finer approaches detailed below imply a cell-by-cell comparison.)</p>
<h4 id="percent-agreement" class="unnumbered">Percent agreement</h4>
<p>A basic cell-by-cell comparison method measures simply the overall agreement (or percent agreement) by calculating the portion of cells that agree between two maps:<br />
(Cell-by-cell level of agreement) = (Number of direct matched cells between 2 maps) / (Total number of cells in map)</p>
<h4 id="kappa-index-of-agreement" class="unnumbered">Kappa index of agreement</h4>
<p>KIA or Cohen’s <span class="LaTeX">$\kappa$</span> is a widely used statistic measuring concordance between categorical items. This technique has proven efficient for cell-by-cell comparisons of spatial data <span class="citation">(Manson 2005)</span>, as long as patterns and locations of changes are not involved <span class="citation">(Kuhnert et al. 2005)</span>. It is more robust than a percent agreement because it takes into account the agreement occurring by chance. <span class="LaTeX">$\kappa = \frac{\textrm{p}_{0}-\textrm{p}_\textrm{e}}{1-\textrm{p}_\textrm{e}}$</span> with <span class="LaTeX">$\textrm{p}_{0}$</span> being the proportion of units agreeing, and <span class="LaTeX">$\textrm{p}_\textrm{e}$</span> the proportion of units expected to agree by chance (i.e. the hypothetical probability of chance agreement). Complete agreement results in <span class="LaTeX">$\kappa = 1$</span> <span class="citation">(Cohen 1960)</span>.</p>
<p>However, after publishing his work about <span class="LaTeX">$\kappa$</span>, <span class="citation">Pontius (2000)</span> later reconsidered his positions and advocated against the use of this index because of several flaws, mainly the irrelevance of the randomness baseline in many applications, and the fact that the ratio is difficult to interpret and overly complicated, as only the numerator actually matters <span class="citation">(Pontius and Millones 2011)</span>. Instead, he suggests to use quantity disagreement and allocation disagreement measures (see next point).</p>
<h4 id="quantity-location-fit" class="unnumbered">Quantity &amp; location fit</h4>
<p>A more precise version of the <span class="LaTeX">$\kappa$</span> approach explained above consists in analyzing 2 metrics, measuring respectively the quantity disagreement and allocation disagreement. These are more helpful to understand both components of disagreement than with a single statistic of agreement. <span class="citation">(Pontius and Millones 2011)</span>. For example:</p>
<ul>
<li>The <strong>quantity fit</strong> informs on the number of cells that changed from one category to another, offering an overall comparison on the quantity of each category: <span class="LaTeX">$$Quantity \ fit = 1 - \frac{1}{N}\sum \left |  \textrm{a}_\textrm{1i} - \textrm{a}_\textrm{2i} \right |$$</span> where <span class="LaTeX">$\textrm{a}_\textrm{ki}$</span> is the number of cells assigned to category <span class="LaTeX">$i$</span>, in map <span class="LaTeX">$k$</span> with <span class="LaTeX">$k \subseteq (1,2)$</span>, <span class="LaTeX">$N$</span> the total number of cells in map and <span class="LaTeX">$C$</span> means all categories <span class="citation">(Kuhnert et al. 2005)</span>.</li>
<li>The <strong>location fit</strong> informs on the number of cells that kept the category but changed location from one map to another: <span class="LaTeX">$Quantity \ fit = (Location \ fit) \ - \ (Cell-by-cell\  level\  of\  agreement)$</span> Another possible way of measuring the location disagreement is the <strong>distance between the locations of matching cells</strong> in the maps can also be calculated <span class="citation">(Kuhnert et al. 2005)</span>. An overall measure of distance between two discrete maps expresses the amount of agreement or the goodness of fit <span class="citation">(Seppelt and Voinov 2003)</span> and <span class="citation">(Costanza 1989)</span>.</li>
</ul>
<h4 id="jaccard-index" class="unnumbered">Jaccard index</h4>
<p>Other indices comparing agreement across categorical datasets exist. However, very few to no applications in comparing maps has been found. The Jaccard index, also known as Tanimoto index, is computed as the ratio of the intersection of the two sets over their union: <span class="LaTeX">$$Jaccard\ index = \frac{Map1 \cap Map2}{Map1 \cup Map2}$$</span> <span class="citation">(Van Rijsbergen 1979)</span>. Simple to understand, it ranges from 0 to 1, increasing with increasing similarity between the sets. The <strong>Sørensen-Dice coefficient</strong> is a slightly different version of the Jaccard index. Also called the Dice similarity coefficient , or F1 score, it is calculated as such: <span class="LaTeX">$$Sorensen-Dice\ index={\frac {2|Map1\cap Map2|}{|Map1|+|Map2|}}$$</span> More similarity measures for categorical data have been explored by Lourenco <span class="citation">(Lourenco et al. 2004)</span>.</p>
<h4 id="sec:comp_stat_cat_many"><span class="header-section-number">3.3.2.2</span> Between many maps</h4>
<p>When comparing a large number of maps, aggregation often is necessary to communicate results <span class="citation">(Brown et al. 2005)</span>. Some of the metrics detailed above that calculate correlation between two maps may be extended to many maps comparison <span class="citation">(Seppelt and Voinov 2003)</span>, like the total per categories approach:</p>
<h4 id="total-per-categories-1" class="unnumbered">Total per categories</h4>
<p>Calculating the total numbers of pixels assigned to each category (as in previous section) resulting in a table, with categories in comuns and runs in rows, which works if there are not too many runs. If there are, one may display a simple table linking categories with summary statistics indicating some measure of the mean and the variance (e.g. average and extrema or standard deviation), as exemplified in the table below<a href="#fn20" class="footnoteRef" id="fnref20"><sup>20</sup></a>. However, this measure only accounts for the overall amount of each category, and not for spatial distribution.</p>
<table>
<caption>Hypothetical example to illustrate the <em>total per categories</em> approach</caption>
<thead>
<tr class="header">
<th>Land cover</th>
<th>Grass</th>
<th>Forest</th>
<th>Barren</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Average pixels [min;max]</td>
<td>121 [110;143]</td>
<td>204 [158;226]</td>
<td>25 [14;50]</td>
</tr>
<tr class="even">
<td>Average percentage ± standard deviation</td>
<td>35% ± 2%</td>
<td>58% ± 3%</td>
<td>7% ± 3%</td>
</tr>
</tbody>
</table>
<h4 id="cell-stack-methods" class="unnumbered">Cell stack methods</h4>
<p>Finer methods imply to make calculations for each cell, in all the considered maps (as in, superposing all maps, and making calculation for the column of corresponding cells). For raster data, this technique of <em>column of cells</em> is referred to as pixel stack, raster stack, cell stacks, z-profile or vector of values. To summarize agreement between runs in a single number, the measures suggested in <span class="ref">sec:comp_map_many</span> can be aggregated. For example, the average SDI would give an indication of the consistency of the runs. However, these overall average do not give any indications on spatial patterns.</p>
<h4 id="comparison-of-landscape-metrics" class="unnumbered">Comparison of landscape metrics</h4>
<p>Some spatial metrics allow a user to identify and account for spatial patterns. They allow tabular comparisons of some runs (the indices are calculated for each run). They include Area-weighted mean shape index, centrality indices, contagion index <span class="citation">(Lee et al. 2015)</span>. Some are more specific landscape metrics, such as the average core area, which is the proportion of production land per land cover category <span class="citation">(Parker and Meretsky 2004)</span>, and the average patch perimeter-area ratio (PA-1) <span class="citation">(Ritters et al. 1995)</span>. Landscape statistics measuring sprawl and fragmentation include landscape shape index (LSI), aggregation index (AI) contiguity index (CI) and centrality index (CTI). Together, they allow for comparison of landscape, spatial patterns of change and overall spread <span class="citation">(Sun et al. 2014)</span>. More details on landscape metrics can be found in section 4.16 of <span class="citation">Lee et al. (2015)</span>, among other references previously stated.</p>
<h3 id="sec:scale"><span class="header-section-number">3.3.3</span> Influence of scale in map comparison and taking patterns into account</h3>
<p>Spatial patterns may be interesting because solely computing the number of cell-to-cell matches is not reliable in all circumstances, as if there is a matching cell right nearby, it will not be taken into account (e.g. if we compare two chessboards shifted by one square, the number of cell-to-cell matches is null although there is evident similarity not to be ignored) <span class="citation">(Kuhnert et al. 2005)</span>. The <strong>moving window algorithm</strong> addresses this issue and accounts for landscape patterns by considering neighboring cells in addition to the cell-to-cell comparison <span class="citation">(Kuhnert et al. 2005)</span>. In the same vein, the <strong>ECE method</strong> (edge correlated error) also accounts for edge effect <span class="citation">(Dean 2005)</span>.</p>
<p>Another strategy to address the same concern of accounting for arrangement similarity, instead of moving a “window”, is to vary the resolution considered. The <strong>hierarchical fuzzy pattern matching</strong> avoids drawbacks of a cell-by-cell comparison by aggregating the regional unit considered in patches, and conducting comparisons at different scales <span class="citation">(Power et al. 2001)</span>. More suggestions can be found in the work of <span class="citation">Remmel and Csillag (2006)</span> who compare maps at different resolution to find hierarchical nested patterns, and of <span class="citation">Dean (2005)</span> who suggests to compare <strong>quadtrees</strong> (a hierarchical structure form of representing raster data) at different scales, resulting in the Quadtree-Based Arrangement Similarity (QBAS) index.</p>
<p>The influence of scale and the consistency of spatial patterns in pixel data, at coarser resolution are questions of interest in the context of natural capital. Pontius explores the influence of resolution in map comparison (Pontius, 2008 and 2011), by conducting comparisons at multiple scales. He notes that the format of the data (the resolution considered) impacts tremendously the results which sometimes are more due to this format, than the underlying landscape patterns. One of his ideas is to plot a total measure of difference (e.g. a sum of mean squares of a cell-to-cell comparison) at different resolutions: this plot gives an idea of allocation error relative to mean error and how the allocation error decays with distance. <span class="citation">Remmel and Csillag (2006)</span>, <span class="citation">Power et al. (2001)</span> and <span class="citation">Dean (2005)</span> also point out the scale effects while attempting to take into account patterns, spatial shapes and arrangements in map comparisons. There is not yet a clearly adopted methodology to account for scale in ES spatial data analysis, and this topic could benefit from further research. For example, in the context of water-related ES, one may be interested into taking the hydrology of the landscape into account.</p>
<p>However, these methods are relevant only to categorical data, and little information has been found about the influence of scale for continuous maps, that are about to be discussed in the following section.</p>
<h3 id="sec:metricsmultrunscont"><span class="header-section-number">3.3.4</span> Aspatial metrics to summarize results and agreements of continuous maps</h3>
<p>One handy strategy to handling continuous data is simply to <strong>discretize</strong> it, by sorting the dataset into categories corresponding to ranges of values. This allow to use all the metrics discussed above (section <span class="ref">sec:metricsmultrunscat</span>) for comparison. However, the arbitrary classification will impact the results. For a reliable metric, it is therefore necessary to do several different classification (i.e. discretize the dataset with different limits/size of categories). This approach, in the fields of statistics and image processing, has been referred to as <em>binning</em>, defined as grouping continuous values into bins, as implemented in many software packages (e.g. <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/bincode.html">R documentation</a>).</p>
<h4 id="sec:comp_stat_cont_2"><span class="header-section-number">3.3.4.1</span> Between 2 maps</h4>
<h4 id="aggregation-of-cells-values-sum-or-mean" class="unnumbered">Aggregation of cell’s values: sum or mean</h4>
<p>Each map can be summarized with a value aggregating cell’s values. For example, for an objective score map, the overall objective score of the map is the sum of the pixel’s scores. The average could also be used to aggregate. Once each map has an aggregated “summary value”, these can be subtracted to reflect the numerical difference in ES between 2 scenarios.</p>
<h4 id="spatial-correlation-indices" class="unnumbered">Spatial correlation indices</h4>
<p>Statistical indices like the Bivariate Moran’s I or LISA (Local indicators of spatial association) aim to measure spatial autocorrelation between 2 variables in a same location <span class="citation">(Matkan et al. 2013)</span>, which can correspond to two runs of the same variable. The field of spatial statistics digs more into these metrics.</p>
<h4 id="non-spatial-metrics" class="unnumbered">Non spatial metrics</h4>
<p>Other non-spatial correlation coefficients also can be applied to summarize spatial data, though care must be taken to avoid improper interpretations of statistical tests. An example is the <strong>Pearson linear correlation</strong>: <span class="LaTeX">$$\rho _{X,Y}={\frac {\operatorname {cov} (X,Y)}{\sigma _{X}\sigma _{Y}}}$$</span> It ranges from -1 (negative linear correlation) to +1 (positive linear correlation), and 0 corresponds to maps not correlated, or its variant, the reflective correlation.</p>
<p>Other standard statistical tests and summary statistics, not specific to spatial data, can also be used to summarize variance. For example, disagreement between two maps can be summarized by their variance, i.e. the normalized average of corresponding cell’s squared difference: <span class="LaTeX">$$\sum_{cells} (v_1 - v_2)^2$$</span> where <span class="LaTeX">$v_1, v_2$</span> would be the same cell’s value in <span class="LaTeX">$Map_1, Map_2$</span>, possibly weighted by the relative importance of the cell (for example, the population if displaying results related to beneficiaries). This is just an idea, however, references to a least squares method have been found in literature, referring to it as a conventional approach, which would be to compute the least square on the plotted points (Pontius, 2008).</p>
<h4 id="sec:comp_stat_cont_many"><span class="header-section-number">3.3.4.2</span> Between many maps</h4>
<p>Besides discretizing the data and then using methods from <span class="ref">sec:comp_stat_cat_many</span>, a solution would be an aggregation of aggregated map values: summary statistics on map-wide statistics. As mentioned above, each map can be summarized with a value aggregating cell’s values. For example, for an objective score map, the overall objective score of the map is the sum of the pixel’s scores. A second aggregation can follow: for example, the mean or range of these overall objective scores provide second order statistics on the collection of maps (e.g. it will give an indication of average total objective score of scenarios), and one can also compare distributions of different subsets of maps.</p>
<p>Measures of dispersion are also interesting in this context, especially when comparing across two <em>populations</em> of maps (e.g. one set generated under the assumption of a climate change scenario, another set under a different assumption).</p>
<h2 id="sec:uncertainty"><span class="header-section-number">3.4</span> Uncertainty</h2>
<blockquote>
<p><em>“Finding ways to accurately and effectively represent uncertainty is one of the most important challenges in data visualization today. And it’s important to know that visualizing uncertainty in general is extremely difficult to do.”</em><br />
<em><span class="citation">Torres (2016)</span></em></p>
</blockquote>
<h3 id="introduction-to-uncertainty-sensitivity-analysis-visualization"><span class="header-section-number">3.4.1</span> Introduction to uncertainty &amp; sensitivity analysis visualization</h3>
<p>It is often of interest to analysts to consider how input uncertainty and model structure affect the precision and robustness of findings. Uncertainty may arise from modeling choices, parameters (see in particular section <span class="ref">sec:SA</span>) or future scenarios (e.g. future climate conditions). The inclusion of uncertainty estimates improves decision making (<span class="citation">Reichert and Borsuk (2005)</span> and <span class="citation">Beven (2006)</span> among others). Because ecosystem services depends on unique landscape characteristics, each case is unique and different procedures can be specifically chosen to generate summaries of robustness and sensitivity <span class="citation">(Ligmann-Zielinska et al. 2014)</span>. However, uncertainty is often just ignored in the representation because it is challenging to visualize <span class="citation">(Torres 2016)</span>. Conveying both statistical and data uncertainties is nevertheless essential to a thorough communication of results.</p>
<div class="figure">
<img src="../images/UA_SA-lig14.png" alt="Figure 17: Uncertainty analysis and sensitivity analysis (Ligmann-Zielinska et al. 2014)" id="fig:SAoo" />
<p class="caption">Figure 17: Uncertainty analysis and sensitivity analysis <span class="citation">(Ligmann-Zielinska et al. 2014)</span></p>
</div>
<p>Closely related concepts must be distinguished: uncertainty analysis (UA) aims to explore the variability of the results; whereas sensitivity analysis (SA) explores the factors responsible for such variability. Robustness is considered when conducting uncertainty analysis; defined as <em>“the ability of a system to resist change without adapting its initial stable configuration”</em> <span class="citation">(Wieland and Marcus Wallenburg 2012)</span>, it can be understood as insensitivity to changes <span class="citation">(Maier et al. 2016)</span> or also a function of performance under many states of the world. In the context of decision making, a decision is qualified robust if not vulnerable to changes, i.e. if it leads to the desired outcomes under different states of the world. However, the concept of robustness is somehow vague, and cover several interpretations overlapping with UA and SA. For example, assessing the robustness of many runs resulting from uncertain inputs or model assumptions can be considered as a sensitivity analysis <span class="citation">(Pianosi et al. 2016)</span>.</p>
<p>The following discussion is limited to scalar and spatial data, leaving aside data types that are rarely encountered in the context of natural capital information such as 3D datasets, that are further explored by <span class="citation">Brodlie et al. (2012)</span>.</p>
<h3 id="sec:uncert_aspat"><span class="header-section-number">3.4.2</span> Non-spatial data uncertainty displays</h3>
<p>Not only does uncertainty adds a dimension to the visualization, it is especially complex because it depends directly on the data itself, and also because uncertainty propagates, i.e. if the data is transformed to be visualized, its underlying uncertainty propagates, not necessarily in a trivial way <span class="citation">(Correa et al. 2009)</span>. Uncertainty can be presented in different ways, for example as a function of the data, (as a PDF, as a multi-value data) or as bounded data.</p>
<p>For one dimensional scalar data, uncertainty can be represented with <strong>error bars</strong> <span class="citation">(Ehlschlaeger et al. 1997)</span>. <strong>Box plots</strong> are also common to express variability by showing the quartiles. An extension of these are the <strong>violin plots</strong>, additionally displaying the probability density (kernel density estimation) of the data at each value <span class="citation">(Hintze and Nelson 1998)</span>.</p>
<p><strong>Contouring</strong> by displaying around the mean an indication of the spread, or the standard deviation, allow to visualize the range among which the variable can locate <span class="citation">(Brodlie et al. 2012)</span>. This is common for time-series datasets.</p>
<h3 id="sec:uncert_non_maps"><span class="header-section-number">3.4.3</span> Spatial data uncertainty metrics</h3>
<p>Many ES analysts (responding to the survey) came to the conclusion that uncertainty seems best understood in an aspatial manner, as spatial representations can often be difficult to digest. At NatCap, visualizing uncertainty has generally been handled via tabular representations or in a narrative format (according to survey answers). In this context, summary metrics are necessary.</p>
<p>In general for uncertainty analysis, two statistics are very relevant to display: a measure of central tendency, such as the mean, and an indicator of dispersion, for example the variance or standard deviation <span class="citation">(Ligmann-Zielinska et al. 2014)</span>, but also extrema (minimum and maximum, or extreme percentiles); these measures of range are the most relevant when dealing with deep uncertainty (see also <span class="citation">Hadka et al. (2015)</span>).</p>
<p>There are also specific measures for robustness, based on the fraction of states of the world in which a conclusion remains valid or a strategy performs acceptably. Robustness measures of two types: <strong>regret and satisficing measures</strong>. The former seek to minimize expected loss, that is difference with respect to the solution that would be chosen under perfect information, ; the latter seek to maximize the range of solutions that are “good enough” <span class="citation">(Hadka et al. 2015)</span>. Robustness of an output is contingent upon the consistency between multiple runs leading to this output, under varying conditions. Therefore, spatial metrics measuring agreement between multiple runs, as detailed in sections <span class="ref">sec:metricsmultrunscat</span> and <span class="ref">sec:metricsmultrunscont</span> can be used for assessing robustness, and will not be repeated here, to avoid redundancy. Furthermore, there is an approach specific to robustness in the context of decision making. Methods based on the <strong>breakeven point</strong> inquire about the magnitude of change that would result in changing the decision. In the context of spatial targeting, the breakeven ratio is defined as the prioritization score of the best choice over the prioritization score of the second best choice. This metric applied to spatial data result in prioritization score breakeven maps, which are efficient displays of how much the prioritization score of the chosen category would need to be reduced before switching to the second best category <span class="citation">(Bryant et al. 2015)</span></p>
<h3 id="sec:uncert_maps"><span class="header-section-number">3.4.4</span> Spatial data uncertainty map displays</h3>
<p>The most common static visualization techniques for spatial data uncertainty include:</p>
<h4 id="juxtaposition-of-an-uncertainty-map" class="unnumbered">Juxtaposition of an uncertainty map</h4>
<p>That is adding a separate similar figure to represent solely uncertainty (via a choropleth or heatmap with a sequential color scheme expressing a measure of uncertainty for example), alongside the representation of the data.</p>
<h4 id="overlaying-an-uncertainty-variable" class="unnumbered">Overlaying an uncertainty variable</h4>
<p>Another approach consists in overlaying a visualization of uncertainty on top of the main one. <span class="citation">(Bingham and Haines 2006)</span> overlays a contour map of an error field on top of a heatmap of the mean value of a multivalue dataset, but it is not so straightforward. Integrating additional geometrical objects, such as labels, volume rendered thickness, or error bars may express uncertainty <span class="citation">(Griethe and Schumann 2006)</span>. Circular glyphs and ribbons have been designed, in the context of weather forecast ensemble data, to visualize uncertainty <span class="citation">(Sanyal et al. 2010)</span>.</p>
<h4 id="modifying-the-displayed-variable-to-account-for-uncertainty" class="unnumbered">Modifying the displayed variable to account for uncertainty</h4>
<p>Varying the value of a free graphical variable, such as a property of the color palette used to visualize the main data, can also express uncertainty. The first option is <strong>“blurring”</strong>: the focus is adapted proportionally to the level of uncertainty, this can be done through one of these parameters: contour crispness (“fuzzyness”), fill clarity or resolution <span class="citation">(Maceachren 1992)</span>. Formally, blurring is defined as removing spatial high frequency details <span class="citation">(Russ 1995)</span>. <strong>Saturation</strong> is the second option, in which uncertainty is expressed by paleness, also referred to as whiteness <span class="citation">(Hengl 2003)</span>. More options include texture and edge crispness variations, overall all these solutions are more intuitive but less precise <span class="citation">(Griethe and Schumann 2006)</span>.</p>
<div class="figure">
<img src="../images/uncert.png" alt="Figure 18: Examples of uncertainty displays for a spatial variable: (a) blurring by Maceachren (1992) (b) whiteness by Hengl (2003)" id="fig:uncert" style="width:40.0%" />
<p class="caption">Figure 18: Examples of uncertainty displays for a spatial variable: (a) blurring by <span class="citation">Maceachren (1992)</span> (b) whiteness by <span class="citation">Hengl (2003)</span></p>
</div>
<h4 id="agreement-maps" class="unnumbered">Agreement maps</h4>
<p>Techniques for comparison of multiple spatial runs, such as frequency maps or spaghetti plots, can be applied in the context of uncertainty. See section <span class="ref">sec:comp_map_many</span>.</p>
<h4 id="interactive-options" class="unnumbered">Interactive options</h4>
<p>In dynamic visualization, uncertainty representation can be more easily achieved. A swap button can allow the user to successively visualize the main data and its associated uncertainty on the same background map, allowing easier interpretation, with the possibility of going back and forth. This method is referred to as <strong>toggling</strong> <span class="citation">(Aerts et al. 2003)</span>. Other interactive options include the <strong>clickable map</strong>, where uncertainty information displays upon click <span class="citation">(Wel et al. 1998)</span>. There has also been attempts to express imprecision dynamically addressing human senses via vibrations proportional to the level of uncertainty <span class="citation">(Brown 2004)</span>, or smooth animation of sequence of different realizations of a model <span class="citation">(Ehlschlaeger et al. 1997)</span>. There have even been attempts to display uncertainty by adding another dimension via sounds <span class="citation">(S.K. Lodha and Sheehan 1996)</span><span class="citation">(Fisher 1994)</span>. Another solution to convey accuracy is probabilistic animation: the uncertain points appear and disappear according to their accuracy, i.e. the probability domain is sampled over time <span class="citation">(Lundstrom et al. 2007)</span>.</p>
<h4 id="maps-of-uncertainty-metrics-per-pixel-stack" class="unnumbered">Maps of uncertainty metrics per pixel stack</h4>
<p>Another strategy is to combine uncertainty metrics with maps, by displaying statistics calculated across cell stacks (a cell-wise function applied to each element of the map stack). For example, a map could show measures of dispersion like standard deviation or extremum, or measure of robustness such as the amount of time the cell has value in a certain range (for continuous data) or is assigned to a specific category (for categorical data). This approach has been considered, with the example of the Shannon diversity index, in section <span class="ref">sec:comp_map_many</span>.</p>
<p><br />
  The techniques described above were mainly developed for continuous data, but can be adapted to categorical data. However specific techniques for categorical spatial data exist. In the context of land covers, prioritization score maps express the efficiency of a landcover/activity with regards to an objective <span class="citation">(Bryant et al. 2015)</span></p>
<h3 id="sec:SA"><span class="header-section-number">3.4.5</span> Parametric uncertainty: sensitivity analysis displays</h3>
<p>Sensitivity analysis aims to understand the influence of the inputs, and their uncertainty, on the outputs and their uncertainties of a model <span class="citation">(Pianosi et al. 2016)</span>. To visualize the input/output relationship, a common and direct way is a <strong>scatterplot</strong> (for each input parameter, with input parameter considered on x-axis and the output on y-axis), the relationship is explicitly revealed, especially in the case of strctured dependencies. This corresponds to the so-called O(F)AT (one factor at a time) method (detailed by <span class="citation">Hamby (1994)</span>, and examplified by <span class="citation">Murphy et al. (2004)</span> among others). However, with a high number of inputs, scatterplots can become cumbersome. Then, partial derivative of the output by one factor can be displayed to assess the impact of small perturbations; however it explores only locally the input space around a baseline. Other metrics such as the percentage of output change per percentage of input change, or sensitivity indices are also used. More details can be found in <span class="citation">(Hamby 1994)</span>.</p>
<div class="figure">
<img src="../images/SA_overall.png" alt="Figure 19: Examples of plots to express sensitivity analysis (a) Line plot shows the impact of change in an input parameter (ETo) on the output variable (water yield) (Vogl et al. 2014). (b) Spiderplot (c) Tornado diagram (d) Expressing sensitivity analysis through variance decomposition, with box plots and pie charts by Ligmann-Zielinska et al. (2014). (e) Radial convergence diagram, displaying Sobol sensitivity results for 30 parameters grouped in 10 categories, from Butler et al. (2014). (f) Pattern plot, evaluating sensitivity for 12 watersheds and 14 parameters, using the Sobol sensitivity index over a 38-year period, by Werkhoven et al. (2008). See also Pianosi et al. (2016), Appendix A." id="fig:SA" />
<p class="caption">Figure 19: Examples of plots to express sensitivity analysis (a) Line plot shows the impact of change in an input parameter (ETo) on the output variable (water yield) <span class="citation">(Vogl et al. 2014)</span>. (b) Spiderplot (c) Tornado diagram (d) Expressing sensitivity analysis through variance decomposition, with box plots and pie charts by <span class="citation">Ligmann-Zielinska et al. (2014)</span>. (e) Radial convergence diagram, displaying Sobol sensitivity results for 30 parameters grouped in 10 categories, from <span class="citation">Butler et al. (2014)</span>. (f) Pattern plot, evaluating sensitivity for 12 watersheds and 14 parameters, using the Sobol sensitivity index over a 38-year period, by <span class="citation">Werkhoven et al. (2008)</span>. See also <span class="citation">Pianosi et al. (2016)</span>, Appendix A.</p>
</div>
<p><strong>Line plots</strong> express sensitivity analysis by showing the impact of change in an input parameter the output variable: the most horizontal the line is, the less sensitivity to the considered parameter. <strong>Spiderplots</strong><a href="#fn21" class="footnoteRef" id="fnref21"><sup>21</sup></a> are an upgrade of the line plot, to combine several factors. They display the total impact of factors, and highlight their relative importance. Additionally they include limit values and impact on output of each input, and also the amount of change in input leading to breakeven point. However, the amount of factors displayed is limited (to about 7 according to <span class="citation">Eschenbach (1992)</span>). These are 2D plots, with percentage of change from baseline on x-axis, and output values on y-axis, and several lines corresponding to each input.</p>
<p>Variance decomposition is another approach to sensitivity analysis; then <strong>pie charts</strong> displaying variance partitions are a good alternative <span class="citation">(Lee et al. 2015)</span>. In contrast to trying to display the impact of each inputs, variance-based method focus on finding the most influencing factors. The output variance is decomposed into parts corresponding to the contribution of each input, therefore displaying its impact on total variance <span class="citation">(Homma and Saltelli 1996)</span>. Pie charts are widely used mostly because they are easy to build and understand. They are effective for small datasets (less than 6 segments of notably different sizes), and if segments are ordered according to size <span class="citation">(Todd 2016)</span>. Because they are only effective on small datasets, and inadequate for comparisons (between several pie charts), partisans of high density space-effective displays, like Tufte, argue against these charts.</p>
<p><strong>Tornado diagrams</strong> are also used to visualize the total impact of factors, and highlight their relative importance <span class="citation">(Eschenbach 1992)</span>. They are horizontal bar charts corresponding to each input, plotted on the axis of output values. <span class="citation">Pianosi et al. (2016)</span> gathers examples of helpful visualization tools for global SA (see her Appendix A).</p>
<p><strong>Radial convergence diagrams</strong> arrange input parameters in logical groups around a circle, and express, for each input its influence on output, and interactions with other input parameters. The size of inner circle of each input is proportional to its direct influence. The size of the outer circle (ring) reflects its total influence (including interactions). The interactions are reflected by the lines connecting the input parameters, the lines’ width reflects the extent of the interaction <span class="citation">(Pianosi et al. 2016)</span>.</p>
<p><strong>Pattern plots</strong> are similar to temporal maps (section <span class="ref">sec:timeseries</span>) for sensitivity analysis. A color scale reflects the output sensitivity for each pair of inputs. On figure <span class="ref">fig:SA</span>e, the input parameters are listed vertically, and the study sites horizontally. Here, the study sites are listed according to another parameter (climate conditions), therefore facilitating visual understanding of trends <span class="citation">(Pianosi et al. 2016)</span></p>
<p>This section focused on visualization, but there are many ways to conduct a sensitivity analysis, using landscape comparison metrics described in section <span class="ref">sec:comp_stat_cat_many</span>. Furthermore, sensitivity analysis packages exist in multiple programming languages (e.g. <em>SAlib</em> for Python, <em>sensitivity</em> for R).</p>
<h2 id="summary"><span class="header-section-number">3.5</span> Summary</h2>
<h3 id="key-take-aways"><span class="header-section-number">3.5.1</span> Key take-aways</h3>
<p>With no pretention of being exhaustive, this chapter gathers strategies to display complex data in the context of ecosystem services model outputs. It takes inspirations from the current data visualizations in different fields, such as agent-based modeling and ensemble datasets.</p>
<p>Overall, combining multiple linked displays seems to be necessary as complexity and number of dimensions increase, as <span class="citation">K. Potter et al. (2009)</span> argues in the context of gaining insight on distribution of spatio-temporal simulation results, as well as the associated uncertainty. Arranging many views is also relevant to facilitate comparisons <span class="citation">(Buja et al. 1996)</span>. Anecdotal experience suggests that some of the most impactful visualizations currently used combine interactive features and multiple linked views to deliver broad information in an organized and straight-forward way, as exemplified by The Middle Cedar Visualization in figure <span class="ref">fig:Peter</span> <span class="citation">(Hawthorne 2016)</span>.</p>
<p>The examples, guidelines and suggestions gathered above aim to support creation of effective visualizations. Nevertheless, the main take-away is that graphs are here to support conveying the data’s message; i.e. visualizations should always be tailored to the specific need and dataset. The final visualization needs to be adapted to fit the document type and format, the audience addressed and will also depend on the functionalities of the charting tool used.</p>
<p>On the whole, each visualization is very <strong>context specific</strong>, therefore there is no perfect solution adapted to every case. An appropriate display must be selected or designed according to the intended goal (i.e. message to convey), the audience and the available resources (in terms of time, expertise, tools, presention medium and dataset).</p>
<h3 id="sec:table"><span class="header-section-number">3.5.2</span> Summary table for specific display needs</h3>

<table style="border-collapse:collapse;border-spacing:0">
<tr>
<th style="font-family:Arial, sans-serif;font-size:14px;font-weight:bold;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;text-align:center;vertical-align:top">
Topic
</th>
<th style="font-family:Arial, sans-serif;font-size:14px;font-weight:bold;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Display task
</th>
<th style="font-family:Arial, sans-serif;font-size:14px;font-weight:bold;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Suggested displays (and link to corresponding chapter)
</th>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;text-align:center;vertical-align:top" rowspan="3">
Maps (any)
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Compare 2 maps
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Change maps, two maps, agreement maps (<span class="ref">sec:comp_map_2</span>) or aspatial metrics (<span class="ref">sec:comp_stat_cat_2</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Compare many maps
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Map matrix (<span class="ref">sec:comp_map_many</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Summarize many maps
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Modal portfolio and frequency map, map of diversity indices (<span class="ref">sec:comp_map_many</span>), aspatial metrics (<span class="ref">sec:comp_stat_cat_many</span> and <span class="ref">sec:comp_stat_cont_many</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;text-align:center;vertical-align:top" rowspan="3">
Portfolios<br>maps
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Display a portfolio
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Choropleth map (<span class="ref">sec:portfolios</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Agreement on doing an (any) activity across portfolios
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Footprint map (<span class="ref">sec:comp_map_many</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Agreement on specific activity across portfolios
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Activity-specific footprint map (<span class="ref">sec:comp_map_many</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;text-align:center;vertical-align:top" rowspan="4">
Maps of ES<br>model<br>outputs
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Spatial prioritization of intervention(s)
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Objective score map (<span class="ref">sec:objs</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Impact of intervention or scenario on a specific ES metric
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Activity objective score map (<span class="ref">sec:objs</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Location of synergies and tradeoffs of intervention/scenario on multiple ES metrics
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Hotspot map (or priority/conflict map) (<span class="ref">sec:hotspot</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top" rowspan="2">
Visualize tradeoffs
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Hotspot map (<span class="ref">sec:hotspot</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;text-align:center;vertical-align:top" rowspan="4">
Non-spatial<br>ES model<br>outputs
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Parallel coordinate plot (<span class="ref">sec:parcoords</span>), Radar plot (<span class="ref">sec:radar</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Several objectives under small number of scenarios
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Small multiples, Scatterplots, i.e. trade offs curve (<span class="ref">sec:scatterplots</span>and <span class="ref">sec:smallmultiples</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
2 objectives under many scenarios
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Scatterplot: trade off curve (<span class="ref">sec:scatterplots</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
3 or more objectives under many scenarios
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Parallel axis plot (<span class="ref">sec:parcoords</span>), Small mutiples scatterplots i.e. trade off curves (<span class="ref">sec:scatterplots</span> and <span class="ref">sec:smallmultiples</span>) or dimension reduction to 2 objectives (<span class="ref">sec:rdim</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;text-align:center;vertical-align:top">
Scale
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Consistency of spatial pattern in pixel data (at coarser resolution)
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Area to be further explored (<span class="ref">sec:scale</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;text-align:center;vertical-align:top" rowspan="3">
Uncertainty
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Characterize uncertainty in a set of input parameters (sensitivity analysis)
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Spiderplot, line chart, tornado diagram, box plot, radial convergence diagram, pattern plot (<span class="ref">sec:SA</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Characterize uncertainty in spatial model outputs
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Metrics (<span class="ref">sec:uncert_non_maps</span>) and maps display such as juxtaposition or overlay (<span class="ref">sec:uncert_maps</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Characterize contribution of different uncertainty sources (to output uncertainty)
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
Box plot linked to a pie chart (<span class="ref">sec:SA</span>)
</td>
</tr>
<tr>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;text-align:center;vertical-align:top">
Beneficiaries
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;font-style:italic;vertical-align:top">
Show and quantify beneficiaries impact, location of beneficiaries and contract with service distribution
</td>
<td style="font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;vertical-align:top">
See section (<span class="ref">sec:beneficiaries</span>)
</td>
</tr>
</table>
<p></p>

<h3 id="sec:resou"><span class="header-section-number">3.5.3</span> Resources</h3>
<h4 id="examples-and-inspiration" class="unnumbered">Examples and inspiration</h4>
<ul>
<li><a href="http://flowingdata.com/">Flowing data: General data visualization ideas in blog format</a></li>
<li><a href="http://msp.naturalcapitalproject.org/msp_concierge_master/">The Gallery of the Marine Planning Concierge Tool gathers great work on marine ES</a>. These include <a href="http://www.geointerest.frih.org/NatCap/">the Mapping portal for the Belize project by Gregg Verutes</a> and <a href="http://marineapps.naturalcapitalproject.org/bahamas/">a similar map web viewer from the same author, for coastal hazard model results in the Bahamas</a></li>
<li><a href="http://www.myanmarnaturalcapital.org/en">Myanmar Natural Capital: a storytelling approach for a project involving multiple ecosystem services</a>. The tools used here are D3.js, leaflet, openStreetMaps, Google Maps and photoshop.</li>
<li><a href="http://coastalresilience.org/tools/apps/#apps_id%7Cassess-risk%7C1">The Nature Conservancy also developed a visualization platform, gathering a suite of web applications based on maps</a>, aiming to convey and/or simplify ecological concepts, assess risk, identify and compare different solutions and scenarios. For example, <a href="http://maps.coastalresilience.org/gulfmex/">the coastal resilience interactive map in the Gulf of Mexico</a></li>
<li><a href="http://newagbioeconomy.umn.edu/collaborativegeodesign/">Collaborative GeoDesign, a web application allowing users to test land cover changes on the landscape, and informs on the expected corresponding impact on ES metrics</a></li>
<li><a href="http://preview.weather.gov/edd/">Weather forecast: the NWS enhanced Data Display</a><br />
</li>
</ul>
<div class="figure">
<img src="../images/addl.png" alt="Figure 20: Additional examples (a) To compare 3 ES metrics between 4 scenarios, Arkema et al. (2015) combines small multiples of objective score maps, with summary statistics and bar plots. (b) Change map displaying the amount of additional sediment export (in percentage) comparing a future scenario with the current baseline one (Mandle et al. 2016). (c) On a static display, Nelson et al. (2008)’s strategy consists in displaying only the extreme points of the trade-off curve. (d) Change in services for all scenarios and iterations relative to current management Arkema et al. (2015)" id="fig:addl" />
<p class="caption">Figure 20: Additional examples (a) To compare 3 ES metrics between 4 scenarios, <span class="citation">Arkema et al. (2015)</span> combines small multiples of objective score maps, with summary statistics and bar plots. (b) Change map displaying the amount of additional sediment export (in percentage) comparing a future scenario with the current baseline one <span class="citation">(Mandle et al. 2016)</span>. (c) On a static display, <span class="citation">Nelson et al. (2008)</span>’s strategy consists in displaying only the extreme points of the trade-off curve. (d) Change in services for all scenarios and iterations relative to current management <span class="citation">Arkema et al. (2015)</span></p>
</div>
<div class="figure">
<img src="../images/peter.png" alt="Figure 21: The Middle Cedar visualization is an interactive webapp, developed by Hawthorne (2016), who combined a scatterplot, a map, a pie chart and summary statistics in a single dashboard. It allows users to click on each point of the trade-off curve, and the corresponding land cover map will be displayed. Additionally, summary metrics and a pie chart provide information relative to the scenario chosen upon click (Hawthorne 2016)" id="fig:Peter" style="width:70.0%" />
<p class="caption">Figure 21: <a href="https://phawthorne.github.io/mc-vis/">The Middle Cedar visualization</a> is an interactive webapp, developed by <span class="citation">Hawthorne (2016)</span>, who combined a scatterplot, a map, a pie chart and summary statistics in a single dashboard. It allows users to click on each point of the trade-off curve, and the corresponding land cover map will be displayed. Additionally, summary metrics and a pie chart provide information relative to the scenario chosen upon click <span class="citation">(Hawthorne 2016)</span></p>
</div>
<div class="figure">
<img src="../images/consdash.png" alt="Figure 22: Extract of the Conservation ROI Dashboard, gathering and comparing ROI projects across the US" id="fig:ConservationROIDashboard" />
<p class="caption">Figure 22: Extract of the <a href="http://nascience.us/roi/public/">Conservation ROI Dashboard</a>, gathering and comparing ROI projects across the US</p>
</div>
<div class="figure">
<img src="../images/webapp/full.png" alt="Figure 23: The Tana Water Fund interactive dashboard allows visualization of tradeoffs between objectives, comparison of scenarios and assessment of uncertainty. The current version is a prototype laying out the concept for a more generic tool" id="fig:webapp_full" />
<p class="caption">Figure 23: <a href="https://charlottegiseleweil.github.io/webviz_natcap/">The Tana Water Fund interactive dashboard</a> allows visualization of tradeoffs between objectives, comparison of scenarios and assessment of uncertainty. The current version is a prototype laying out the concept for a more generic tool</p>
</div>
<div class="figure">
<img src="../images/Fig1.png" alt="Figure 24: Land cover in Pu‘u Wa‘awa‘a under different restoration and climate scenarios. The purple contours on the current land cover map outline the enclosure areas corresponding to the partial restoration scenario. The maps on top correspond to the evolution of land cover, under the current climate for the partial and full restoration scenarios. The maps underneath correspond to the evolution of the land cover, under the RCP 8.5 future climate projection for the partial and full restoration scenarios (Wada et al. 2017, in review)" id="fig:hawaii1" style="width:80.0%" />
<p class="caption">Figure 24: Land cover in Pu‘u Wa‘awa‘a under different restoration and climate scenarios. The purple contours on the current land cover map outline the enclosure areas corresponding to the partial restoration scenario. The maps on top correspond to the evolution of land cover, under the current climate for the partial and full restoration scenarios. The maps underneath correspond to the evolution of the land cover, under the RCP 8.5 future climate projection for the partial and full restoration scenarios <span class="citation">(Wada et al. 2017, in review)</span></p>
</div>
<div class="figure">
<img src="../images/Fig2.png" alt="Figure 25: Impact of restoration on groundwater recharge in Pu‘u Wa‘awa‘a. The green contours outline the enclosure areas corresponding to the partial restoration scenario in which only these regions undergo some changes. Blue corresponds to an increase in groundwater recharge due to restoration, and red corresponds to a decrease (Wada et al. 2017, in review)" id="fig:hawaii2" style="width:80.0%" />
<p class="caption">Figure 25: Impact of restoration on groundwater recharge in Pu‘u Wa‘awa‘a. The green contours outline the enclosure areas corresponding to the partial restoration scenario in which only these regions undergo some changes. Blue corresponds to an increase in groundwater recharge due to restoration, and red corresponds to a decrease <span class="citation">(Wada et al. 2017, in review)</span></p>
</div>
<div class="figure">
<img src="../images/Fig3.png" alt="Figure 26: Impact of restoration on landscape flammability in Pu‘u Wa‘awa‘a. The green contours outline the enclosure areas corresponding to the partial restoration scenario. Yellow corresponds to a decrease in landscape flammability due to restoration, and red means no change (Wada et al. 2017, in review)" id="fig:hawaii3" style="width:80.0%" />
<p class="caption">Figure 26: Impact of restoration on landscape flammability in Pu‘u Wa‘awa‘a. The green contours outline the enclosure areas corresponding to the partial restoration scenario. Yellow corresponds to a decrease in landscape flammability due to restoration, and red means no change <span class="citation">(Wada et al. 2017, in review)</span></p>
</div>
<div class="figure">
<img src="../images/Fig4.png" alt="Figure 27: Spatial prioritization and restoration costs in in Pu‘u Wa‘awa‘a. For each objective and both combined. Rank 1 pixels correspond to the highest priority restoration areas. Costs are cumulative, such that if Rank n is restored, Rank n-1 was restored as well. The green contours outline the enclosure areas corresponding to the partial restoration scenario (Wada et al. 2017, in review)" id="fig:hawaii4" style="width:80.0%" />
<p class="caption">Figure 27: Spatial prioritization and restoration costs in in Pu‘u Wa‘awa‘a. For each objective and both combined. Rank 1 pixels correspond to the highest priority restoration areas. Costs are cumulative, such that if Rank n is restored, Rank n-1 was restored as well. The green contours outline the enclosure areas corresponding to the partial restoration scenario <span class="citation">(Wada et al. 2017, in review)</span></p>
</div>

<h4 id="useful-resources" class="unnumbered">Useful resources</h4>
<p>Hereafter are listed several resources that may be useful while creating visualizations.</p>
<p>Color palette pickers, to help choose a color theme:</p>
<ul>
<li><a href="http://colorbrewer2.org/">Colorbrewer</a>, with an emphasis on maps and colorblind-friendly schemes</li>
<li><a href="http://colrd.com/palette/">Colrd</a>, collaborative more designer-oriented website</li>
<li><a href="https://color.adobe.com">Adobe Kuler</a><br />
</li>
</ul>
<p>Parallel coordinates plots resources:</p>
<ul>
<li><a href="https://reed.cee.cornell.edu/parallel-axis/">Ready-to-use parallel coordinates graph for multi-dimensional data</a></li>
<li><a href="http://syntagmatic.github.io/parallel-coordinates/">Code to build a parallel coordinates plot in javascript with D3.js</a></li>
<li><a href="https://waterprogramming.wordpress.com/2016/09/12/easy-vectorized-parallel-plots-for-multiple-data-sets/">Explanations to build a parallel coordinates plot in Python</a></li>
<li><a href="https://github.com/OpenMORDM">R package for Multi-objective Robust Decision Making, including parallel coordinates plot and 3D scatterplot (linked together)</a></li>
<li><a href="https://cran.r-project.org/web/packages/alluvial/vignettes/alluvial.html">To make alluvial (categorical version of parallel coordinates) plot: R package <em>alluvial</em></a><br />
</li>
</ul>
<p>Analysis of spatial data with Python:</p>
<ul>
<li><a href="https://pypi.python.org/pypi/pygeoprocessing">PyGeoprocessing: geoprocessing routines for GIS</a></li>
<li><a href="http://sensitivecities.com/so-youd-like-to-make-a-map-using-python-EN.html#.WCJPDvkrJhE">A well written blogpost about maps in Python</a></li>
<li><a href="http://www.datadependence.com/2016/06/creating-map-visualisations-in-python/">and another one on the same topic</a></li>
<li><a href="http://matplotlib.org/basemap/users/examples.html">Basemap examples</a><br />
</li>
</ul>
<p>Analysis of spatial data with R:</p>
<ul>
<li><a href="https://cran.r-project.org/web/views/Spatial.html">overview of analysis of spatial data</a></li>
<li><a href="https://journal.r-project.org/archive/2013-1/kahle-wickham.pdf">Illustration of the <em>ggmap</em> package</a></li>
<li><a href="https://cran.r-project.org/web/packages/raster/vignettes/Raster.pdf">Introduction to the <em>raster</em> package</a></li>
<li><a href="https://oscarperpinan.github.io/rastervis/">Introduction to the <em>RasterVis</em> package, built on top of <em>raster</em> package</a><br />
</li>
</ul>
<p>Other geovisualization platforms:</p>
<ul>
<li><a href="http://geoawesomeness.com/top-19-online-geovisualization-tools-apis-libraries-beautiful-maps/">A list of 19 online geovisualization tools</a></li>
<li><a href="https://www.mapbox.com/">Mapbox (API and libraries)</a></li>
<li><a href="https://carto.com/">Carto (web platform)</a></li>
<li><a href="http://leafletjs.com/">Leaflet (JavaScript library)</a></li>
<li><a href="https://mapzen.com/">Mapzen (API)</a><br />
</li>
</ul>
<p>Sensitivity analysis:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/sensitivity/index.html">with R: <em>sensitivity</em> package</a></li>
<li><a href="https://github.com/SALib/SALib">with Python: <em>SAlib</em> library</a><br />
</li>
</ul>
<p>Layout and design:</p>
<ul>
<li><a href="http://www.sumopaint.com/home/">Image editor and layout tool online</a>, a free alternative to Photoshop<br />
</li>
</ul>
<h1 id="conclusion"><span class="header-section-number">4</span> Conclusion</h1>
<h2 id="on-standardizing-approaches-to-communicate-natural-capital-results"><span class="header-section-number">4.1</span> On standardizing approaches to communicate natural capital results</h2>
<p>As many in the ES community are calling for a standardized method to quantify and map ES (<span class="citation">Englund et al. (2017)</span>, <span class="citation">Crossman et al. (2013)</span>, <span class="citation">Martínez-Harms and Balvanera (2012)</span>), a number of strategies are being developed on the visualization front. Interactive tools are becoming increasingly common, as platforms to develop them are becoming more and more accessible.</p>
<p>Similarly to <span class="citation">Englund et al. (2017)</span>, this study finds it difficult to point one best method generically adequate to all cases. Rather, best practices were suggested in a display “toolbox” (chapters <span class="ref">sec:elements</span> and <span class="ref">sec:UserGuide</span>). Approaches are very context dependent. The tools and types of display must be chosen according to the aim, intended audience, analyst skills, data availability, time frame and other factors.</p>
<p>Remain some open questions and areas of improvements were identified. The question of the scale, <strong>the effect of the resolution</strong> chosen on the results can be further explored. Additionally, the survey noted growing interest in the topic of <strong>beneficiaries</strong>. Not only quantifying the people benefiting from an intervention, but more precisely adding nuance in demographics or social metrics to the analysis, classify by subgroups (e.g. which fraction of service benefits accrue to vulnerable populations?) and/or contrast beneficiary distribution in space with service distribution in space.</p>
<p>The engaging aspect rising from dynamic features and the <strong>interactivity</strong> was expressed, as shown by the enthusiasm suscited by the interactive dashboard prototype developed alongside this toolbox <span class="citation">(Weil 2017)</span>. This observation calls for development of more modern engaging tools, leveraging the abilities offered by the tools ad develoment environments becoming more and more common an accessible.</p>
<h2 id="engaging-a-broader-audience-into-major-decisions-on-natural-capital-sustainable-management"><span class="header-section-number">4.2</span> Engaging a broader audience into major decisions on natural capital sustainable management</h2>
<p>There is an enormous potential for environmental impact and climate change mitigation through an informed management of natural capital. So called conservation finance (i.e. a financial investment that aims to conserve the values of the ecosystem for the long term, as defined by <span class="citation">Huwyler et al. (2014)</span>) has a large unrealized potential, there is a significant unmet demand for investment<a href="#fn22" class="footnoteRef" id="fnref22"><sup>22</sup></a>, and aligned intentions to promote natural capital sustainable management both from the political world - as illustrated by the Paris agreement and the 17 UN sustainable development goals among others (<span class="citation">Center for Climate and Energy Solutions (2015)</span>, <span class="citation">Guardian (2015)</span>) - and also emerging in the finance world (see <a href="http://www.conservationfinancenetwork.org/">the Conservation Finance Network</a> for example). However, one main obstacle for investors, in the hardly measurable aspect of return on investment and conservation benefits. But natural capital assessments tackles this exact question.</p>
<p>Building on this observation, the hypothesis can be formulated that linking the right expertise would allow to bridge the gaps and open the doors to many desired investments and high impact projects: partnering investors looking for long term reliable and meaningful project with cutting-edge scientists modeling the behavior of ecosystems to quantify the costs and benefits from natural capital and its sustainable management. Several initiatives are going in this direction, Credit Suisse for example, expressed their long-term intent of creating a conservation finance asset class <span class="citation">(Huwyler et al. 2016)</span>. It has been proven to be possible to deliver great conservation impacts while generating returns for investors <span class="citation">(Huwyler et al. 2014)</span>.</p>
<p>However, their success seems contingent upon the ability of several fields to work together; linking different expertise seem indeed required bridge the gaps (for example through partnering investors looking for long term reliable and meaningful project with cutting-edge scientists modeling the behavior of ecosystems to quantify the costs and benefits from natural capital and its sustainable management). Multi-disciplinary communication therefore appears as a crucial aspect. In this context, data visualization tools play a key role to connect the complex scientific results to the real world.</p>
<p>Effective visualizations of natural capital assessment results must simplify their complexity to be understandable, while staying rigorous. Plus they communicate key points in an engaging way, allowing more actors to get involved in natural capital sustainable management. By involving a broader audience into major decisions, they support a participative and democratic approach to solving problems impacting large communities.</p>
<p>Advances in the topic of communication of natural capital assessments would arguably facilitate engagement of a broader audience and help natural capital conservation projects achieve their tremendous potential to impact, at large scale.</p>
<p></p>
<h1 id="bibliography" class="unnumbered">Bibliography</h1>
<div id="refs" class="references">
<div id="ref-Achtert2013_6">
<p>Achtert, E., Kriegel, H.-P., Schubert, E., and Zimek, A. (2013). “Interactive data mining with 3D-parallel-coordinate-trees.” <em>Proceedings of the 2013 acm sigmod international conference on management of data</em>, SIGMOD ’13, ACM, New York, NY, USA, 1009–1012.</p>
</div>
<div id="ref-Aerts03">
<p>Aerts, J. C. J. H., Clarke, K. C., and Keuper, A. D. (2003). “Testing popular visualization techniques for representing model uncertainty,” cartography and geographic.” <em>Information Science</em>, 249–261.</p>
</div>
<div id="ref-Allen1">
<p>Allen, E. A., Erhardt, E. B., and Calhoun, V. D. (2012). “Data visualization in the neurosciences: Overcoming the curse of dimensionality.” <em>Neuron</em>, 74(4), 603–608.</p>
</div>
<div id="ref-andrienkopp">
<p>Andrienko, G., and Andrienko, N. (2001). “Constructing parallel coordinates plot for problem solving.” <em>1st international symposium on smart graphics</em>, 9–14.</p>
</div>
<div id="ref-bifocal">
<p>Apperley, M. D., Tzavaras, I., and Spence, R. (1982). “A BIFOCAL DISPLAY TECHNIQUE FOR DATA PRESENTATION.” <em>Eurographics conference proceedings</em>, D. Greenaway and E. Warman, eds., The Eurographics Association.</p>
</div>
<div id="ref-Arkema2">
<p>Arkema, K. K., Verutes, G. M., Wood, S. A., Clarke-Samuels, C., Rosado, S., Canto, M., Rosenthal, A., Ruckelshaus, M., Guannel, G., Toft, J., Faries, J., Silver, J. M., Griffin, R., and Guerry, A. D. (2015). “Embedding ecosystem services in coastal planning leads to better outcomes for people and nature.” <em>Proceedings of the National Academy of Sciences</em>, 112(24), 7390–7395.</p>
</div>
<div id="ref-arkema1">
<p>Arkema, K. K., Verutes, G., Bernhardt, J. R., Clarke, C., Rosado, S., Canto, M., Wood, S. A., Ruckelshaus, M., Rosenthal, A., McField, M., and others. (2014). “Assessing habitat risk from human activities to inform coastal and marine spatial planning: A demonstration in belize.” <em>Environmental Research Letters</em>, IOP Publishing, 9(11), 114016.</p>
</div>
<div id="ref-beven2006undermining">
<p>Beven, K. (2006). “On undermining the science?” <em>Hydrological processes</em>, Wiley Online Library, 20(14), 3141–3146.</p>
</div>
<div id="ref-Bingham">
<p>Bingham, R. J., and Haines, K. (2006). “Mean dynamic topography: Intercomparisons and errors.” <em>IPhilosophical Transactions of The Royal Society A</em>, 903–916.</p>
</div>
<div id="ref-Desi5656">
<p>Brewer, C. (2004). <em>Designing better maps: A guide for gis users</em>. Environmental Systems Research.</p>
</div>
<div id="ref-Brodlie">
<p>Brodlie, K., Osorio, R. A., and Lopes, A. (2012). “A review of uncertainty in data visualization.”</p>
</div>
<div id="ref-Brown2005">
<p>Brown, D. G., Page, S., Riolo, R., Zellner, M., and Rand, W. (2005). “Path dependence and the validation of agent‐based spatial models of land use.” <em>International Journal of Geographical Information Science</em>, Taylor &amp; Francis, 19(2), 153–174.</p>
</div>
<div id="ref-Brown">
<p>Brown, R. (2004). “Animated visual vibrations as an uncertainty visualisation technique.” <em>Proceedings of the 2Nd international conference on computer graphics and interactive techniques in australasia and south east asia</em>, GRAPHITE ’04, ACM, New York, NY, USA, 84–89.</p>
</div>
<div id="ref-RIOS">
<p>Bryant, B. P., Wolny, S., and Vogl, A. L. (2015). “Understanding RIOS sensitivities , strengths , and weaknesses A demonstration in the Coyote Creek watershed.”</p>
</div>
<div id="ref-QUICK">
<p>Bryant, and Hawthorne. (n.d.). “Quick intro to optimization.”</p>
</div>
<div id="ref-Buckley2012">
<p>Buckley, A. R. (2012). “Make Maps People Want to Look At.” <em>ArcUser</em>, 46–51.</p>
</div>
<div id="ref-Buczkowski">
<p>Buczkowski, A. (2016). “Top 19 geovisualization tools, apis and libraries that will let you create beautiful web maps.” <em>GeoAwesomeness.com</em>, &lt;<a href="http://geoawesomeness.com/top-19-online-geovisualization-tools-apis-libraries-beautiful-maps/" class="uri">http://geoawesomeness.com/top-19-online-geovisualization-tools-apis-libraries-beautiful-maps/</a>&gt;.</p>
</div>
<div id="ref-Buja">
<p>Buja, A., Cook, D., and Swayne, D. F. (1996). “Interactive high-dimensional data visualization.” <em>Journal of Computational and Graphical Statistics</em>, 5, 78–99.</p>
</div>
<div id="ref-Butler">
<p>Butler, M. P., Reed, P. M., Fisher-Vanden, K., Keller, K., and Wagener, T. (2014). “Identifying parametric controls and dependencies in integrated assessment models using global sensitivity analysis.” <em>Environmental Modelling &amp; Software</em>, 59, 10–29.</p>
</div>
<div id="ref-cardinale2012">
<p>Cardinale, B. J., Duffy, J. E., Gonzalez, A., Hooper, D. U., Perrings, C., Venail, P., Narwani, A., Mace, G. M., Tilman, D., Wardle, D. A., and others. (2012). “Biodiversity loss and its impact on humanity.” <em>Nature</em>, Nature Publishing Group, 486(7401), 59–67.</p>
</div>
<div id="ref-raw_raw">
<p>Caviglia, G., and al. (2013). “Raw website.” &lt;<a href="http://raw.densitydesign.org" class="uri">http://raw.densitydesign.org</a>&gt;.</p>
</div>
<div id="ref-Cop21">
<p>Center for Climate and Energy Solutions. (2015). “UN Framework Convention on Climate Change (UNFCCC).” <em>Outcomes of the UN Climate Change Conference in Paris</em>, (December), 1–5.</p>
</div>
<div id="ref-spiderman_bad_Ref">
<p>Chandoo. (2008). “You are not spider man, so why do you use radar charts?”</p>
</div>
<div id="ref-TerrSet">
<p>ClarkLabs. (2015). &lt;<a href="https://clarklabs.org/terrset/idrisi-gis/" class="uri">https://clarklabs.org/terrset/idrisi-gis/</a>&gt;.</p>
</div>
<div id="ref-cleveland1984graphical">
<p>Cleveland, W. S., and McGill, R. (1984). “Graphical perception: Theory, experimentation, and application to the development of graphical methods.” <em>Journal of the American statistical association</em>, Taylor &amp; Francis, 79(387), 531–554.</p>
</div>
<div id="ref-Cohen1960">
<p>Cohen, J. (1960). “A COEFFICIENT OF AGREEMENT FOR NOMINAL SCALES.” <em>EDUCATIONAL AND PSYCHOLOGICAL MEASUREMENT</em>, XX(1), 37–46.</p>
</div>
<div id="ref-correa">
<p>Correa, C. D., Chan, Y.-H., and Ma, K.-L. (2009). “A framework for uncertainty-aware visual analytics.” I. P. of IEEE Symposium on Visual Analytics Science and T. V. 09, eds.</p>
</div>
<div id="ref-costanza">
<p>Costanza, R. (1989). “Model goodness of fit: A multiple resolution procedure.” <em>Ecological Modelling</em>, 47(3-4), 199–215.</p>
</div>
<div id="ref-Crossman">
<p>Crossman, N., Burkhard, B., Nedkov, S., Willemen, L., Petz, K., Palomo, I., Drakou, E., Martín-Lopez, B., McPhearson, T., Boyanova, K., Alkemade, R., Egoh, B., Dunbar, M., and Maes, J. (2013). “A blueprint for mapping and modelling ecosystem services.” <em>Ecosystem Services</em>, 4, 4–14.</p>
</div>
<div id="ref-Cukier">
<p>Cukier, K. (2010). <em>Data, data everywhere: A special report on managing information</em>. Economist Newspaper.</p>
</div>
<div id="ref-daily2000">
<p>Daily, G. C., Söderqvist, T., Aniyar, S., Arrow, K., Dasgupta, P., Ehrlich, P. R., Folke, C., Jansson, A., Jansson, B.-O., Kautsky, N., and others. (2000). “The value of nature and the nature of value.” <em>Science</em>, American Association for the Advancement of Science, 289(5478), 395–396.</p>
</div>
<div id="ref-de2007geospatial">
<p>De Smith, M. J., Goodchild, M. F., and Longley, P. (2007). <em>Geospatial analysis: A comprehensive guide to principles, techniques and software tools</em>. Troubador Publishing Ltd.</p>
</div>
<div id="ref-dean">
<p>Dean, D. J. (2005). “Measuring arrangement similarity between thematic raster databases using a quadtree-based approach.” <em>International conference on geospatial sematics</em>, Springer, 120–136.</p>
</div>
<div id="ref-Ehlschlaeger">
<p>Ehlschlaeger, C. R., Shortridge, A. M., and Goodchild, M. F. (1997). “Visualizing spatial data uncertainty using animation.” <em>Computers in GeoSciences</em>, 23(4), 387–395.</p>
</div>
<div id="ref-Englund">
<p>Englund, O., Berndes, G., and Cederberg, C. (2017). “How to analyse ecosystem services in landscapes—A systematic review.” <em>Ecological Indicators</em>, 73, 492–504.</p>
</div>
<div id="ref-tornadospider">
<p>Eschenbach, T. G. (1992). “Spiderplots versus tornado diagrams for sensitivity analysis.” <em>Interfaces</em>, INFORMS, 22(6), 40–46.</p>
</div>
<div id="ref-Fisher">
<p>Fisher, P. (1994). “Animation and sound for the visualization of uncertain spatial information.” <em>Visualization in Graphical Information Systems</em>, Wiley, 181–185.</p>
</div>
<div id="ref-Fleming05">
<p>Fleming, P. J., Purshouse, R. C., and Lygoe, R. J. (2005). “Many-Objective Optimization: An Engineering Design Perspective.” <em>Evolutionary Multi-Criterion Optimization: Third International Conference, EMO 2005, Guanajuato, Mexico, March 9-11, 2005. Proceedings</em>, 14–32.</p>
</div>
<div id="ref-Furnas_fisheye">
<p>Furnas, G. W. (1986). “Generalized fisheye views.” <em>SIGCHI Bull.</em>, ACM, New York, NY, USA, 17(4), 16–23.</p>
</div>
<div id="ref-jgong">
<p>Gong, J., C., X. Y., C.X, Z., and Y.J., G. (2016). “Study on watershed ecosystem service governance based on landscape ecological risk assessment: A case study of bailongjiang watershed of southern gansu, china.”</p>
</div>
<div id="ref-griethe">
<p>Griethe, H., and Schumann, H. (2006). “The visualization of uncertain data: Methods and problems.” <em>SimVis</em>, 143–156.</p>
</div>
<div id="ref-Guardian">
<p>Guardian, T. (2015). “The 10 sustainable development goals that rainforests can help us achieve.” <em>The Guardian</em>, &lt;<a href="https://www.theguardian.com/cgd-partner-zone/2017/jan/23/10-ways-tropical-forests-help-sustainable-development-goals" class="uri">https://www.theguardian.com/cgd-partner-zone/2017/jan/23/10-ways-tropical-forests-help-sustainable-development-goals</a>&gt;.</p>
</div>
<div id="ref-Hadka2015">
<p>Hadka, D., Herman, J., Reed, P., and Keller, K. (2015). “An open source framework for many-objective robust decision making.” <em>Environmental Modelling and Software</em>, 74, 114–129.</p>
</div>
<div id="ref-Hagen2003">
<p>Hagen, A. (2003). “Fuzzy set approach to assessing similarity of categorical maps.” <em>International Journal of Geographical Information Science</em>, 17(3), 235–249.</p>
</div>
<div id="ref-hamby">
<p>Hamby, D. (1994). “A review of techniques for parameter sensitivity analysis of environmental models.” <em>Environmental monitoring and assessment</em>, Springer, 32(2), 135–154.</p>
</div>
<div id="ref-Hauck">
<p>Hauck, J., Görg, C., Varjopuro, R., Ratamäki, O., Maes, J., Wittmer, H., and Jax, K. (2013). “‘Maps have an air of authority’: Potential benefits and challenges of ecosystem service maps at different levels of decision making.” <em>Ecosystem Services</em>, 4, 25–32.</p>
</div>
<div id="ref-Peter">
<p>Hawthorne, P. (2016). “Middle cedar visualization.” &lt;<a href="https://phawthorne.github.io/mc-vis/" class="uri">https://phawthorne.github.io/mc-vis/</a>&gt;.</p>
</div>
<div id="ref-Tour">
<p>Heer, J., Bostock, M., and Ogievetsky, V. (2010). “A tour through the visualization zoo.” <em>Communications of the ACM</em>, 53(6), 59–67.</p>
</div>
<div id="ref-horizon">
<p>Heer, J., Kong, N., and Agrawala, M. (2009). “Sizing the horizon: The effects of chart size and layering on the graphical perception of time series visualizations.” <em>ACM Human Factors in Computing Systems</em>, 1303–1312.</p>
</div>
<div id="ref-hengl">
<p>Hengl, T. (2003). “Visualisation of uncertainty using the hsi colour model: Computation with colours.” <em>In Proceedings of the 7th International Conference on GeoComputation</em>, 8–17.</p>
</div>
<div id="ref-carto_img">
<p>Hennig, B. (2011). “Worldmapper population cartogram.” &lt;<a href="www.viewsoftheworld.net" class="uri">www.viewsoftheworld.net</a>&gt;.</p>
</div>
<div id="ref-violin">
<p>Hintze, J. L., and Nelson, R. D. (1998). “Violin plots: A box plot-density trace synergism.” <em>The American Statistician</em>, Taylor &amp; Francis Group, 52(2), 181–184.</p>
</div>
<div id="ref-Homma">
<p>Homma, T., and Saltelli, A. (1996). “Importance measures in global sensitivity analysis of nonlinear models.” <em>Reliability Engineering &amp; System Safety</em>, Elsevier, 52(1), 1–17.</p>
</div>
<div id="ref-hotelling1933analysis">
<p>Hotelling, H. (1933). “Analysis of a complex of statistical variables into principal components.” <em>Journal of educational psychology</em>, Warwick &amp; York, 24(6), 417.</p>
</div>
<div id="ref-Huang13">
<p>Huang, Q., Parker, D. C., Sun, S., and Filatova, T. (2013). “Effects of agent heterogeneity in the presence of a land-market: A systematic test in an agent-based laboratory.” <em>Computers, Environment and Urban Systems</em>, 41, 188–203.</p>
</div>
<div id="ref-CS">
<p>Huwyler, F., Käppeli, J., and Tobin, J. (2016). “Conservation finance - from niche to mainstream: The building of an institutional asset class.” <em>Crédit Suisse and McKinsey</em>.</p>
</div>
<div id="ref-McKinsey">
<p>Huwyler, F., Käppeli, J., Serafimova, K., Swanson, E., and Tobin, J. (2014). “Conservation finance : Moving beyond donor funding toward an investor-driven approach.” <em>Crédit Suisse AG, WWF and McKinsey</em>.</p>
</div>
<div id="ref-python_libs">
<p>Hügel, S. (2015). “So you’d like to make a map using python.” &lt;<a href="http://sensitivecities.com/so-youd-like-to-make-a-map-using-python-EN.html#.WCpPzBRFRhN" class="uri">http://sensitivecities.com/so-youd-like-to-make-a-map-using-python-EN.html#.WCpPzBRFRhN</a>&gt;.</p>
</div>
<div id="ref-Piotr">
<p>Jankowski, P., Zielinska, A.-L., and Swobodzinski, M. (2008). “Choice modeler: A web-based spatial multiple criteria evaluation tool.” <em>Transactions in GIS</em>, 12(4), 541–561.</p>
</div>
<div id="ref-potter">
<p>K. Potter, A. W., P.-t. Bremer, D. W., C. Doutriaux, V. P., and Johnson, C. (2009). “Ensemble-vis: A framework for the statistical visualization of ensemble data.” I. P. of the 2009 IEEE International Conference on Data Mining Workshops, ed., IEEE Computer Society, 233–240.</p>
</div>
<div id="ref-kader7">
<p>Kader, G. D., and Perry, M. (2007). “Variability for categorical variables.” <em>Journal of Statistics Education</em>, American Statistical Association. 732 North Washington Street, Alexandria, VA 22314, 15(2), 1–17.</p>
</div>
<div id="ref-ggmap">
<p>Kahle, D., and Wickham, H. (2013). “Ggmap: Spatial visualization with ggplot2.” <em>The R Journal</em>, 5(1), 144–162.</p>
</div>
<div id="ref-Keim">
<p>Keim, D. A. (2000). “Designing Pixel-oriented Visualization Techniques : Theory and Applications.” 6(1), 59–78.</p>
</div>
<div id="ref-Kelleher">
<p>Kelleher, C., and Wagener, T. (2011). “Ten guidelines for effective data visualization in scientific publications.” <em>Environmental Modelling &amp; Software</em>, 26(6), 822–827.</p>
</div>
<div id="ref-Dimitra">
<p>Kitsiou, D., and Karydis, M. (2000). “Categorical mapping of marine eutrophication based on ecological indices.” <em>Science of The Total Environment</em>, 255(1–3), 113–127.</p>
</div>
<div id="ref-temporalmap">
<p>Koehler. (2014). “Using a temporal information system for visualization and analysis of hydrologic time-series data.”</p>
</div>
<div id="ref-Kollat_Video">
<p>Kollat, J. B., and Reed, P. (2007). “A framework for Visually Interactive Decision-making and Design using Evolutionary Multi-objective Optimization (VIDEO).” <em>Environmental Modelling and Software</em>, 22(12), 1691–1704.</p>
</div>
<div id="ref-kosslyn1992minding">
<p>Kosslyn, S. M., and Chabris, C. F. (1992). “Minding information graphics.” <em>Folio: the Magazine for Magazine Management</em>, 21(2), 69–71.</p>
</div>
<div id="ref-Kuhnert2005">
<p>Kuhnert, M., Voinov, A., and Seppelt, R. (2005). “Comparing Raster Map Comparison Algorithms for Spatial Modeling and Analysis.” <em>Photogrammetric Engineering and remote Sensing (PE&amp;RD)</em>, 71(8), 975–984.</p>
</div>
<div id="ref-Lamping">
<p>Lamping, J., Rao, R., and Pirolli, P. (1995). “A focus+context technique based on hyperbolic geometry for visualizing large hierarchies.” <em>Proceedings of the sigchi conference on human factors in computing systems</em>, CHI ’95, ACM Press/Addison-Wesley Publishing Co., New York, NY, USA, 401–408.</p>
</div>
<div id="ref-ABMleelig">
<p>Lee, J.-S., Filatova, T., Ligmann-Zielinska, A., Hassani-Mahmooei, B., Stonedahl, F., Lorscheid, I., Voinov, A., Polhill, J. G., Sun, Z., and Parker, D. C. (2015). “The complexities of agent-based modeling output analysis.” <em>Journal of Artificial Societies and Social Simulation</em>, 18(4), 4.</p>
</div>
<div id="ref-Leung">
<p>Leung, Y. K., and Apperley, M. D. (1994). “A review and taxonomy of distortion-oriented presentation techniques.”</p>
</div>
<div id="ref-lig14">
<p>Ligmann-Zielinska, A., Kramer, D., Spence Cheruvelil, K., and Soranno, P. A. (2014). “Using uncertainty and sensitivity analyses in socioecological agent-based models to improve their analytical performance and policy relevance.” <em>PLOS ONE</em>, Public Library of Science, 9(10), 1–13.</p>
</div>
<div id="ref-ourenco2004binary">
<p>Lourenco, F., Lobo, V., and Bacao, F. (2004). “Binary-based similarity measures for categorical data and their application in self-organizing maps.” JOCLAD.</p>
</div>
<div id="ref-Lundstrom">
<p>Lundstrom, C., Ljung, P., Persson, A., and Ynnerman, A. (2007). “Uncertainty visualization in medical volume rendering using probabilistic animation ieee transactions on visualization and computer graphics 13 (6).” 1648–1655.</p>
</div>
<div id="ref-mac92">
<p>Maceachren, A. M. (1992). “Visualizing uncertain information.” <em>Cartographic Perspectives</em>, 13, 10–19.</p>
</div>
<div id="ref-Mackinlay">
<p>Mackinlay, J. D., Robertson, G. G., and Card, S. K. (1991). “The perspective wall: Detail and context smoothly integrated.” <em>Proceedings of the sigchi conference on human factors in computing systems</em>, CHI ’91, ACM, New York, NY, USA, 173–176.</p>
</div>
<div id="ref-Maier">
<p>Maier, H., Guillaume, J., Delden, H. van, Riddell, G., Haasnoot, M., and Kwakkel, J. (2016). “An uncertain future, deep uncertainty, scenarios, robustness and adaptation: How do they fit together?” <em>Environmental Modelling &amp; Software</em>, 81, 154–164.</p>
</div>
<div id="ref-Myanmar16">
<p>Mandle, L., Wolny, S., Hamel, P., Helsingen, H., Bhagabati, N., and Dixon, A. (2016). “Natural connections: How natural capital supports Myanmar’s people and economy.”</p>
</div>
<div id="ref-Manson2005">
<p>Manson, S. M. (2005). “Agent-based modeling and genetic programming for modeling land change in the Southern Yucat??n Peninsular Region of Mexico.” <em>Agriculture, Ecosystems and Environment</em>, 111(1-4), 47–62.</p>
</div>
<div id="ref-Maria">
<p>Martínez-Harms, M. J., and Balvanera, P. (2012). “Methods for mapping ecosystem service supply: A review.” <em>International Journal of Biodiversity Science, Ecosystem Services &amp; Management</em>, 8(1-2), 17–25.</p>
</div>
<div id="ref-akbar">
<p>Matkan, A. A., Shahri, M., and Mirzaie, M. (2013). “Bivariate moran’s i and lisa to explore the crash risky locations in urban areas.” <em>Proceedings of the conference of network-association of european researchers on urbanisation in the south, enschede, the netherlands</em>, 12–14.</p>
</div>
<div id="ref-McMahon2016">
<p>McMahon, R., Stauffacher, M., and Knutti, R. (2016). “The scientific veneer of ipcc visuals.” <em>Climatic Change</em>, 138(3), 369–381.</p>
</div>
<div id="ref-LectureGIS">
<p>Medeiros, D. (2016). “An introduction to gis using arcgis.” Stanford Geospatial Center, Stanford University; University Lecture.</p>
</div>
<div id="ref-murphy04">
<p>Murphy, J. M., Sexton, D. M., Barnett, D. N., Jones, G. S., Webb, M. J., Collins, M., and Stainforth, D. A. (2004). “Quantification of modelling uncertainties in a large ensemble of climate change simulations.” <em>Nature</em>, Nature Publishing Group, 430(7001), 768–772.</p>
</div>
<div id="ref-naturalcapitalscotland">
<p>Natural Capital Scotland Ltd. (2015). “World forum on natural capital, edinburgh, uk.” &lt;<a href="naturalcapitalforum.com/about/" class="uri">naturalcapitalforum.com/about/</a>&gt;.</p>
</div>
<div id="ref-polasky">
<p>Nelson, E., Polasky, S., Lewis, D. J., Plantinga, A. J., Lonsdorf, E., White, D., Bael, D., and Lawler, J. J. (2008). “Efficiency of incentives to jointly increase carbon sequestration and species conservation on a landscape.” <em>Proceedings of the National Academy of Sciences</em>, National Acad Sciences, 105(28), 9471–9476.</p>
</div>
<div id="ref-paretoUNIL">
<p>Pareto, V. (1896). <em>Cours d’Économie politique professé a l’Université de lausanne</em>.</p>
</div>
<div id="ref-Parker2004">
<p>Parker, D. C., and Meretsky, V. (2004). “Measuring pattern outcomes in an agent-based model of edge-effect externalities using spatial metrics.” <em>Agriculture, Ecosystems &amp; Environment</em>, 101(2–3), 233–250.</p>
</div>
<div id="ref-Millennium2005">
<p>Percy, S., and Lubchencho, J. (2005). “Ecosystems and human well being–opportunities and challenges for business and industry.” <em>Millennium Ecosystem Assessment</em>.</p>
</div>
<div id="ref-Pianosi2016">
<p>Pianosi, F., Beven, K., Freer, J., Hall, J. W., Rougier, J., Stephenson, D. B., and Wagener, T. (2016). “Sensitivity analysis of environmental models: A systematic review with practical workflow.” <em>Environmental Modelling &amp; Software</em>, 79, 214–232.</p>
</div>
<div id="ref-Pontius2000">
<p>Pontius, G. R. (2000). “Quantification error versus location error in comparison of categorical maps.” <em>Photogrammetric Engineering and Remote Sensing</em>, 66(8), 1011–1016.</p>
</div>
<div id="ref-Pontius2011">
<p>Pontius, R. G., and Millones, M. (2011). “Death to kappa: Birth of quantity disagreement and allocation disagreement for accuracy assessment.” <em>International Journal of Remote Sensing</em>, 32(15), 4407–4429.</p>
</div>
<div id="ref-power2001">
<p>Power, C., Simms, A., and White, R. (2001). “Hierarchical fuzzy pattern matching for the regional comparison of land use maps.” <em>International Journal of Geographical Information Science</em>, Taylor &amp; Francis, 15(1), 77–100.</p>
</div>
<div id="ref-ABM_intro">
<p>Rand, U. W. W. (2015). <em>An introduction to agent-based modeling</em>. MIT Press.</p>
</div>
<div id="ref-Reed04">
<p>Reed, P. M., and Minsker, B. S. (2004). “Striking the Balance: Long-Term Groundwater Monitoring Design for Conflicting Objectives.” <em>Journal of Water Resources Planning and Management</em>, 130(2), 140–149.</p>
</div>
<div id="ref-reichert2005does">
<p>Reichert, P., and Borsuk, M. E. (2005). “Does high forecast uncertainty preclude effective decision support?” <em>Environmental Modelling &amp; Software</em>, Elsevier, 20(8), 991–1001.</p>
</div>
<div id="ref-remmel">
<p>Remmel, T. K., and Csillag, F. (2006). “Mutual information spectra for comparing categorical maps.” <em>International Journal of Remote Sensing</em>, Taylor &amp; Francis, 27(7), 1425–1452.</p>
</div>
<div id="ref-datavizz">
<p>Ribecca, S. (n.d.). “Data visualization catalogue.” &lt;<a href="http://datavizcatalogue.com" class="uri">http://datavizcatalogue.com</a>&gt;.</p>
</div>
<div id="ref-Ritters1995">
<p>Ritters, K., O’Neill, R., Hunsaker, C., Wickham, J., Yankee, D., Timmins, S., Jones, K., and Jackson, B. (1995). “A factor analysis of landscape pattern and structure metrics.” <em>Landscape Ecology</em>, 10(1), 23–39.</p>
</div>
<div id="ref-Roth">
<p>Roth, R. E., and Harrower, M. (2008). “Addressing map interface usability: Learning from the lakeshore nature preserve interactive map.” <em>Cartographic Perspectives</em>, (60), 46–66.</p>
</div>
<div id="ref-russ95">
<p>Russ, J. C. (1995). <em>The image processing handbook</em>. Boca Raton, CRC Press, 2nd Edition, 674 p. (ISBN 0-8493-2516-1).</p>
</div>
<div id="ref-Lodha">
<p>S.K. Lodha, C.M. Wilson, and Sheehan, R. (1996). “LISTEN: Sounding uncertainty visualization.” <em>In Proceedings of Visualization 96</em>, 189–195.</p>
</div>
<div id="ref-sanyal">
<p>Sanyal, J., Zhang, S., Dyer, J., Mercer, A., Amburn, P., and Moorhead, R. J. (2010). “Noodles: A tool for visualization of numerical weather model ensemble uncertainty.” <em>Visualization and Computer Graphics</em>, 16, 1421–1430.</p>
</div>
<div id="ref-Seppelt2003217">
<p>Seppelt, R., and Voinov, A. (2003). “Optimization methodology for land use patterns—evaluation based on multiscale habitat pattern comparison.” <em>Ecological Modelling</em>, 168(3), 217–231.</p>
</div>
<div id="ref-isoflor">
<p>Specht, R. L. (1981). <em>Heathlands and related shrublands : Analytical studies</em>. Elsevier Scientific Pub.</p>
</div>
<div id="ref-stephens2012">
<p>Stephens, E. M., Edwards, T. L., and Demeritt, D. (2012). “Communicating probabilistic information from climate model ensembles—lessons from numerical weather prediction.” <em>Wiley interdisciplinary reviews: climate change</em>, Wiley Online Library, 3(5), 409–426.</p>
</div>
<div id="ref-Sun14">
<p>Sun, S., Parker, D. C., Huang, Q., Filatova, T., Robinson, D. T., Riolo, R. L., Hutchins, M., and Brown, D. G. (2014). “Market impacts on land-use change: An agent-based experiment.” <em>Annals of the Association of American Geographers</em>, 104(3), 460–484.</p>
</div>
<div id="ref-Teo2003281">
<p>Teo, H.-H., Oh, L.-B., Liu, C., and Wei, K.-K. (2003). “An empirical study of the effects of interactivity on web user attitude.” <em>International Journal of Human-Computer Studies</em>, 58(3), 281–305.</p>
</div>
<div id="ref-piepiepie">
<p>Todd, C. (2016). “The pros and cons of pie charts (mostly the cons though).” <em>Stytch</em>, &lt;<a href="https://www.stytch.com/pros-cons-pie-charts-data-visualization/" class="uri">https://www.stytch.com/pros-cons-pie-charts-data-visualization/</a>&gt;.</p>
</div>
<div id="ref-sohardtovizuncertainty">
<p>Torres, N. (2016). “Why it’s so hard for us to visualize uncertainty.” <em>Harvard Business Review</em>.</p>
</div>
<div id="ref-Alluvial">
<p>Trindade, B. (2017). “Alluvial plots.” <em>Water Programming: A Collaborative Research Blog</em>, &lt;<a href="https://waterprogramming.wordpress.com/2017/01/21/alluvial-plots/" class="uri">https://waterprogramming.wordpress.com/2017/01/21/alluvial-plots/</a>&gt;.</p>
</div>
<div id="ref-Troy">
<p>Troy, A., and Wilson, M. (2006). “Mapping ecosystem services: Practical challenges and opportunities in linking gis and value transfer.” <em>Ecological Economics</em>, 60(2), 435–449.</p>
</div>
<div id="ref-tufte">
<p>Tufte, E. (1983). <em>The visual display of quantitative information</em>. The visual display of quantitative information, Graphics Press.</p>
</div>
<div id="ref-streamchart">
<p>Vallandingham, J. (n.d.). “How to animate transitions between multiple charts.” &lt;<a href="http://flowingdata.com/2013/01/17/how-to-animate-transitions-between-multiple-charts" class="uri">http://flowingdata.com/2013/01/17/how-to-animate-transitions-between-multiple-charts</a>&gt;.</p>
</div>
<div id="ref-jaccard">
<p>Van Rijsbergen, C. (1979). “Information retrieval. dept. of computer science, university of glasgow.” <em>URL: citeseer. ist. psu. edu/vanrijsbergen79information. html</em>, 14.</p>
</div>
<div id="ref-greggg">
<p>Verutes, G., Stacie Wolny, G. K., and Wyatt, K. (2015). “Getting started with a natural capital approach.”</p>
</div>
<div id="ref-villamor14">
<p>Villamor, G. B., Le, Q. B., Djanibekov, U., Noordwijk, M. van, and Vlek, P. L. (2014). “Biodiversity in rubber agroforests, carbon emissions, and rural livelihoods: An agent-based model of land-use dynamics in lowland sumatra.” <em>Environmental Modelling &amp; Software</em>, 61, 151–165.</p>
</div>
<div id="ref-visser2006map">
<p>Visser, H., and De Nijs, T. (2006). “The map comparison kit.” <em>Environmental Modelling &amp; Software</em>, Elsevier, 21(3), 346–358.</p>
</div>
<div id="ref-Vitousek494">
<p>Vitousek, P. M., Mooney, H. A., Lubchenco, J., and Melillo, J. M. (1997). “Human domination of earths ecosystems.” <em>Science</em>, American Association for the Advancement of Science, 277(5325), 494–499.</p>
</div>
<div id="ref-RIOSdoc">
<p>Vogl, A., Tallis, H., Douglass, J., Sharp, R., Wolny, S., Veiga, F., Benitez, S., León, J., Game, E., Petry, P., Guimerães, J., and Lozano, J. S. (2016). “Resource investment optimization system (rios) documentation v1.1.16.”</p>
</div>
<div id="ref-Sadrian">
<p>Vogl, A., Wolny, S., Hamel, P., Johnson, J., Rogers, M., and Dennedy-Frank, J. (2014). “Valuation of hydropower services (technical support for himachal pradesh development policy loan).”</p>
</div>
<div id="ref-PWW">
<p>Wada, C., Bremer, L., Burnett, K., Trauernicht, C., Giambelluca, T., Mandle, L., Parsons, E., Weil, C., and Ticktina, T. (2017, in review). “Prioritizing management investments at pu‘u wa‘awa‘a, hawai‘i using spatial changes in water yield and landscape flammability under forest restoration and climate change.”</p>
</div>
<div id="ref-xmdvtool">
<p>Ward, M. (1994). “Xmdvtool: Integrating multiple methods for visualizing multivariate data.” <em>Proceedings of the conference on visualization’94</em>, IEEE Computer Society Press, 326–333.</p>
</div>
<div id="ref-Ware2000">
<p>Ware, C. (2000). “Information visualization: Perception for design morgan kaufmann.” <em>New York</em>.</p>
</div>
<div id="ref-Weil">
<p>Weil, C. (2017). “NATURAL capital data visualization to promote sustainable decision making.” <em>Master thesis</em>.</p>
</div>
<div id="ref-Vander">
<p>Wel, F. J. V. der, Gaag, L. C. V. der, and Gorte, B. G. (1998). “Visual exploration of uncertainty in remote-sensing classification.” <em>Computers &amp; Geosciences</em>, 24(4), 335–343.</p>
</div>
<div id="ref-van2008">
<p>Werkhoven, K. van, Wagener, T., Reed, P., and Tang, Y. (2008). “Characterization of watershed model behavior across a hydroclimatic gradient.” <em>Water Resources Research</em>, Wiley Online Library, 44(1).</p>
</div>
<div id="ref-wickham08">
<p>Wickham, H. (2008). <em>A layered grammar of graphics</em>.</p>
</div>
<div id="ref-wieland212">
<p>Wieland, A., and Marcus Wallenburg, C. (2012). “Dealing with supply chain risks: Linking risk management practices and strategies to performance.” <em>International Journal of Physical Distribution &amp; Logistics Management</em>, Emerald Group Publishing Limited, 42(10), 887–905.</p>
</div>
<div id="ref-wilhelm1995software">
<p>Wilhelm, A., Unwin, A. R., and Theus, M. (1995). “Software for interactive statistical graphics-a review.” <em>Proc. int. softstat ‘95 conf., heidelberg, germany</em>.</p>
</div>
<div id="ref-wilkinson">
<p>Wilkinson, L. (2006). <em>The grammar of graphics</em>. Springer Science &amp; Business Media.</p>
</div>
<div id="ref-PotterWilson">
<p>Wilson, A., and Potter, K. (2009). “Toward Visual Analysis of Ensemble Data Sets.” <em>UltraVis ’09 Proceedings of the 2009 Workshop on Ultrascale Visualization</em>, 48–53.</p>
</div>
<div id="ref-Winer02">
<p>Winer, E. H., and Bloebaum, C. L. (2002). “Development of visual design steering as an aid in large-scale multidisciplinary design optimization. Part II: Method validation.” <em>Structural and Multidisciplinary Optimization</em>, 23(6), 425–435.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>The field of ecosystem services suffers some inconsistent terminology in literature <span class="citation">(Englund et al. 2017)</span>. Hence, an effort is made here to define precisely the terms used, point out synonyms and vague terminology, to avoid confusions.<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>evaluated by the Millennium Assessments <span class="citation">(Percy and Lubchencho 2005)</span>.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Normalizing a scale to a common one for reference in comparison, or apply a more sophisticated transformation to the data, relevant to the specific case (e.g. divide by population).<a href="#fnref3">↩</a></p></li>
<li id="fn4"><p>The faceting specification is relative to the coordinate system, it <em>“describes which variables should be used to split up the data, and how they should be arranged”</em> <span class="citation">(Wickham 2008)</span>.<a href="#fnref4">↩</a></p></li>
<li id="fn5"><p>Normalizing a colorscale consists in adjusting the scale to a reference one for comparison or to a more sophisticated one depending on the context.<a href="#fnref5">↩</a></p></li>
<li id="fn6"><p>Useful links about analysis of spatial data in R:<br />
- <a href="https://cran.r-project.org/web/views/Spatial.html">overview of analysis of spatial data</a><br />
- <a href="https://journal.r-project.org/archive/2013-1/kahle-wickham.pdf">Illustration of the ggmap package</a><br />
- <a href="https://cran.r-project.org/web/packages/raster/vignettes/Raster.pdf">Introduction to the raster package</a><br />
- <a href="https://oscarperpinan.github.io/rastervis/">Introduction to RasterVis, which builds on raster package</a><a href="#fnref6">↩</a></p></li>
<li id="fn7"><p>Useful links to make maps using Python (with matplotlib and basemap): <a href="http://sensitivecities.com/so-youd-like-to-make-a-map-using-python-EN.html#.WCJPDvkrJhE">a well written blogpost</a>, <a href="http://www.datadependence.com/2016/06/creating-map-visualisations-in-python/">another one</a>, and <a href="http://matplotlib.org/basemap/users/examples.html">basemap examples</a>.<a href="#fnref7">↩</a></p></li>
<li id="fn8"><p>Vocabulary note: “multi-objective” refers here to problems with three or more objectives, also called many-objective problems <span class="citation">(Fleming et al. 2005)</span> or high order-Pareto optimization problems <span class="citation">(Reed and Minsker 2004)</span><a href="#fnref8">↩</a></p></li>
<li id="fn9"><p>To avoid confusion, we clarify here that figure <span class="ref">fig:scatterplots</span>b is not a SPLOM, as the axis correspond to the same variables in every multiple. A SPLOM would display plots where each the axis correspond to different variables in each multiple, to show pairwise correlation information. An example can be found in <a href="https://www3.epa.gov/caddis/da_exploratory_1.html">figure 2 here</a>.<a href="#fnref9">↩</a></p></li>
<li id="fn10"><p>A side concern that may come up in these cases, is about data management: the total size of the runs can become is too large for available main memory. A strategy is to precompute summary statistics, such as the mean and extrema <span class="citation">(Wilson and Potter 2009)</span>.<a href="#fnref10">↩</a></p></li>
<li id="fn11"><p>Links to parallel coordinates and alluvial plots implementations and packages:<br />
- <a href="https://reed.cee.cornell.edu/parallel-axis/">A tool to build directly an interactive parallel coordinate plot</a><br />
- <a href="http://syntagmatic.github.io/parallel-coordinates/">Its underlying implementation, with D3.js</a><br />
- <a href="https://waterprogramming.wordpress.com/2016/09/12/easy-vectorized-parallel-plots-for-multiple-data-sets/">Parallel plots in Python</a><br />
- <a href="https://openmordm.shinyapps.io/Iris/">Interactive parallel plots in R, with Shiny and 3D scatterplot</a><br />
- <a href="https://cran.r-project.org/web/packages/alluvial/vignettes/alluvial.html">Alluvial plot package in R</a>.<a href="#fnref11">↩</a></p></li>
<li id="fn12"><p>Spiderplots or spidercharts is a blurry term to that has been used to refer both to 2-axis spiderplots (as in figure <span class="ref">fig:SA_overall</span>b), but also to multi-axis spiderplots which are also referred to as radar chart (as in figure <span class="ref">fig:coastal_sm</span>a).<a href="#fnref12">↩</a></p></li>
<li id="fn13"><p>see also petal charts, and discussion from <span class="citation">Chandoo (2008)</span>.<a href="#fnref13">↩</a></p></li>
<li id="fn14"><p>Normalizing here consists in dividing the variable of interest per unit area; e.g. to express population, the population per square kilometer should be displayed.<a href="#fnref14">↩</a></p></li>
<li id="fn15"><p>The text translates to: <em>The numbers of men present are represented by the width of the colored zones at a scale of one millimeter for every ten thousand men; they are further written across the zones. The red designates the men who enter into Russia, the black those who leave it. The information which has served to draw up the map has been extracted from the works of M. M. Thiers of Ségur, of Fezensac, of Chambray and the unpublished diary of Jacob, the pharmacist of the army since october 28th. In order to better judge with the eye the diminution of the army, I have assumed that the troops of Prince Jérôme and the Marshal Davoush who had been detached at Minsk and Mokilow and have rejoined around Orcha and Vitebsk had always marched with the army.</em> ](../images/Minard.png){#fig:minard}<a href="#fnref15">↩</a></p></li>
<li id="fn16"><p>Inconsistent terminology note: sometimes the word <em>scenarios</em> is used to refer to a portfolio. Unfortunately, this term has been used with many meanings depending on the context and niche modeling community, including a more general meaning of a specific realization of uncertain exogenous input variables. Thus one might also develop a “portfolio” of targeted interventions under multiple (exogenous) scenarios.<a href="#fnref16">↩</a></p></li>
<li id="fn17"><p>MCK compares raster maps using fuzzy set map comparison, hierarchical fuzzy pattern matching, and moving window based comparison of landscape structure. <a href="http://mck.riks.nl">See MCK website</a>.<a href="#fnref17">↩</a></p></li>
<li id="fn18"><p>More precisely, the modal portfolio maps can either display the category assigned in most of the runs, or limit to these assigned in a certain threshold percentage of the runs.<a href="#fnref18">↩</a></p></li>
<li id="fn19"><p>Terminology note: Following <span class="citation">Kuhnert et al. (2005)</span>, in this section, “cell” corresponds to the regional unit at which data is aggregated, also referred to as SDU, it can be a region, a pixel, a hydrological area or a state for example.<a href="#fnref19">↩</a></p></li>
<li id="fn20"><p>Details of calculations can be found <a href="https://docs.google.com/spreadsheets/d/1wsm0-X5-pJ_I7J7nduWE_dmiOVWgSUyyo-51t58C8Vo/edit#gid=436596527">here</a>.<a href="#fnref20">↩</a></p></li>
<li id="fn21"><p>Spiderplots or spidercharts is a blurry term to that has been used to refer both to 2-axis spiderplots (as in figure <span class="ref">fig:SA_overall</span>b), but also to multi-axis spiderplots which are also referred to as radar chart (as in figure <span class="ref">fig:coastal_sm</span>a).<a href="#fnref21">↩</a></p></li>
<li id="fn22"><p><span class="citation">Huwyler et al. (2014)</span> calculates that, to meet the global need for conservation funding, investable cash flows from conservation projects need to be at least 20-30 times greater than they are today, reaching USD 200-300 billion per year.<a href="#fnref22">↩</a></p></li>
</ol>
</div>
</div>
</main>
<!-- jQuery  -->
<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

<!-- Materialize javascript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>

<!-- Beautiful math formulaes -->
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>

// Insert title of project
const titleFirst="Natural Capital Data Visualization";
const titleSecond="A toolbox to synthesize and visualize multiple complex ecosystem services model outputs";
$(
    '<h1 id="title" class="title first">' + titleFirst + '</h1>' +
    '<br>' + 
    '<h1 class="title second">' + titleSecond + '</h1>'
 ).insertAfter("#TOC");

// Make table of contents the side navigation
const toc = $('#TOC ul:first-child');
toc.addClass("side-nav").addClass("fixed");

// Add link to live demo & title of project
const masterpageUrl = 'http://www.charlotteweil.fr/masterthesis';
toc.prepend(
    '<li>' + 
    '<a href="toolbox.pdf" target="_blank">' +
    '<i class="material-icons">picture_as_pdf</i> PDF version' +
    '</a>' +
    '</li>' +
    '<div class="bottom divider"></div>' + 
    '<li>' +
    '<a class="title" href="#title">' +
    titleFirst +
    '</a>' +
    '</li>');

// Add link to pdf document
toc.append(
    
    '<div class="divider"></div>' +
    '<li>' + 
    '<a href="' + masterpageUrl + '">' +
    '<i class="material-icons">launch</i> Master thesis' +
    '</a>' +
    '<div class="bottom divider"></div>' +
    '</li>');


// Truncate long titles in side-nav & cool wave effect
$('#TOC ul li a').addClass("truncate").addClass('waves-effect');

// Make elements collapsible in side nav
$('#TOC ul').addClass("collapsible").addClass("collapsible-accordion");
$('#TOC ul li a').addClass("collapsible-header");
$('#TOC ul li a + ul').addClass("collapsible-body");

// Add cool avatar picture
const avatarUrl = '../images/avatar.jpg';
const logoUrl = '../images/natcap-logo.jpg';
const natcapUrl = 'http://www.naturalcapitalproject.org';
const githubUrl = 'https://github.com/charlottegiseleweil';
const linkedInUrl = 'https://www.linkedin.com/in/charlotteweil';
const email = 'weilcharlotte@gmail.com';
toc.prepend('<li>' +
    '<div class="userView">' +
    '<a class="inline" href="' + natcapUrl + '"><img class="logo" src="' + logoUrl + '"></a>' +
    
    '<li>' + 
    '<a class="inline-icon" href="mailto:' + email + '"><i class="material-icons">email</i>' +
    '<em>Charlotte Weil</em></a>' +
    '</li>' +
    '</div>' +
    '<div class="divider"></div>' +
    '</li>');

// Make all external links open in new tab
$("main a[href^='http']").attr("target", "_blank");

// Add all reference links
$(".ref").each((i, x) => {
  const id = x.innerText;
  const refDiv = $('#' + id.replace(':', '\\:'));
  let text = '???';
  if (id.startsWith('sec:')) {
    text = refDiv.find('.header-section-number').text();
  } else if (id.startsWith('fig:')) {
    const alt = refDiv.attr('alt');
    if (alt) {
      text = alt.split(':')[0].substring(7);
    } else {
      console.log('Could not find text for figure: ', id);
    }
  } else {
    console.log('Could not find text for reference: ', id);
  }
  $(x).html('<a href=#'+ id + '>' + text + '</a>');
});

</script>
</body>
</html>
